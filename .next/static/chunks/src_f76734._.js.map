{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/services/activity.ts"],"sourcesContent":["import api, { generateUploadHeaders } from '../utils/api';\nimport { Post, PostListResponse, CreatePostDTO, Comment } from '../types/activity';\n\nexport const getPosts = async (params: { \n  page?: number; \n  per_page?: number; \n  type?: 'latest' | 'hot' | 'following'; \n  author?: string; \n  tag?: string;\n  is_collected?: boolean; \n}) => {\n  const response = await api.get<PostListResponse>('/api/posts', { \n    params: { ...params, _t: Date.now() } \n  });\n  return response.data;\n};\n\nexport const getHotTopics = async (query?: string) => {\n  const params = query ? { query } : {};\n  const response = await api.get<{name: string, count: number}[]>('/api/topics/hot', { params });\n  return response.data;\n};\n\nexport const getPost = async (id: number) => {\n  const response = await api.get<Post>(`/api/posts/${id}`);\n  return response.data;\n};\n\nexport const createPost = async (data: CreatePostDTO) => {\n  const response = await api.post<Post>('/api/posts', data);\n  return response.data;\n};\n\nexport const updatePost = async (id: number, data: Partial<CreatePostDTO>) => {\n  const response = await api.put<Post>(`/api/posts/${id}`, data);\n  return response.data;\n};\n\nexport const deletePost = async (id: number) => {\n  const response = await api.delete(`/api/posts/${id}`);\n  return response.data;\n};\n\nexport const toggleLikePost = async (id: number) => {\n  const response = await api.post<{ is_liked: boolean; likes_count: number }>(`/api/posts/${id}/like`);\n  return response.data;\n};\n\nexport const toggleCollectPost = async (id: number) => {\n  const response = await api.post<{ is_collected: boolean; collects_count: number }>(`/api/posts/${id}/collect`);\n  return response.data;\n};\n\nexport const getComments = async (postId: number) => {\n  const response = await api.get<Comment[]>(`/api/posts/${postId}/comments`);\n  return response.data;\n};\n\nexport const createComment = async (postId: number, content: string, parentId?: number) => {\n  const response = await api.post<Comment>(`/api/posts/${postId}/comments`, { content, parent_id: parentId });\n  return response.data;\n};\n\nexport const uploadImage = async (file: File) => {\n  const formData = new FormData();\n  formData.append('file', file);\n  const securityHeaders = await generateUploadHeaders();\n  const response = await api.post<{ url: string }>('/api/upload/image', formData, {\n    headers: {\n      'Content-Type': 'multipart/form-data',\n      ...securityHeaders,\n    },\n  });\n  return response.data;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAGO,MAAM,WAAW,OAAO;IAQ7B,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAmB,cAAc;QAC7D,QAAQ;YAAE,GAAG,MAAM;YAAE,IAAI,KAAK,GAAG;QAAG;IACtC;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,eAAe,OAAO;IACjC,MAAM,SAAS,QAAQ;QAAE;IAAM,IAAI,CAAC;IACpC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAkC,mBAAmB;QAAE;IAAO;IAC5F,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,UAAU,OAAO;IAC5B,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAO,CAAC,WAAW,EAAE,GAAG,CAAC;IACvD,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,aAAa,OAAO;IAC/B,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAAO,cAAc;IACpD,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,aAAa,OAAO,IAAY;IAC3C,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAO,CAAC,WAAW,EAAE,GAAG,CAAC,EAAE;IACzD,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,aAAa,OAAO;IAC/B,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC;IACpD,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,iBAAiB,OAAO;IACnC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAA6C,CAAC,WAAW,EAAE,GAAG,KAAK,CAAC;IACnG,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,oBAAoB,OAAO;IACtC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAAoD,CAAC,WAAW,EAAE,GAAG,QAAQ,CAAC;IAC7G,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,cAAc,OAAO;IAChC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAY,CAAC,WAAW,EAAE,OAAO,SAAS,CAAC;IACzE,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,gBAAgB,OAAO,QAAgB,SAAiB;IACnE,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAAU,CAAC,WAAW,EAAE,OAAO,SAAS,CAAC,EAAE;QAAE;QAAS,WAAW;IAAS;IACzG,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,cAAc,OAAO;IAChC,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,QAAQ;IACxB,MAAM,kBAAkB,MAAM,CAAA,GAAA,sHAAA,CAAA,wBAAqB,AAAD;IAClD,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAAkB,qBAAqB,UAAU;QAC9E,SAAS;YACP,gBAAgB;YAChB,GAAG,eAAe;QACpB;IACF;IACA,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/services/album.ts"],"sourcesContent":["import api from '../utils/api';\n\nexport const toggleLikeAlbum = async (id: number) => {\n  const response = await api.post<{ is_liked: boolean; likes: number }>(`/api/album/${id}/like`);\n  // Normalize response to match post response structure (likes_count vs likes)\n  return { is_liked: response.data.is_liked, likes_count: response.data.likes };\n};\n\nexport const toggleCollectAlbum = async (id: number) => {\n  const response = await api.post<{ is_collected: boolean; collects_count?: number }>(`/api/album/${id}/collect`);\n  // Note: Backend might not return collects_count for album yet.\n  return { is_collected: response.data.is_collected, collects_count: response.data.collects_count || 0 };\n};\n\nexport const createAlbumComment = async (albumId: number, content: string) => {\n    // Note: Backend endpoint /api/album/{id}/comment returns { status: \"success\", comment_count: count }\n    // It does NOT return the comment object. This is a limitation.\n    // Standard activity comment creation returns the comment object to append to list.\n    // For now, we might not support commenting directly from feed for albums if UI expects full comment list logic.\n    // Or we just call it and update count.\n    const response = await api.post<{ status: string, comment_count: number }>(`/api/album/${albumId}/comment`, { content });\n    return response.data;\n};\n\nexport const deleteAlbum = async (id: number) => {\n    const response = await api.delete(`/api/album/${id}`);\n    return response.data;\n};\n\nexport const updateAlbum = async (id: number, data: { title?: string; description?: string }) => {\n    const response = await api.put(`/api/album/${id}`, data);\n    return response.data;\n};\n\nexport const getAlbum = async (id: number) => {\n    const response = await api.get(`/api/album/${id}`);\n    return response.data;\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAEO,MAAM,kBAAkB,OAAO;IACpC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAAuC,CAAC,WAAW,EAAE,GAAG,KAAK,CAAC;IAC7F,6EAA6E;IAC7E,OAAO;QAAE,UAAU,SAAS,IAAI,CAAC,QAAQ;QAAE,aAAa,SAAS,IAAI,CAAC,KAAK;IAAC;AAC9E;AAEO,MAAM,qBAAqB,OAAO;IACvC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAAqD,CAAC,WAAW,EAAE,GAAG,QAAQ,CAAC;IAC9G,+DAA+D;IAC/D,OAAO;QAAE,cAAc,SAAS,IAAI,CAAC,YAAY;QAAE,gBAAgB,SAAS,IAAI,CAAC,cAAc,IAAI;IAAE;AACvG;AAEO,MAAM,qBAAqB,OAAO,SAAiB;IACtD,qGAAqG;IACrG,+DAA+D;IAC/D,mFAAmF;IACnF,gHAAgH;IAChH,uCAAuC;IACvC,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,IAAI,CAA4C,CAAC,WAAW,EAAE,QAAQ,QAAQ,CAAC,EAAE;QAAE;IAAQ;IACtH,OAAO,SAAS,IAAI;AACxB;AAEO,MAAM,cAAc,OAAO;IAC9B,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC;IACpD,OAAO,SAAS,IAAI;AACxB;AAEO,MAAM,cAAc,OAAO,IAAY;IAC1C,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC,EAAE;IACnD,OAAO,SAAS,IAAI;AACxB;AAEO,MAAM,WAAW,OAAO;IAC3B,MAAM,WAAW,MAAM,sHAAA,CAAA,UAAG,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC;IACjD,OAAO,SAAS,IAAI;AACxB"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/MarkdownEditor.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport Vditor from 'vditor';\nimport 'vditor/dist/index.css';\nimport './MarkdownEditor.css'; // Import custom overrides\nimport clsx from 'clsx';\nimport api, { generateUploadHeaders } from '../utils/api';\n\ninterface MarkdownEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  className?: string;\n  minHeight?: string;\n}\n\nconst MarkdownEditor: React.FC<MarkdownEditorProps> = ({ \n  value, \n  onChange, \n  placeholder = \"写点什么...\", \n  className,\n  minHeight = \"min-h-[200px]\"\n}) => {\n  const [vditor, setVditor] = useState<Vditor>();\n  const editorRef = useRef<HTMLDivElement>(null);\n  const isUpdatingRef = useRef(false);\n  const userCacheRef = useRef<{value: string, html: string}[]>([]);\n  // Cache for deduplication: hash -> url\n  const uploadedCacheRef = useRef<Map<string, string>>(new Map());\n  // Cache for pending uploads: hash -> promise\n  const activeUploadsRef = useRef<Map<string, Promise<string>>>(new Map());\n\n  // Helper to calculate file hash\n  const calculateFileHash = async (file: File): Promise<string> => {\n     const buffer = await file.arrayBuffer();\n     const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);\n     const hashArray = Array.from(new Uint8Array(hashBuffer));\n     return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  };\n\n  useEffect(() => {\n    if (!editorRef.current) return;\n\n    // Clear previous instance if exists (to prevent duplicates in strict mode)\n    if (editorRef.current) {\n       editorRef.current.innerHTML = '';\n    }\n\n    const vditorInstance = new Vditor(editorRef.current, {\n      value: value,\n      mode: 'wysiwyg', // WYSIWYG mode\n      height: 400,\n      minHeight: 300,\n      placeholder,\n      lang: 'zh_CN',\n      theme: 'classic', // Default, will be updated by effect\n      cache: {\n        enable: false,\n      },\n      toolbar: [\n        'emoji', 'headings', 'bold', 'italic', 'strike', 'link', '|',\n        'list', 'ordered-list', 'check', 'outdent', 'indent', '|',\n        'quote', 'line', 'code', 'inline-code', 'insert-before', 'insert-after', '|',\n        'upload', 'table', '|',\n        'undo', 'redo', '|',\n        'edit-mode',\n      ],\n      hint: {\n        at: (key: string) => {\n            // Note: Vditor expects synchronous return. \n            // We trigger fetch if key is present, but return cached/empty for now.\n            // This is a best-effort approach.\n            if (key) {\n                api.get(`/api/profile/search?q=${key}`).then(res => {\n                    userCacheRef.current = res.data.map((u: any) => ({\n                        value: '@' + u.username,\n                        html: `<div class=\"flex items-center gap-2\"><img src=\"${u.avatar || `https://cravatar.eu/helmavatar/${u.username}/16.png`}\" class=\"w-5 h-5 rounded-full\"/> ${u.username}</div>`\n                    }));\n                }).catch(console.error);\n            }\n            // Return whatever we have that matches\n            return userCacheRef.current.filter(u => u.value.toLowerCase().includes(key.toLowerCase()));\n        }\n      } as any,\n      after: () => {\n        setVditor(vditorInstance);\n      },\n      input: (val) => {\n        isUpdatingRef.current = true;\n        onChange(val);\n        // Reset flag after a short delay to ensure we don't block prop updates if they loop back quickly\n        setTimeout(() => { isUpdatingRef.current = false; }, 0);\n      },\n      upload: {\n        accept: 'image/*',\n        multiple: false,\n        handler: async (files) => {\n          for (const file of files) {\n            const placeholderText = `![⏳ 正在上传 ${file.name}...](https://cdnjs.cloudflare.com/ajax/libs/galleriffic/2.0.1/css/loader.gif)`;\n            \n            // Insert placeholder and show loading tip\n            vditorInstance.insertValue(placeholderText);\n            vditorInstance.tip(`正在上传 ${file.name}...`, 0);\n\n            try {\n              // 1. Calculate hash for deduplication\n              const fileHash = await calculateFileHash(file);\n              \n              // 2. Check if already uploaded\n              if (uploadedCacheRef.current.has(fileHash)) {\n                 const url = uploadedCacheRef.current.get(fileHash)!;\n                 const name = file.name;\n                 const finalMarkdown = `![${name}](${url})`;\n                 \n                 const currentVal = vditorInstance.getValue();\n                 const newVal = currentVal.replace(placeholderText, finalMarkdown);\n                 vditorInstance.setValue(newVal);\n                 vditorInstance.tip('秒传成功 (已存在)', 2000);\n                 continue; // Skip upload\n              }\n\n              // 3. Check if currently uploading (deduplicate requests)\n              let uploadPromise = activeUploadsRef.current.get(fileHash);\n              \n              if (!uploadPromise) {\n                 // Start new upload task\n                 uploadPromise = (async () => {\n                    let fileToUpload = file;\n              \n                    // Compress if large\n                    if (fileToUpload.size > 5 * 1024 * 1024) {\n                       try {\n                          fileToUpload = await compressImage(fileToUpload);\n                          if (fileToUpload.size > 5 * 1024 * 1024) {\n                             throw new Error('图片压缩后仍然超过5MB限制，请选择更小的图片');\n                          }\n                          // Recalculate hash for compressed file? \n                          // No, we map original file hash to result url. \n                          // If user uploads same large file again, we want to skip compression too.\n                       } catch (e: any) {\n                          console.error('Compression failed', e);\n                       }\n                    }\n\n                    const formData = new FormData();\n                    formData.append('file', fileToUpload);\n                    \n                    const securityHeaders = await generateUploadHeaders();\n                    \n                    const response = await api.post<{ url: string }>('/api/upload/image', formData, {\n                      headers: {\n                        'Content-Type': 'multipart/form-data',\n                        ...securityHeaders,\n                      },\n                    });\n                    \n                    return response.data.url;\n                 })();\n\n                 // Store promise in cache\n                 activeUploadsRef.current.set(fileHash, uploadPromise);\n              } else {\n                 vditorInstance.tip('正在合并重复上传任务...', 0);\n              }\n\n              // Await result (whether new or existing promise)\n              const url = await uploadPromise;\n              \n              // Cache result\n              uploadedCacheRef.current.set(fileHash, url);\n              activeUploadsRef.current.delete(fileHash); // Clean up pending\n\n              const name = file.name;\n              const finalMarkdown = `![${name}](${url})`;\n              \n              // Replace placeholder with actual image\n              const currentVal = vditorInstance.getValue();\n              const newVal = currentVal.replace(placeholderText, finalMarkdown);\n              vditorInstance.setValue(newVal);\n              \n              vditorInstance.tip('上传成功', 2000);\n            } catch (err: any) {\n              console.error('Failed to upload image:', err);\n              // Clean up pending on error\n              const fileHash = await calculateFileHash(file).catch(() => null);\n              if (fileHash) activeUploadsRef.current.delete(fileHash);\n\n              const msg = err.response?.data?.detail || err.message || '上传失败';\n              \n              // Remove placeholder or show error\n              const currentVal = vditorInstance.getValue();\n              const newVal = currentVal.replace(placeholderText, `[上传失败: ${file.name}]`);\n              vditorInstance.setValue(newVal);\n              \n              vditorInstance.tip(msg, 3000);\n            }\n          }\n          return null;\n        },\n      },\n      preview: {\n        theme: {\n          current: 'light',\n          path: 'https://cdn.jsdelivr.net/npm/vditor/dist/css/content-theme',\n        },\n      },\n    });\n\n    // setVditor(vditorInstance); // Removed, set in after callback\n\n    return () => {\n      try {\n        vditorInstance?.destroy();\n      } catch (e) {\n        // Ignore destroy error in strict mode\n      }\n      setVditor(undefined);\n    };\n  }, []); // Run once on mount\n\n  // ... keep existing effects ...\n    useEffect(() => {\n    if (vditor && !isUpdatingRef.current && value !== vditor.getValue()) {\n      vditor.setValue(value);\n    }\n  }, [value, vditor]);\n\n  // Dark mode sync\n  useEffect(() => {\n    if (vditor) {\n        const isDark = document.documentElement.classList.contains('dark');\n        vditor.setTheme(isDark ? 'dark' : 'classic', isDark ? 'dark' : 'light');\n    }\n  }, [vditor]);\n\n  return <div ref={editorRef} className={clsx(\"vditor-reset\", minHeight, className)} />;\n};\n\nconst compressImage = (file: File): Promise<File> => {\n    return new Promise((resolve, reject) => {\n       const img = new Image();\n       const reader = new FileReader();\n       \n       reader.onload = (e) => {\n          img.src = e.target?.result as string;\n       };\n       reader.onerror = reject;\n       \n       img.onload = () => {\n          const canvas = document.createElement('canvas');\n          let width = img.width;\n          let height = img.height;\n          \n          // Resize if too large (max dimension 1920px)\n          const MAX_DIMENSION = 1920;\n          if (width > MAX_DIMENSION || height > MAX_DIMENSION) {\n             if (width > height) {\n                height *= MAX_DIMENSION / width;\n                width = MAX_DIMENSION;\n             } else {\n                width *= MAX_DIMENSION / height;\n                height = MAX_DIMENSION;\n             }\n          }\n          \n          canvas.width = width;\n          canvas.height = height;\n          const ctx = canvas.getContext('2d');\n          if (!ctx) {\n             reject(new Error('Canvas context not available'));\n             return;\n          }\n          \n          ctx.drawImage(img, 0, 0, width, height);\n          \n          canvas.toBlob((blob) => {\n             if (blob) {\n                resolve(new File([blob], file.name, {\n                   type: 'image/jpeg',\n                   lastModified: Date.now()\n                }));\n             } else {\n                reject(new Error('Canvas to Blob failed'));\n             }\n          }, 'image/jpeg', 0.8);\n       };\n       \n       img.onerror = () => reject(new Error('Image load failed'));\n    });\n };\n\nexport default MarkdownEditor;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 437, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 442, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/hooks/useCurrentUserLevel.ts"],"sourcesContent":["import { useLevel } from '../context/LevelContext';\n\nexport const useCurrentUserLevel = () => {\n  return useLevel();\n};\n"],"names":[],"mappings":";;;;;;;AAEO,MAAM,sBAAsB;;IACjC,OAAO,CAAA,GAAA,kIAAA,CAAA,WAAQ,AAAD;AAChB;GAFa;;QACJ,kIAAA,CAAA,WAAQ"}},
    {"offset": {"line": 458, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 463, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/next/CreatePostModal.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { X, Loader2, Send, Flame, Save } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport MarkdownEditor from '../MarkdownEditor';\nimport { createPost, updatePost, getHotTopics } from '@/services/activity';\nimport { updateAlbum } from '@/services/album';\nimport { Post } from '@/types/activity';\nimport ModalPortal from '../ModalPortal';\nimport { useCurrentUserLevel } from '@/hooks/useCurrentUserLevel';\nimport { useToast } from '@/context/ToastContext';\n\ninterface CreatePostModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: (newPost: any) => void;\n  post?: Post; // If provided, we are in edit mode\n}\n\nconst CreatePostModal: React.FC<CreatePostModalProps> = ({ isOpen, onClose, onSuccess, post }) => {\n  const { level: currentUserLevel } = useCurrentUserLevel();\n  const { warning } = useToast();\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  \n  // Tag System State\n  const [tags, setTags] = useState<string[]>([]);\n  const [tagInput, setTagInput] = useState('');\n  const [suggestions, setSuggestions] = useState<{name: string, count: number}[]>([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const suggestionsRef = useRef<HTMLDivElement>(null);\n\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const isEditing = !!post;\n  const isAlbum = post?.type === 'album';\n\n  // Initialize state when opening or post changes\n  useEffect(() => {\n    if (isOpen && post) {\n      setTitle(post.title);\n      setContent(post.content);\n      setTags(post.tags || []);\n    } else if (isOpen && !post) {\n      // Reset for create mode\n      setTitle('');\n      setContent('');\n      setTags([]);\n      setTagInput('');\n    }\n  }, [isOpen, post]);\n\n  // Fetch suggestions when input changes (debounced ideally, but for now direct)\n  useEffect(() => {\n    if (isAlbum) return; // No tags for albums\n\n    const fetchSuggestions = async () => {\n        try {\n            // Always fetch if focused, but maybe filter by input\n            // If input is empty, we want \"Recommended\" tags\n            const res = await getHotTopics(tagInput);\n            // Filter out already selected tags\n            setSuggestions(res.filter(t => !tags.includes(t.name)));\n        } catch (e) {\n            console.error(e);\n        }\n    };\n    \n    if (isOpen) {\n        const timer = setTimeout(fetchSuggestions, 300);\n        return () => clearTimeout(timer);\n    }\n  }, [tagInput, tags, isOpen, isAlbum]);\n\n  // Close suggestions on outside click\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (suggestionsRef.current && !suggestionsRef.current.contains(event.target as Node) && \n          inputRef.current && !inputRef.current.contains(event.target as Node)) {\n        setShowSuggestions(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleAddTag = (tagToAdd: string) => {\n    const cleanTag = tagToAdd.trim().replace(/^#/, '');\n    if (cleanTag && !tags.includes(cleanTag) && tags.length < 10) {\n      setTags([...tags, cleanTag]);\n      setTagInput('');\n      setShowSuggestions(false);\n    }\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    setTags(tags.filter(t => t !== tagToRemove));\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault(); // Prevent form submission\n      if (tagInput.trim()) {\n        handleAddTag(tagInput);\n      }\n    } else if (e.key === 'Backspace' && !tagInput && tags.length > 0) {\n      // Remove last tag if input is empty\n      handleRemoveTag(tags[tags.length - 1]);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!title.trim() || !content.trim()) return;\n\n    if (currentUserLevel !== null && currentUserLevel < 5) {\n      warning('您的等级不足 5 级，无法发布动态。请前往游戏内升级！');\n      return;\n    }\n\n    setIsSubmitting(true);\n    setError(null);\n    try {\n      let result;\n      \n      if (isEditing && post) {\n        if (isAlbum) {\n            // Update Album\n            result = await updateAlbum(post.id, {\n                title,\n                description: content // Map content to description\n            });\n        } else {\n            // Update Post\n            // Extract tags from content if any\n            const contentTags = (content.match(/#[^\\s#.,;!?，。！？]+/g) || [])\n                .map(t => t.replace(/^#/, ''));\n            // Merge unique tags\n            const finalTags = Array.from(new Set([...tags, ...contentTags]));\n\n            // Extract images from content for preview grid\n            const imageMatches = content.match(/!\\[.*?\\]\\((.*?)\\)/g) || [];\n            const images = imageMatches.map(match => {\n                const urlMatch = match.match(/\\((.*?)\\)/);\n                return urlMatch ? urlMatch[1] : '';\n            }).filter(url => url);\n\n            result = await updatePost(post.id, {\n                title,\n                content,\n                tags: finalTags,\n                images\n            });\n        }\n      } else {\n        // Create Post\n        // Extract tags from content if any\n        const contentTags = (content.match(/#[^\\s#.,;!?，。！？]+/g) || [])\n            .map(t => t.replace(/^#/, ''));\n        // Merge unique tags\n        const finalTags = Array.from(new Set([...tags, ...contentTags]));\n\n        // Extract images from content for preview grid\n        const imageMatches = content.match(/!\\[.*?\\]\\((.*?)\\)/g) || [];\n        const images = imageMatches.map(match => {\n            const urlMatch = match.match(/\\((.*?)\\)/);\n            return urlMatch ? urlMatch[1] : '';\n        }).filter(url => url);\n\n        result = await createPost({ title, content, tags: finalTags, images });\n      }\n\n      onSuccess(result);\n      \n      // Reset form\n      setTitle('');\n      setContent('');\n      setTags([]);\n      setTagInput('');\n      onClose();\n    } catch (err) {\n      setError(isEditing ? '更新失败，请重试' : '发布失败，请重试');\n      console.error(err);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const modalTitle = isEditing \n    ? (isAlbum ? '编辑相册' : '编辑动态') \n    : '发布动态';\n\n  return (\n    <ModalPortal>\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50\"\n          />\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n            onClick={(e) => e.target === e.currentTarget && onClose()}\n          >\n            <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col relative\" onClick={e => e.stopPropagation()}>\n              <div className=\"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800 shrink-0\">\n                <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">{modalTitle}</h2>\n                <button onClick={onClose} className=\"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 transition-colors\">\n                  <X size={24} />\n                </button>\n              </div>\n              \n              <div className=\"p-6 overflow-y-auto\">\n                <form id=\"create-post-form\" onSubmit={handleSubmit} className=\"space-y-6\">\n                    {error && (\n                      <div className=\"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-xl text-sm flex items-center gap-2\">\n                        <span className=\"w-1.5 h-1.5 bg-red-500 rounded-full\" />\n                        {error}\n                      </div>\n                    )}\n                    \n                    <div>\n                      <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\n                        标题\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={title}\n                        onChange={(e) => setTitle(e.target.value)}\n                        placeholder={isAlbum ? \"相册标题\" : \"给你的动态起个标题...\"}\n                        className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400\"\n                        maxLength={100}\n                      />\n                    </div>\n\n                    {!isAlbum && (\n                    <div>\n                      <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\n                        标签话题 <span className=\"text-slate-400 font-normal text-xs ml-1\">(回车添加，最多10个)</span>\n                      </label>\n                      \n                      <div className=\"relative\">\n                        <div className=\"flex flex-wrap gap-2 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus-within:ring-2 focus-within:ring-emerald-500 focus-within:border-transparent transition-all min-h-[50px]\">\n                          <AnimatePresence mode=\"popLayout\">\n                            {tags.map(tag => (\n                              <motion.div \n                                layout\n                                initial={{ scale: 0.8, opacity: 0 }}\n                                animate={{ scale: 1, opacity: 1 }}\n                                exit={{ scale: 0.8, opacity: 0 }}\n                                key={tag} \n                                className=\"flex items-center gap-1.5 pl-3 pr-2 py-1 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-700 dark:text-emerald-300 rounded-lg border border-emerald-100 dark:border-emerald-500/20\"\n                              >\n                                <span className=\"text-sm font-medium\">#{tag}</span>\n                                <button \n                                  type=\"button\"\n                                  onClick={() => handleRemoveTag(tag)} \n                                  className=\"p-0.5 rounded-md hover:bg-emerald-200 dark:hover:bg-emerald-500/30 text-emerald-400 hover:text-emerald-700 transition-colors\"\n                                >\n                                  <X size={14} />\n                                </button>\n                              </motion.div>\n                            ))}\n                          </AnimatePresence>\n\n                          <div className=\"flex-1 relative min-w-[120px]\">\n                             <input\n                               ref={inputRef}\n                               type=\"text\"\n                               value={tagInput}\n                               onChange={(e) => setTagInput(e.target.value)}\n                               onKeyDown={handleKeyDown}\n                               onFocus={() => setShowSuggestions(true)}\n                               placeholder={tags.length === 0 ? \"添加标签 (如: #粘液空岛)\" : \"\"}\n                               className=\"w-full h-full py-1.5 bg-transparent border-none outline-none text-slate-900 dark:text-white placeholder-slate-400 text-sm\"\n                             />\n                          </div>\n                        </div>\n\n                        {/* Suggestions Dropdown */}\n                        <AnimatePresence>\n                          {showSuggestions && suggestions.length > 0 && (\n                            <motion.div\n                              ref={suggestionsRef}\n                              initial={{ opacity: 0, y: 10 }}\n                              animate={{ opacity: 1, y: 0 }}\n                              exit={{ opacity: 0, y: 10 }}\n                              className=\"absolute z-10 left-0 right-0 top-full mt-2 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden max-h-60 overflow-y-auto\"\n                            >\n                              <div className=\"px-3 py-2 text-xs font-medium text-slate-400 bg-slate-50 dark:bg-slate-900/50 border-b border-slate-100 dark:border-slate-800\">\n                                {tagInput ? '搜索结果' : '热门推荐'}\n                              </div>\n                              {suggestions.map((suggestion) => (\n                                <button\n                                  key={suggestion.name}\n                                  type=\"button\"\n                                  onClick={() => handleAddTag(suggestion.name)}\n                                  className=\"w-full px-4 py-2.5 flex items-center justify-between text-left hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors group\"\n                                >\n                                  <span className=\"text-sm text-slate-700 dark:text-slate-300 font-medium group-hover:text-emerald-600 dark:group-hover:text-emerald-400\">\n                                    #{suggestion.name}\n                                  </span>\n                                  {suggestion.count > 0 && (\n                                    <span className=\"flex items-center gap-1 text-xs text-slate-400 group-hover:text-orange-500\">\n                                      <Flame size={12} />\n                                      {suggestion.count}\n                                    </span>\n                                  )}\n                                </button>\n                              ))}\n                            </motion.div>\n                          )}\n                        </AnimatePresence>\n                      </div>\n                    </div>\n                    )}\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\n                        {isAlbum ? '描述' : '内容'}\n                      </label>\n                      <MarkdownEditor\n                        value={content}\n                        onChange={setContent}\n                        placeholder={isAlbum ? \"介绍一下这个相册...\" : \"分享你的想法... (支持Markdown和图片粘贴)\"}\n                        minHeight=\"min-h-[300px]\"\n                      />\n                    </div>\n                  </form>\n                </div>\n\n                <div className=\"p-4 border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3 bg-slate-50 dark:bg-slate-800/50 rounded-b-2xl\">\n                  <button\n                    type=\"button\"\n                    onClick={onClose}\n                    className=\"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors font-medium\"\n                  >\n                    取消\n                  </button>\n                  <button\n                    type=\"submit\"\n                    form=\"create-post-form\"\n                    disabled={isSubmitting || !title.trim() || !content.trim()}\n                    className=\"flex items-center gap-2 px-6 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/20 transition-all font-medium\"\n                  >\n                    {isSubmitting ? (\n                      <>\n                        <Loader2 size={18} className=\"animate-spin\" /> {isEditing ? '保存中...' : '发布中...'}\n                      </>\n                    ) : (\n                      <>\n                        {isEditing ? <Save size={18} /> : <Send size={18} />} {isEditing ? '保存修改' : '发布动态'}\n                      </>\n                    )}\n                  </button>\n                </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n    </ModalPortal>\n  );\n};\n\nexport default CreatePostModal;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;AAoBA,MAAM,kBAAkD,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE;;IAC3F,MAAM,EAAE,OAAO,gBAAgB,EAAE,GAAG,CAAA,GAAA,sIAAA,CAAA,sBAAmB,AAAD;IACtD,MAAM,EAAE,OAAO,EAAE,GAAG,CAAA,GAAA,kIAAA,CAAA,WAAQ,AAAD;IAC3B,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,mBAAmB;IACnB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IAC7C,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAmC,EAAE;IAClF,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,WAAW,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAoB;IAC1C,MAAM,iBAAiB,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAkB;IAE9C,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACjD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAElD,MAAM,YAAY,CAAC,CAAC;IACpB,MAAM,UAAU,MAAM,SAAS;IAE/B,gDAAgD;IAChD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,UAAU,MAAM;YAClB,SAAS,KAAK,KAAK;YACnB,WAAW,KAAK,OAAO;YACvB,QAAQ,KAAK,IAAI,IAAI,EAAE;QACzB,OAAO,IAAI,UAAU,CAAC,MAAM;YAC1B,wBAAwB;YACxB,SAAS;YACT,WAAW;YACX,QAAQ,EAAE;YACV,YAAY;QACd;IACF,GAAG;QAAC;QAAQ;KAAK;IAEjB,+EAA+E;IAC/E,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,SAAS,QAAQ,qBAAqB;QAE1C,MAAM,mBAAmB;YACrB,IAAI;gBACA,qDAAqD;gBACrD,gDAAgD;gBAChD,MAAM,MAAM,MAAM,CAAA,GAAA,8HAAA,CAAA,eAAY,AAAD,EAAE;gBAC/B,mCAAmC;gBACnC,eAAe,IAAI,MAAM,CAAC,CAAA,IAAK,CAAC,KAAK,QAAQ,CAAC,EAAE,IAAI;YACxD,EAAE,OAAO,GAAG;gBACR,QAAQ,KAAK,CAAC;YAClB;QACJ;QAEA,IAAI,QAAQ;YACR,MAAM,QAAQ,WAAW,kBAAkB;YAC3C,OAAO,IAAM,aAAa;QAC9B;IACF,GAAG;QAAC;QAAU;QAAM;QAAQ;KAAQ;IAEpC,qCAAqC;IACrC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,qBAAqB,CAAC;YAC1B,IAAI,eAAe,OAAO,IAAI,CAAC,eAAe,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,KACvE,SAAS,OAAO,IAAI,CAAC,SAAS,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;gBACxE,mBAAmB;YACrB;QACF;QACA,SAAS,gBAAgB,CAAC,aAAa;QACvC,OAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;IACzD,GAAG,EAAE;IAEL,MAAM,eAAe,CAAC;QACpB,MAAM,WAAW,SAAS,IAAI,GAAG,OAAO,CAAC,MAAM;QAC/C,IAAI,YAAY,CAAC,KAAK,QAAQ,CAAC,aAAa,KAAK,MAAM,GAAG,IAAI;YAC5D,QAAQ;mBAAI;gBAAM;aAAS;YAC3B,YAAY;YACZ,mBAAmB;QACrB;IACF;IAEA,MAAM,kBAAkB,CAAC;QACvB,QAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,MAAM;IACjC;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,SAAS;YACrB,EAAE,cAAc,IAAI,0BAA0B;YAC9C,IAAI,SAAS,IAAI,IAAI;gBACnB,aAAa;YACf;QACF,OAAO,IAAI,EAAE,GAAG,KAAK,eAAe,CAAC,YAAY,KAAK,MAAM,GAAG,GAAG;YAChE,oCAAoC;YACpC,gBAAgB,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE;QACvC;IACF;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,IAAI,IAAI;QAEtC,IAAI,qBAAqB,QAAQ,mBAAmB,GAAG;YACrD,QAAQ;YACR;QACF;QAEA,gBAAgB;QAChB,SAAS;QACT,IAAI;YACF,IAAI;YAEJ,IAAI,aAAa,MAAM;gBACrB,IAAI,SAAS;oBACT,eAAe;oBACf,SAAS,MAAM,CAAA,GAAA,2HAAA,CAAA,cAAW,AAAD,EAAE,KAAK,EAAE,EAAE;wBAChC;wBACA,aAAa,QAAQ,6BAA6B;oBACtD;gBACJ,OAAO;oBACH,cAAc;oBACd,mCAAmC;oBACnC,MAAM,cAAc,CAAC,QAAQ,KAAK,CAAC,yBAAyB,EAAE,EACzD,GAAG,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,MAAM;oBAC9B,oBAAoB;oBACpB,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,IAAI;2BAAI;2BAAS;qBAAY;oBAE9D,+CAA+C;oBAC/C,MAAM,eAAe,QAAQ,KAAK,CAAC,yBAAyB,EAAE;oBAC9D,MAAM,SAAS,aAAa,GAAG,CAAC,CAAA;wBAC5B,MAAM,WAAW,MAAM,KAAK,CAAC;wBAC7B,OAAO,WAAW,QAAQ,CAAC,EAAE,GAAG;oBACpC,GAAG,MAAM,CAAC,CAAA,MAAO;oBAEjB,SAAS,MAAM,CAAA,GAAA,8HAAA,CAAA,aAAU,AAAD,EAAE,KAAK,EAAE,EAAE;wBAC/B;wBACA;wBACA,MAAM;wBACN;oBACJ;gBACJ;YACF,OAAO;gBACL,cAAc;gBACd,mCAAmC;gBACnC,MAAM,cAAc,CAAC,QAAQ,KAAK,CAAC,yBAAyB,EAAE,EACzD,GAAG,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,MAAM;gBAC9B,oBAAoB;gBACpB,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,IAAI;uBAAI;uBAAS;iBAAY;gBAE9D,+CAA+C;gBAC/C,MAAM,eAAe,QAAQ,KAAK,CAAC,yBAAyB,EAAE;gBAC9D,MAAM,SAAS,aAAa,GAAG,CAAC,CAAA;oBAC5B,MAAM,WAAW,MAAM,KAAK,CAAC;oBAC7B,OAAO,WAAW,QAAQ,CAAC,EAAE,GAAG;gBACpC,GAAG,MAAM,CAAC,CAAA,MAAO;gBAEjB,SAAS,MAAM,CAAA,GAAA,8HAAA,CAAA,aAAU,AAAD,EAAE;oBAAE;oBAAO;oBAAS,MAAM;oBAAW;gBAAO;YACtE;YAEA,UAAU;YAEV,aAAa;YACb,SAAS;YACT,WAAW;YACX,QAAQ,EAAE;YACV,YAAY;YACZ;QACF,EAAE,OAAO,KAAK;YACZ,SAAS,YAAY,aAAa;YAClC,QAAQ,KAAK,CAAC;QAChB,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,MAAM,aAAa,YACd,UAAU,SAAS,SACpB;IAEJ,qBACE,6LAAC,oIAAA,CAAA,UAAW;kBACZ,cAAA,6LAAC,4LAAA,CAAA,kBAAe;sBACb,wBACC;;kCACE,6LAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;wBACT,SAAS;4BAAE,SAAS;wBAAE;wBACtB,SAAS;4BAAE,SAAS;wBAAE;wBACtB,MAAM;4BAAE,SAAS;wBAAE;wBACnB,SAAS;wBACT,WAAU;;;;;;kCAEZ,6LAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;wBACT,SAAS;4BAAE,SAAS;4BAAG,OAAO;4BAAM,GAAG;wBAAG;wBAC1C,SAAS;4BAAE,SAAS;4BAAG,OAAO;4BAAG,GAAG;wBAAE;wBACtC,MAAM;4BAAE,SAAS;4BAAG,OAAO;4BAAM,GAAG;wBAAG;wBACvC,WAAU;wBACV,SAAS,CAAC,IAAM,EAAE,MAAM,KAAK,EAAE,aAAa,IAAI;kCAEhD,cAAA,6LAAC;4BAAI,WAAU;4BAAyG,SAAS,CAAA,IAAK,EAAE,eAAe;;8CACrJ,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAG,WAAU;sDAAoD;;;;;;sDAClE,6LAAC;4CAAO,SAAS;4CAAS,WAAU;sDAClC,cAAA,6LAAC,+LAAA,CAAA,IAAC;gDAAC,MAAM;;;;;;;;;;;;;;;;;8CAIb,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCAAK,IAAG;wCAAmB,UAAU;wCAAc,WAAU;;4CACzD,uBACC,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;wDAAK,WAAU;;;;;;oDACf;;;;;;;0DAIL,6LAAC;;kEACC,6LAAC;wDAAM,WAAU;kEAAoE;;;;;;kEAGrF,6LAAC;wDACC,MAAK;wDACL,OAAO;wDACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wDACxC,aAAa,UAAU,SAAS;wDAChC,WAAU;wDACV,WAAW;;;;;;;;;;;;4CAId,CAAC,yBACF,6LAAC;;kEACC,6LAAC;wDAAM,WAAU;;4DAAoE;0EAC9E,6LAAC;gEAAK,WAAU;0EAA0C;;;;;;;;;;;;kEAGjE,6LAAC;wDAAI,WAAU;;0EACb,6LAAC;gEAAI,WAAU;;kFACb,6LAAC,4LAAA,CAAA,kBAAe;wEAAC,MAAK;kFACnB,KAAK,GAAG,CAAC,CAAA,oBACR,6LAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;gFACT,MAAM;gFACN,SAAS;oFAAE,OAAO;oFAAK,SAAS;gFAAE;gFAClC,SAAS;oFAAE,OAAO;oFAAG,SAAS;gFAAE;gFAChC,MAAM;oFAAE,OAAO;oFAAK,SAAS;gFAAE;gFAE/B,WAAU;;kGAEV,6LAAC;wFAAK,WAAU;;4FAAsB;4FAAE;;;;;;;kGACxC,6LAAC;wFACC,MAAK;wFACL,SAAS,IAAM,gBAAgB;wFAC/B,WAAU;kGAEV,cAAA,6LAAC,+LAAA,CAAA,IAAC;4FAAC,MAAM;;;;;;;;;;;;+EATN;;;;;;;;;;kFAeX,6LAAC;wEAAI,WAAU;kFACZ,cAAA,6LAAC;4EACC,KAAK;4EACL,MAAK;4EACL,OAAO;4EACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;4EAC3C,WAAW;4EACX,SAAS,IAAM,mBAAmB;4EAClC,aAAa,KAAK,MAAM,KAAK,IAAI,oBAAoB;4EACrD,WAAU;;;;;;;;;;;;;;;;;0EAMjB,6LAAC,4LAAA,CAAA,kBAAe;0EACb,mBAAmB,YAAY,MAAM,GAAG,mBACvC,6LAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;oEACT,KAAK;oEACL,SAAS;wEAAE,SAAS;wEAAG,GAAG;oEAAG;oEAC7B,SAAS;wEAAE,SAAS;wEAAG,GAAG;oEAAE;oEAC5B,MAAM;wEAAE,SAAS;wEAAG,GAAG;oEAAG;oEAC1B,WAAU;;sFAEV,6LAAC;4EAAI,WAAU;sFACZ,WAAW,SAAS;;;;;;wEAEtB,YAAY,GAAG,CAAC,CAAC,2BAChB,6LAAC;gFAEC,MAAK;gFACL,SAAS,IAAM,aAAa,WAAW,IAAI;gFAC3C,WAAU;;kGAEV,6LAAC;wFAAK,WAAU;;4FAAwH;4FACpI,WAAW,IAAI;;;;;;;oFAElB,WAAW,KAAK,GAAG,mBAClB,6LAAC;wFAAK,WAAU;;0GACd,6LAAC,uMAAA,CAAA,QAAK;gGAAC,MAAM;;;;;;4FACZ,WAAW,KAAK;;;;;;;;+EAXhB,WAAW,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;0DAuBlC,6LAAC;;kEACC,6LAAC;wDAAM,WAAU;kEACd,UAAU,OAAO;;;;;;kEAEpB,6LAAC,uIAAA,CAAA,UAAc;wDACb,OAAO;wDACP,UAAU;wDACV,aAAa,UAAU,gBAAgB;wDACvC,WAAU;;;;;;;;;;;;;;;;;;;;;;;8CAMlB,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CACC,MAAK;4CACL,SAAS;4CACT,WAAU;sDACX;;;;;;sDAGD,6LAAC;4CACC,MAAK;4CACL,MAAK;4CACL,UAAU,gBAAgB,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,IAAI;4CACxD,WAAU;sDAET,6BACC;;kEACE,6LAAC,oNAAA,CAAA,UAAO;wDAAC,MAAM;wDAAI,WAAU;;;;;;oDAAiB;oDAAE,YAAY,WAAW;;6EAGzE;;oDACG,0BAAY,6LAAC,qMAAA,CAAA,OAAI;wDAAC,MAAM;;;;;6EAAS,6LAAC,qMAAA,CAAA,OAAI;wDAAC,MAAM;;;;;;oDAAO;oDAAE,YAAY,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYpG;GAjWM;;QACgC,sIAAA,CAAA,sBAAmB;QACnC,kIAAA,CAAA,WAAQ;;;KAFxB;uCAmWS"}},
    {"offset": {"line": 1119, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1124, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/next/MentionInput.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport api from '@/utils/api';\nimport { Loader2 } from 'lucide-react';\n\ninterface User {\n  username: string;\n  avatar?: string;\n}\n\ninterface MentionInputProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  value: string;\n  onChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => void;\n  containerClassName?: string;\n}\n\nconst MentionInput = React.forwardRef<HTMLTextAreaElement, MentionInputProps>(({ \n  value, \n  onChange, \n  className,\n  containerClassName,\n  ...props \n}, ref) => {\n  const [users, setUsers] = useState<User[]>([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [suggestionIndex, setSuggestionIndex] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [query, setQuery] = useState('');\n  const [mentionStart, setMentionStart] = useState(-1);\n  \n  const innerRef = useRef<HTMLTextAreaElement>(null);\n  const suggestionsRef = useRef<HTMLDivElement>(null);\n\n  // Combine refs\n  useEffect(() => {\n    if (!ref) return;\n    if (typeof ref === 'function') {\n      ref(innerRef.current);\n    } else {\n      (ref as React.MutableRefObject<HTMLTextAreaElement | null>).current = innerRef.current;\n    }\n  }, [ref]);\n\n  useEffect(() => {\n    if (props.autoFocus && innerRef.current) {\n      // Small timeout to allow for transitions/animations to start\n      const timer = setTimeout(() => {\n        innerRef.current?.focus();\n      }, 50);\n      return () => clearTimeout(timer);\n    }\n  }, [props.autoFocus]);\n\n  useEffect(() => {\n    if (!showSuggestions) return;\n\n    const fetchUsers = async () => {\n      setLoading(true);\n      try {\n        const res = await api.get(`/api/profile/search?q=${query}`);\n        setUsers(res.data);\n        setSuggestionIndex(0);\n      } catch (err) {\n        console.error(\"Failed to search users\", err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    const timeoutId = setTimeout(fetchUsers, 300);\n    return () => clearTimeout(timeoutId);\n  }, [query, showSuggestions]);\n\n  const handleInput = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    onChange(e);\n    \n    const val = e.target.value;\n    const cursorPos = e.target.selectionStart;\n    \n    // Check for mention trigger\n    // We look backwards from cursor\n    let found = false;\n    for (let i = cursorPos - 1; i >= 0; i--) {\n      const char = val[i];\n      if (char === '@') {\n        // Check if it's a valid start (beginning of line or preceded by space)\n        if (i === 0 || /\\s/.test(val[i - 1])) {\n           const potentialQuery = val.substring(i + 1, cursorPos);\n           // If query contains space, stop (unless we want to support spaces in names, but our username rules don't allow it usually)\n           if (!/\\s/.test(potentialQuery)) {\n             setMentionStart(i);\n             setQuery(potentialQuery);\n             setShowSuggestions(true);\n             found = true;\n           }\n        }\n        break;\n      }\n      if (/\\s/.test(char)) {\n        // Stop if we hit a space before finding @\n        break;\n      }\n    }\n    \n    if (!found) {\n      setShowSuggestions(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (showSuggestions && users.length > 0) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSuggestionIndex(prev => (prev + 1) % users.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSuggestionIndex(prev => (prev - 1 + users.length) % users.length);\n      } else if (e.key === 'Enter' || e.key === 'Tab') {\n        e.preventDefault();\n        selectUser(users[suggestionIndex]);\n      } else if (e.key === 'Escape') {\n        setShowSuggestions(false);\n      }\n    }\n  };\n\n  const selectUser = (user: User) => {\n    if (mentionStart === -1) return;\n    \n    const before = value.substring(0, mentionStart);\n    // +1 for the @, and query.length\n    const after = value.substring(mentionStart + 1 + query.length);\n    \n    const newValue = `${before}@${user.username} ${after}`;\n    \n    // Create a synthetic event\n    const event = {\n      target: { value: newValue },\n      currentTarget: { value: newValue }\n    } as React.ChangeEvent<HTMLTextAreaElement>;\n    \n    onChange(event);\n    setShowSuggestions(false);\n    \n    // Restore focus and cursor (simple approximation)\n    setTimeout(() => {\n        if (innerRef.current) {\n            innerRef.current.focus();\n            const newCursorPos = mentionStart + 1 + user.username.length + 1;\n            innerRef.current.setSelectionRange(newCursorPos, newCursorPos);\n        }\n    }, 0);\n  };\n\n  return (\n    <div className={`relative ${containerClassName || ''}`}>\n      <textarea\n        ref={innerRef}\n        value={value}\n        onChange={handleInput}\n        onKeyDown={handleKeyDown}\n        className={className}\n        {...props}\n      />\n      \n      {showSuggestions && (\n        <div \n          ref={suggestionsRef}\n          className=\"absolute z-50 w-64 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden mt-1 left-0\"\n          style={{\n             top: \"100%\"\n          }}\n        >\n          {loading ? (\n            <div className=\"p-2 flex items-center justify-center text-slate-500\">\n               <Loader2 size={16} className=\"animate-spin mr-2\" /> 搜索中...\n            </div>\n          ) : users.length > 0 ? (\n            <ul className=\"max-h-48 overflow-y-auto\">\n              {users.map((user, index) => (\n                <li\n                  key={user.username}\n                  onClick={() => selectUser(user)}\n                  className={`flex items-center px-3 py-2 cursor-pointer transition-colors ${\n                    index === suggestionIndex \n                      ? 'bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400' \n                      : 'hover:bg-slate-50 dark:hover:bg-slate-700/50 text-slate-700 dark:text-slate-200'\n                  }`}\n                >\n                  <img \n                    src={user.avatar || `https://cravatar.eu/helmavatar/${user.username}/16.png`} \n                    alt={user.username} \n                    className=\"w-6 h-6 rounded-full mr-2\" \n                  />\n                  <span className=\"text-sm\">{user.username}</span>\n                </li>\n              ))}\n            </ul>\n          ) : (\n             <div className=\"p-2 text-center text-slate-500 text-xs\">\n                没有找到用户\n             </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n});\n\nexport default MentionInput;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1358, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1363, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/next/CommentSection.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { createPortal } from 'react-dom';\nimport Link from 'next/link';\nimport { formatDistanceToNow } from 'date-fns';\nimport { zhCN } from 'date-fns/locale';\nimport { MessageSquare, ThumbsUp, Trash2, MessageCircle, Send, X, MoreHorizontal, Loader2, Smile, Image as ImageIcon, AtSign } from 'lucide-react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport MentionInput from './MentionInput';\nimport clsx from 'clsx';\nimport api, { generateUploadHeaders } from '@/utils/api';\n\n// --- Types ---\nexport interface UIComment {\n  id: number;\n  content: string;\n  created_at: string | number;\n  author: {\n    username: string;\n    nickname?: string;\n    avatar?: string;\n    custom_title?: string;\n  };\n  replies?: UIComment[];\n  parent_id?: number;\n  likes_count?: number;\n  is_liked?: boolean;\n}\n\ninterface CommentSectionProps {\n  comments: UIComment[];\n  currentUser: any; // User object from context\n  onSubmit: (content: string, parentId?: number) => Promise<void>;\n  onDelete?: (commentId: number) => Promise<void>;\n  onLike?: (commentId: number) => Promise<void>;\n  loading?: boolean;\n  title?: string;\n  className?: string;\n  hideMainInput?: boolean;\n}\n\n// --- Helper Components ---\n\nconst formatCommentTime = (timestamp: string | number) => {\n  try {\n    if (!timestamp) return '刚刚';\n    \n    let date: Date;\n    \n    if (typeof timestamp === 'number') {\n        if (timestamp < 10000000000) {\n            date = new Date(timestamp * 1000);\n        } else {\n            date = new Date(timestamp);\n        }\n    } else {\n        const num = Number(timestamp);\n        if (!isNaN(num) && !isNaN(parseFloat(timestamp as string))) {\n             if (num < 10000000000) {\n                date = new Date(num * 1000);\n             } else {\n                date = new Date(num);\n             }\n        } else {\n             date = new Date(timestamp);\n        }\n    }\n\n    if (isNaN(date.getTime()) || date.getFullYear() < 2020) return '刚刚';\n    return formatDistanceToNow(date, { addSuffix: true, locale: zhCN }).replace('大约 ', '');\n  } catch (e) {\n    return '刚刚';\n  }\n};\n\nconst CommentImage = (props: any) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  return (\n    <>\n      <img \n        {...props} \n        className=\"max-w-full h-auto max-h-[300px] rounded-lg border border-slate-200 dark:border-slate-700 cursor-zoom-in transition-transform hover:scale-[1.02] object-contain bg-slate-50 dark:bg-slate-900/50 my-2\"\n        onClick={(e) => {\n          e.stopPropagation();\n          setIsOpen(true);\n        }}\n      />\n      {isOpen && mounted && createPortal(\n        <div \n          className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\"\n          onClick={(e) => {\n            e.stopPropagation();\n            setIsOpen(false);\n          }}\n        >\n          <div className=\"relative max-w-[90vw] max-h-[90vh]\">\n            <img \n              src={props.src} \n              alt={props.alt} \n              className=\"max-w-full max-h-[90vh] rounded-lg shadow-2xl animate-in zoom-in-95 duration-200 object-contain\"\n              onClick={(e) => e.stopPropagation()} \n            />\n            <button \n              className=\"absolute -top-12 right-0 p-2 text-white/70 hover:text-white bg-black/20 hover:bg-black/40 rounded-full transition-colors\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsOpen(false);\n              }}\n            >\n              <X size={24} />\n            </button>\n          </div>\n        </div>,\n        document.body\n      )}\n    </>\n  );\n};\n\nconst CommentContent = ({ content }: { content: string }) => {\n  const processed = content.replace(\n    /@([^ \\t\\n\\r\\f\\v@,.!?;:，。！？]+)/g, \n    (match, username) => `[${match}](/player/${username})`\n  );\n  \n  return (\n    <span className=\"prose dark:prose-invert prose-sm max-w-none text-slate-700 dark:text-slate-300 leading-relaxed break-words inline\">\n       <ReactMarkdown \n          remarkPlugins={[remarkGfm]}\n          components={{\n              a: ({node, ...props}) => (\n                <Link href={props.href || '#'} className=\"text-emerald-500 hover:underline\" onClick={(e) => e.stopPropagation()}>\n                  {props.children}\n                </Link>\n              ),\n              p: ({node, ...props}) => <span className=\"inline\" {...props} />,\n              img: CommentImage\n          }}\n       >\n         {processed}\n       </ReactMarkdown>\n    </span>\n  );\n};\n\nconst COMMON_EMOJIS = ['😀', '😂', '🤣', '😍', '🥰', '😎', '🤔', '😭', '👍', '👎', '🎉', '🔥', '❤️', '👀', '✨'];\n\nconst CommentInput = ({ \n  onSubmit, \n  placeholder = \"发表评论...\", \n  buttonText = \"发表评论\",\n  autoFocus = false,\n  onCancel\n}: { \n  onSubmit: (content: string) => Promise<void>, \n  placeholder?: string, \n  buttonText?: string,\n  autoFocus?: boolean,\n  onCancel?: () => void\n}) => {\n  const [content, setContent] = useState('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isFocused, setIsFocused] = useState(false);\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n  const [uploadedImages, setUploadedImages] = useState<string[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n  \n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const emojiButtonRef = useRef<HTMLButtonElement>(null);\n  const [emojiPickerPos, setEmojiPickerPos] = useState({ top: 0, left: 0 });\n\n  const updateEmojiPickerPos = () => {\n    if (emojiButtonRef.current) {\n        const rect = emojiButtonRef.current.getBoundingClientRect();\n        setEmojiPickerPos({\n            top: rect.top + window.scrollY - 310, \n            left: rect.left + window.scrollX\n        });\n    }\n  };\n\n  useEffect(() => {\n    if (showEmojiPicker) {\n        updateEmojiPickerPos();\n        window.addEventListener('resize', updateEmojiPickerPos);\n        window.addEventListener('scroll', updateEmojiPickerPos, true);\n    }\n    return () => {\n        window.removeEventListener('resize', updateEmojiPickerPos);\n        window.removeEventListener('scroll', updateEmojiPickerPos, true);\n    };\n  }, [showEmojiPicker]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!content.trim() && uploadedImages.length === 0) return;\n    \n    setIsSubmitting(true);\n    try {\n      let finalContent = content;\n      if (uploadedImages.length > 0) {\n          finalContent += '\\n\\n' + uploadedImages.map(url => `![](${url})`).join('\\n');\n      }\n      \n      await onSubmit(finalContent);\n      setContent('');\n      setUploadedImages([]);\n      if (onCancel) onCancel();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const insertText = (text: string, selectionOffset = 0) => {\n    const textarea = textareaRef.current;\n    if (!textarea) {\n        setContent(prev => prev + text);\n        return;\n    }\n\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const newContent = content.substring(0, start) + text + content.substring(end);\n    \n    setContent(newContent);\n    \n    setTimeout(() => {\n        textarea.focus();\n        const newCursorPos = start + text.length + selectionOffset;\n        textarea.setSelectionRange(newCursorPos, newCursorPos);\n    }, 0);\n  };\n  \n  const handleEmojiClick = (emoji: string) => {\n    insertText(emoji);\n    setShowEmojiPicker(false);\n  };\n\n  const handleImageClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件');\n        return;\n    }\n    \n    setIsUploading(true);\n    \n    try {\n        const formData = new FormData();\n        formData.append('file', file);\n        const securityHeaders = await generateUploadHeaders();\n        \n        const res = await api.post('/api/upload/image', formData, {\n             headers: {\n                'Content-Type': 'multipart/form-data',\n                ...securityHeaders\n             }\n        });\n        \n        setUploadedImages(prev => [...prev, res.data.url]);\n        \n    } catch (error) {\n        console.error(error);\n        alert('图片上传失败');\n    } finally {\n        setIsUploading(false);\n        if (fileInputRef.current) fileInputRef.current.value = '';\n    }\n  };\n\n  const removeImage = (index: number) => {\n    setUploadedImages(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleMentionClick = () => {\n      insertText('@');\n  };\n\n  const isExpanded = isFocused || content.trim().length > 0 || uploadedImages.length > 0;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"relative group\">\n      <input\n        type=\"file\"\n        ref={fileInputRef}\n        onChange={handleFileChange}\n        accept=\"image/*\"\n        className=\"hidden\"\n      />\n      <div className={clsx(\n        \"relative rounded-2xl transition-all duration-300\",\n        isFocused \n          ? \"bg-white dark:bg-slate-900 border border-emerald-500/50 dark:border-emerald-500/50\" \n          : \"bg-slate-50 dark:bg-slate-900/30 hover:bg-white dark:hover:bg-slate-900 border border-slate-200 dark:border-slate-800\"\n      )}>\n        <MentionInput\n          ref={textareaRef}\n          value={content}\n          onChange={(e) => setContent(e.target.value)}\n          placeholder={placeholder}\n          autoFocus={autoFocus}\n          onFocus={() => setIsFocused(true)}\n          onBlur={() => setIsFocused(false)}\n          className={clsx(\n            \"w-full bg-transparent border-none outline-none resize-none text-slate-900 dark:text-white text-base placeholder:text-slate-400/80 p-5 transition-all duration-300 ease-in-out\",\n            \"custom-scrollbar\",\n            \"min-h-[60px]\"\n          )}\n        />\n        \n        {/* Image Previews */}\n        {uploadedImages.length > 0 && (\n            <div className=\"px-5 pb-3 flex flex-wrap gap-2\">\n                {uploadedImages.map((url, index) => (\n                    <div key={index} className=\"relative group/image\">\n                        <img \n                            src={url} \n                            alt=\"Uploaded preview\" \n                            className=\"w-20 h-20 object-cover rounded-lg border border-slate-200 dark:border-slate-700\"\n                        />\n                        <button\n                            type=\"button\"\n                            onClick={() => removeImage(index)}\n                            className=\"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover/image:opacity-100 transition-opacity shadow-sm\"\n                        >\n                            <X size={12} />\n                        </button>\n                    </div>\n                ))}\n            </div>\n        )}\n        \n        {/* Toolbar & Actions */}\n        <div className={clsx(\n            \"flex items-center justify-between px-4 overflow-hidden transition-all duration-300 ease-in-out border-t\",\n            isExpanded \n                ? \"max-h-[60px] py-3 opacity-100 border-slate-100 dark:border-slate-800/50\" \n                : \"max-h-0 py-0 opacity-0 border-transparent\",\n            isFocused ? \"bg-slate-50/50 dark:bg-slate-900/50\" : \"bg-transparent\",\n            \"rounded-b-2xl\"\n        )}>\n            {/* Left: Tools */}\n            <div className=\"flex items-center gap-1 relative\">\n                <button \n                    ref={emojiButtonRef}\n                    type=\"button\" \n                    onMouseDown={(e) => {\n                        e.preventDefault();\n                        setShowEmojiPicker(!showEmojiPicker);\n                    }}\n                    className={clsx(\n                        \"p-2 rounded-full transition-colors relative\",\n                        showEmojiPicker \n                            ? \"text-emerald-500 bg-emerald-50 dark:bg-emerald-500/10\" \n                            : \"text-slate-400 hover:text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10\"\n                    )}\n                    title=\"表情\"\n                >\n                    <Smile size={20} />\n                </button>\n                \n                <button \n                    type=\"button\" \n                    onMouseDown={(e) => {\n                        e.preventDefault();\n                        handleImageClick();\n                    }}\n                    disabled={isUploading}\n                    className={clsx(\n                        \"p-2 rounded-full transition-colors\",\n                        isUploading \n                            ? \"text-emerald-500 bg-emerald-50 dark:bg-emerald-500/10 animate-pulse cursor-wait\" \n                            : \"text-slate-400 hover:text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10\"\n                    )}\n                    title=\"图片\"\n                >\n                    {isUploading ? <Loader2 size={20} className=\"animate-spin\" /> : <ImageIcon size={20} />}\n                </button>\n                <button \n                    type=\"button\" \n                    onMouseDown={(e) => {\n                        e.preventDefault();\n                        handleMentionClick();\n                    }}\n                    className=\"p-2 text-slate-400 hover:text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10 rounded-full transition-colors\" \n                    title=\"提及\"\n                >\n                    <AtSign size={20} />\n                </button>\n            </div>\n\n            {/* Right: Actions */}\n            <div className=\"flex items-center gap-3\">\n                {onCancel && (\n                    <button \n                        type=\"button\"\n                        onClick={onCancel}\n                        className=\"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 text-sm font-medium px-3 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\"\n                    >\n                        取消\n                    </button>\n                )}\n                <button\n                    type=\"submit\"\n                    disabled={isSubmitting || (!content.trim() && uploadedImages.length === 0)}\n                    className={clsx(\n                        \"flex items-center gap-2 px-5 py-2 rounded-xl text-sm font-bold text-white transition-all duration-300 shadow-md\",\n                        (content.trim() || uploadedImages.length > 0)\n                        ? \"bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 hover:shadow-lg hover:shadow-emerald-500/20 active:scale-95 translate-y-0\" \n                        : \"bg-slate-300 dark:bg-slate-700 text-slate-100 cursor-not-allowed shadow-none\"\n                    )}\n                >\n                    {isSubmitting ? <Loader2 size={18} className=\"animate-spin\" /> : <Send size={18} />}\n                    <span>{isSubmitting ? '发送中...' : buttonText}</span>\n                </button>\n            </div>\n        </div>\n        \n        {/* Emoji Picker Portal */}\n        {showEmojiPicker && mounted && createPortal(\n            <>\n                <div \n                    className=\"fixed inset-0 z-[9998]\" \n                    onClick={() => setShowEmojiPicker(false)} \n                />\n                <div \n                    className=\"fixed z-[9999] p-3 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 grid grid-cols-6 gap-2 w-72 animate-in fade-in zoom-in-95 duration-200\"\n                    style={{\n                        top: emojiPickerPos.top,\n                        left: emojiPickerPos.left\n                    }}\n                >\n                    {COMMON_EMOJIS.map(emoji => (\n                        <button\n                            key={emoji}\n                            type=\"button\"\n                            onMouseDown={(e) => e.preventDefault()}\n                            onClick={() => handleEmojiClick(emoji)}\n                            className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg text-xl transition-colors flex items-center justify-center\"\n                        >\n                            {emoji}\n                        </button>\n                    ))}\n                </div>\n            </>,\n            document.body\n        )}\n      </div>\n    </form>\n  );\n};\n\nconst CommentItem = ({ \n  comment, \n  currentUser, \n  onReply, \n  replyingToId,\n  onSubmitReply,\n  onDelete, \n  onLike,\n  depth = 0 \n}: { \n  comment: UIComment, \n  currentUser: any, \n  onReply: (comment: UIComment | null) => void,\n  replyingToId: number | null,\n  onSubmitReply: (content: string) => Promise<void>,\n  onDelete?: (id: number) => void,\n  onLike?: (id: number) => void,\n  depth?: number\n}) => {\n  const isOwner = currentUser && (currentUser.username === comment.author.username || currentUser.role === 'admin');\n  const isReplying = replyingToId === comment.id;\n\n  // Common Reply Input Area\n  const replyInputArea = (\n    <div \n      className={clsx(\n        \"grid transition-[grid-template-rows] duration-300 ease-in-out\",\n        isReplying ? \"grid-rows-[1fr]\" : \"grid-rows-[0fr]\"\n      )}\n    >\n       <div className=\"overflow-hidden\">\n           <div className={clsx(\n               \"transition-all duration-300 transform origin-top\",\n               isReplying ? \"opacity-100 translate-y-0 pt-4 pb-2\" : \"opacity-0 -translate-y-4 pt-0 pb-0\"\n           )}>\n               <div className=\"flex gap-3\">\n                   <img \n                      src={currentUser?.avatar || `https://cravatar.eu/helmavatar/${currentUser?.username}/64.png`}\n                      alt=\"Current User\"\n                      className=\"w-8 h-8 rounded-lg bg-slate-100 object-cover hidden sm:block border border-slate-200 dark:border-slate-700\"\n                   />\n                   <div className=\"flex-1\">\n                      <CommentInput \n                          onSubmit={onSubmitReply}\n                          placeholder={`回复 @${comment.author.nickname || comment.author.username}...`}\n                          buttonText=\"回复\"\n                          autoFocus={isReplying}\n                          onCancel={() => onReply(null)}\n                      />\n                   </div>\n              </div>\n          </div>\n       </div>\n    </div>\n  );\n\n  // Main Comment Style\n  if (depth === 0) {\n    return (\n      <div className=\"flex gap-4 group\">\n        <Link href={`/player/${comment.author.username}`} className=\"flex-shrink-0\">\n          <img \n            src={comment.author.avatar || `https://cravatar.eu/helmavatar/${comment.author.username}/64.png`}\n            alt={comment.author.username}\n            className=\"w-10 h-10 rounded-xl bg-slate-100 object-cover border border-slate-200 dark:border-slate-700 transition-all hover:scale-105\"\n          />\n        </Link>\n        \n        <div className=\"flex-1 min-w-0\">\n          {/* Header: Name and Badges */}\n          <div className=\"flex items-center gap-2 mb-1\">\n            <Link \n              href={`/player/${comment.author.username}`} \n              className=\"font-bold text-slate-900 dark:text-white hover:text-emerald-500 transition-colors text-sm\"\n            >\n              {comment.author.nickname || comment.author.username}\n            </Link>\n            \n            {comment.author.custom_title && comment.author.custom_title !== '玩家' && (\n               <span className=\"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50\">\n                 {comment.author.custom_title}\n               </span>\n            )}\n          </div>\n\n          {/* Content */}\n          <div className=\"mb-2\">\n            <div className=\"prose dark:prose-invert prose-sm max-w-none text-slate-700 dark:text-slate-300 leading-relaxed break-words\">\n                <ReactMarkdown \n                    remarkPlugins={[remarkGfm]}\n                    components={{\n                        a: ({node, ...props}) => (\n                        <Link href={props.href || '#'} className=\"text-emerald-500 hover:underline\" onClick={(e) => e.stopPropagation()}>\n                            {props.children}\n                        </Link>\n                        ),\n                        p: ({node, ...props}) => <p className=\"mb-1 last:mb-0\" {...props} />,\n                        img: CommentImage\n                    }}\n                >\n                    {comment.content.replace(\n                        /@([^ \\t\\n\\r\\f\\v@,.!?;:，。！？]+)/g, \n                        (match, username) => `[${match}](/player/${username})`\n                    )}\n                </ReactMarkdown>\n            </div>\n          </div>\n\n          {/* Action Bar */}\n          <div className=\"flex items-center gap-4 text-xs text-slate-400 mb-3\">\n            <span>{formatCommentTime(comment.created_at)}</span>\n            \n            {onLike && (\n              <button \n                onClick={() => onLike(comment.id)}\n                className=\"flex items-center gap-1 hover:text-emerald-500 transition-colors\"\n              >\n                <ThumbsUp size={12} />\n                <span>{comment.likes_count || 0}</span>\n              </button>\n            )}\n\n            <button \n              onClick={() => onReply(isReplying ? null : comment)}\n              className={clsx(\n                \"transition-all duration-200 px-2 py-0.5 rounded-md -ml-2\",\n                isReplying \n                  ? \"bg-emerald-50 text-emerald-600 dark:bg-emerald-500/10 dark:text-emerald-400\" \n                  : \"hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-emerald-500\"\n              )}\n            >\n              {isReplying ? '取消回复' : '回复'}\n            </button>\n\n            {isOwner && onDelete && (\n              <button \n                onClick={() => onDelete(comment.id)}\n                className=\"hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100\"\n              >\n                删除\n              </button>\n            )}\n          </div>\n\n          {/* Inline Reply Input */}\n          {replyInputArea}\n\n          {/* Nested Replies Container - Rendered Inside */}\n          {comment.replies && comment.replies.length > 0 && (\n            <div className=\"space-y-3\">\n              {comment.replies.map(reply => (\n                <CommentItem \n                  key={reply.id} \n                  comment={reply} \n                  currentUser={currentUser}\n                  onReply={onReply}\n                  replyingToId={replyingToId}\n                  onSubmitReply={onSubmitReply}\n                  onDelete={onDelete}\n                  onLike={onLike}\n                  depth={depth + 1}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Reply Style (Compact)\n  return (\n    <div className=\"flex gap-2 group\">\n      <Link href={`/player/${comment.author.username}`} className=\"flex-shrink-0 mt-0.5\">\n        <img \n          src={comment.author.avatar || `https://cravatar.eu/helmavatar/${comment.author.username}/64.png`}\n          alt={comment.author.username}\n          className=\"w-6 h-6 rounded-lg bg-slate-100 object-cover border border-slate-200 dark:border-slate-700 transition-all hover:scale-105\"\n        />\n      </Link>\n      \n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex flex-wrap items-baseline gap-x-2\">\n            <Link \n              href={`/player/${comment.author.username}`} \n              className=\"font-bold text-xs text-slate-700 dark:text-slate-200 hover:text-emerald-500 transition-colors\"\n            >\n              {comment.author.nickname || comment.author.username}\n            </Link>\n            \n            {comment.author.custom_title && comment.author.custom_title !== '玩家' && (\n               <span className=\"px-1 py-0 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50 scale-90 origin-left\">\n                 {comment.author.custom_title}\n               </span>\n            )}\n            \n            <span className=\"text-sm text-slate-800 dark:text-slate-300 break-words\">\n                 <span className=\"inline-block\"><CommentContent content={comment.content} /></span>\n            </span>\n        </div>\n\n        {/* Action Bar */}\n        <div className=\"flex items-center gap-4 text-xs text-slate-400 mt-1\">\n          <span>{formatCommentTime(comment.created_at)}</span>\n          \n          {onLike && (\n            <button \n              onClick={() => onLike(comment.id)}\n              className=\"flex items-center gap-1 hover:text-emerald-500 transition-colors\"\n            >\n              <ThumbsUp size={11} />\n              <span>{comment.likes_count || 0}</span>\n            </button>\n          )}\n\n          <button \n            onClick={() => onReply(isReplying ? null : comment)}\n            className={clsx(\n              \"transition-all duration-200 px-2 py-0.5 rounded-md -ml-2\",\n              isReplying \n                ? \"bg-emerald-50 text-emerald-600 dark:bg-emerald-500/10 dark:text-emerald-400\" \n                : \"hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-emerald-500\"\n            )}\n          >\n            {isReplying ? '取消回复' : '回复'}\n          </button>\n\n          {isOwner && onDelete && (\n            <button \n              onClick={() => onDelete(comment.id)}\n              className=\"hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100\"\n            >\n              删除\n            </button>\n          )}\n        </div>\n        \n        {/* Inline Reply Input */}\n        {replyInputArea}\n\n        {/* Nested Replies */}\n        {comment.replies && comment.replies.length > 0 && (\n            <div className=\"mt-2 space-y-2\">\n              {comment.replies.map(reply => (\n                <CommentItem \n                  key={reply.id} \n                  comment={reply} \n                  currentUser={currentUser}\n                  onReply={onReply}\n                  replyingToId={replyingToId}\n                  onSubmitReply={onSubmitReply}\n                  onDelete={onDelete}\n                  onLike={onLike}\n                  depth={depth + 1}\n                />\n              ))}\n            </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\n// --- Main Component ---\n\nconst CommentSection: React.FC<CommentSectionProps> = ({\n  comments,\n  currentUser,\n  onSubmit,\n  onDelete,\n  onLike,\n  loading = false,\n  title = \"评论\",\n  className,\n  hideMainInput = false\n}) => {\n  const [replyingTo, setReplyingTo] = useState<UIComment | null>(null);\n\n  const handleReplySubmit = async (content: string) => {\n    if (!replyingTo) return;\n    await onSubmit(content, replyingTo.id);\n    setReplyingTo(null);\n  };\n\n  const handleMainSubmit = async (content: string) => {\n    await onSubmit(content);\n  };\n\n  return (\n    <div className={clsx(\"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 sm:p-8\", className)}>\n      {/* Title */}\n      <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2\">\n        <MessageSquare className=\"text-emerald-500\" size={20} />\n        {title} <span className=\"text-slate-400 font-normal text-sm ml-1\">({comments.reduce((acc, c) => acc + 1 + (c.replies?.length || 0), 0)})</span>\n      </h3>\n\n      {/* Main Input */}\n      {!hideMainInput && (currentUser ? (\n        <div className=\"flex gap-4 mb-8\">\n           <img \n              src={currentUser.avatar || `https://cravatar.eu/helmavatar/${currentUser.username}/64.png`}\n              alt={currentUser.username}\n              className=\"w-10 h-10 rounded-xl bg-slate-100 border border-slate-200 dark:border-slate-700 flex-shrink-0\"\n            />\n            <div className=\"flex-1\">\n                <CommentInput onSubmit={handleMainSubmit} />\n            </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-6 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-dashed border-slate-300 dark:border-slate-700 mb-8\">\n            <p className=\"text-slate-500 mb-2 text-sm\">登录后参与讨论</p>\n            <Link href=\"/login\" className=\"text-emerald-500 font-medium hover:underline text-sm\">\n                立即登录\n            </Link>\n        </div>\n      ))}\n\n      {/* Comments List */}\n      <div>\n        {loading ? (\n           <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-emerald-500\" />\n           </div>\n        ) : comments.length === 0 ? (\n          <div className=\"text-center py-12 text-slate-500 text-sm\">\n            暂无评论，快来抢沙发吧！\n          </div>\n        ) : (\n          comments.map((comment, index) => (\n            <React.Fragment key={comment.id}>\n                {index > 0 && (\n                    <div className=\"h-px bg-slate-200 dark:bg-slate-700 my-4\"></div>\n                )}\n                <CommentItem \n                  comment={comment} \n                  currentUser={currentUser}\n                  onReply={setReplyingTo}\n                  replyingToId={replyingTo?.id || null}\n                  onSubmitReply={handleReplySubmit}\n                  onDelete={onDelete}\n                  onLike={onLike}\n                />\n            </React.Fragment>\n          ))\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CommentSection;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2533, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2538, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/next/PostCard.tsx"],"sourcesContent":["'use client';\n\nimport { useState, forwardRef } from 'react';\nimport Link from 'next/link';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { formatDistanceToNow } from 'date-fns';\nimport { zhCN } from 'date-fns/locale';\nimport { Heart, MessageSquare, Bookmark, Share2, Trash2, Check, Edit2, Send, X, Loader2 } from 'lucide-react';\nimport { Post, Comment } from '@/types/activity';\nimport { useAuth } from '@/context/AuthContext';\nimport { toggleLikePost, toggleCollectPost, deletePost } from '@/services/activity';\nimport { toggleLikeAlbum, toggleCollectAlbum, deleteAlbum, getAlbum, createAlbumComment } from '@/services/album';\nimport { followUser, unfollowUser } from '@/services/follow';\nimport clsx from 'clsx';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport CreatePostModal from './CreatePostModal';\nimport CommentSection, { UIComment } from './CommentSection';\nimport api from '@/utils/api';\nimport MentionInput from './MentionInput';\nimport { useCurrentUserLevel } from '@/hooks/useCurrentUserLevel';\nimport { useToast } from '@/context/ToastContext';\nimport { useConfirm } from '@/context/ConfirmContext';\n\ninterface PostCardProps {\n  post: Post;\n  onUpdate?: (updatedPost: Post) => void;\n  onDelete?: (postId: number) => void;\n  className?: string;\n  isDetail?: boolean; // New prop to distinguish detail view\n}\n\nconst PostCard = forwardRef<HTMLDivElement, PostCardProps>(({ post, onUpdate, onDelete, className, isDetail = false }, ref) => {\n  const { user, token } = useAuth();\n  const { level: currentUserLevel } = useCurrentUserLevel();\n  const { success, error, warning } = useToast();\n  const { confirm } = useConfirm();\n  const [isLiked, setIsLiked] = useState(post.is_liked);\n  const [likesCount, setLikesCount] = useState(post.likes_count);\n  const [isCollected, setIsCollected] = useState(post.is_collected);\n  const [collectsCount, setCollectsCount] = useState(post.collects_count);\n  const [isLikeLoading, setIsLikeLoading] = useState(false);\n  const [isCollectLoading, setIsCollectLoading] = useState(false);\n  const [isCopied, setIsCopied] = useState(false);\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n\n  const [isFollowing, setIsFollowing] = useState(post.author.is_following);\n  const [isFollowLoading, setIsFollowLoading] = useState(false);\n\n  // Comments & Expansion State\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [comments, setComments] = useState<Comment[]>([]);\n  const [loadingComments, setLoadingComments] = useState(false);\n  const [commentContent, setCommentContent] = useState('');\n  const [replyingTo, setReplyingTo] = useState<Comment | null>(null);\n  const [isSubmittingComment, setIsSubmittingComment] = useState(false);\n\n  const fetchComments = async (force: boolean = false) => {\n    if (comments.length > 0 && !force) return; // Already loaded and not forced\n    setLoadingComments(true);\n    try {\n      const config = token ? { headers: { Authorization: `Bearer ${token}` } } : {};\n      \n      let rawComments: Comment[] = [];\n      \n      if (post.type === 'album') {\n         // Album comments logic\n         const albumData = await getAlbum(post.id);\n         const albumComments = Array.isArray(albumData.comments) ? albumData.comments : [];\n         // Map flat album comments to Comment interface structure\n         rawComments = albumComments.map((c: any) => {\n            const commentAuthor = c.author || c.user || c;\n            return {\n                id: c.id,\n                post_id: post.id,\n                content: c.content,\n                created_at: c.created_at,\n                author: {\n                    username: commentAuthor.username || 'User',\n                    nickname: commentAuthor.nickname || commentAuthor.username || 'User',\n                    custom_title: commentAuthor.custom_title,\n                    avatar: commentAuthor.avatar\n                },\n                replies: []\n            };\n         });\n      } else {\n         // Standard post comments logic\n         const res = await api.get<Comment[]>(`/api/posts/${post.id}/comments`, config);\n         const responseData = res.data as any;\n         rawComments = (Array.isArray(responseData) ? responseData : (responseData.data || [])) as Comment[];\n      }\n      \n      const commentMap = new Map<number, Comment>();\n      const rootComments: Comment[] = [];\n\n      rawComments.forEach(c => {\n        commentMap.set(c.id, { ...c, replies: [] });\n      });\n\n      rawComments.forEach(c => {\n        const processedComment = commentMap.get(c.id)!;\n        if (c.parent_id) {\n          const parent = commentMap.get(c.parent_id);\n          if (parent) {\n            parent.replies?.push(processedComment);\n          } else {\n            rootComments.push(processedComment);\n          }\n        } else {\n          rootComments.push(processedComment);\n        }\n      });\n\n      rootComments.sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n      setComments(rootComments);\n    } catch (error) {\n      console.error('Failed to fetch comments:', error);\n    } finally {\n      setLoadingComments(false);\n    }\n  };\n\n  const handleToggleExpand = () => {\n    if (isDetail) return; // Don't expand in detail view (it's already full)\n    const newExpandedState = !isExpanded;\n    setIsExpanded(newExpandedState);\n    if (newExpandedState) {\n        fetchComments();\n    }\n  };\n\n  const handleNewCommentSubmit = async (content: string, parentId?: number) => {\n    if (!user) return;\n    if (currentUserLevel !== null && currentUserLevel < 5) {\n      warning('您的等级不足 5 级，无法评论。请前往游戏内升级！');\n      return;\n    }\n\n    try {\n        await api.post(`/api/posts/${post.id}/comments`, {\n            content: content,\n            parent_id: parentId\n        }, {\n            headers: { Authorization: `Bearer ${token}` }\n        });\n        \n        setComments([]); \n        await fetchComments(true);\n        \n        if (onUpdate) {\n            onUpdate({\n                ...post,\n                comments_count: post.comments_count + 1\n            });\n        }\n    } catch (err: any) {\n      error(err.response?.data?.detail || '评论失败');\n      throw err;\n    }\n  };\n\n  const handleSubmitComment = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!commentContent.trim() || !user) return;\n\n    if (currentUserLevel !== null && currentUserLevel < 5) {\n      warning('您的等级不足 5 级，无法评论。请前往游戏内升级！');\n      return;\n    }\n\n    setIsSubmittingComment(true);\n    try {\n      if (post.type === 'album') {\n        // Album comment submission\n        await createAlbumComment(post.id, commentContent);\n        // Album API doesn't return the comment object, so we must refetch\n        setComments([]); // Clear to force refetch\n        await fetchComments(true);\n      } else {\n        // Standard post comment submission\n        await api.post(`/api/posts/${post.id}/comments`, {\n            content: commentContent,\n            parent_id: replyingTo?.id\n        }, {\n            headers: { Authorization: `Bearer ${token}` }\n        });\n        \n        // Clear and reload\n        setComments([]); // Clear to force refetch\n        await fetchComments(true);\n      }\n      \n      setCommentContent('');\n      setReplyingTo(null);\n      \n      // Update comment count locally\n      if (onUpdate) {\n        onUpdate({\n            ...post,\n            comments_count: post.comments_count + 1\n        });\n      }\n    } catch (err: any) {\n      error(err.response?.data?.detail || '评论失败');\n    } finally {\n      setIsSubmittingComment(false);\n    }\n  };\n\n  const handleShare = async () => {\n    try {\n      let url = `${window.location.origin}/activity/${post.id}`;\n      if (post.type === 'album') {\n        url = `${window.location.origin}/album/${post.id}`;\n      }\n      await navigator.clipboard.writeText(url);\n      setIsCopied(true);\n      setTimeout(() => setIsCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n      error('复制链接失败，请手动复制');\n    }\n  };\n\n  const handleUpdateSuccess = (updatedPost: Post) => {\n    if (onUpdate) {\n        onUpdate(updatedPost);\n    }\n  };\n\n  const handleFollow = async (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!user || isFollowLoading) return;\n    \n    setIsFollowLoading(true);\n    try {\n        if (isFollowing) {\n            await unfollowUser(post.author.username);\n            setIsFollowing(false);\n        } else {\n            await followUser(post.author.username);\n            setIsFollowing(true);\n        }\n    } catch (error) {\n        console.error(error);\n    } finally {\n        setIsFollowLoading(false);\n    }\n  };\n\n  const handleLike = async () => {\n    if (!user || isLikeLoading) return;\n    setIsLikeLoading(true);\n    try {\n      let res;\n      if (post.type === 'album') {\n        res = await toggleLikeAlbum(post.id);\n      } else {\n        res = await toggleLikePost(post.id);\n      }\n      \n      setIsLiked(res.is_liked);\n      setLikesCount(res.likes_count);\n      if (onUpdate) onUpdate({ ...post, is_liked: res.is_liked, likes_count: res.likes_count });\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsLikeLoading(false);\n    }\n  };\n\n  const handleCollect = async () => {\n    if (!user || isCollectLoading) return;\n    setIsCollectLoading(true);\n    try {\n      let res;\n      if (post.type === 'album') {\n        res = await toggleCollectAlbum(post.id);\n      } else {\n        res = await toggleCollectPost(post.id);\n      }\n      \n      setIsCollected(res.is_collected);\n      setCollectsCount(res.collects_count);\n      if (onUpdate) onUpdate({ ...post, is_collected: res.is_collected, collects_count: res.collects_count });\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsCollectLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    const isConfirmed = await confirm({\n      title: '删除内容',\n      message: '确定要删除这条内容吗？此操作无法撤销。',\n      isDangerous: true,\n      confirmText: '删除',\n    });\n\n    if (!isConfirmed) return;\n\n    try {\n      if (post.type === 'album') {\n        await deleteAlbum(post.id);\n      } else {\n        await deletePost(post.id);\n      }\n      if (onDelete) onDelete(post.id);\n      success('删除成功');\n    } catch (err: any) {\n      console.error(err);\n      error(err.response?.data?.detail || '删除失败');\n    }\n  };\n\n  const isAuthor = user?.username === post.author.username;\n  \n  // Process content to link mentions\n  const processedContent = post.content.replace(\n    /@([^ \\t\\n\\r\\f\\v@,.!?;:，。！？]+)/g, \n    (match, username) => `[${match}](/player/${username})`\n  );\n\n  return (\n    <motion.div \n      ref={ref}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={clsx(\"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden hover:shadow-md transition-all duration-300\", className)}\n    >\n      <div className=\"p-5\">\n        {/* Header */}\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <Link href={`/player/${post.author.username}`} className=\"flex-shrink-0\">\n              <img \n                src={post.author.avatar || `https://cravatar.eu/helmavatar/${post.author.username}/128.png`}\n                alt={post.author.username}\n                className=\"w-10 h-10 rounded-xl object-cover border-2 border-slate-100 dark:border-slate-700\"\n                onError={(e) => {\n                    (e.target as HTMLImageElement).src = 'https://cravatar.eu/helmavatar/MHF_Steve/128.png';\n                }}\n              />\n            </Link>\n            <div>\n              <div className=\"flex items-center gap-2\">\n                <Link href={`/player/${post.author.username}`} className=\"font-bold text-slate-900 dark:text-white hover:text-emerald-600 transition-colors block\">\n                  {post.author.nickname || post.author.username}\n                </Link>\n                {post.author.custom_title && post.author.custom_title !== '玩家' && (\n                   <span className=\"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50\">\n                     {post.author.custom_title}\n                   </span>\n                )}\n                \n                {/* Follow Button */}\n                {!isAuthor && user && (\n                    <button\n                        onClick={handleFollow}\n                        className={clsx(\n                            \"ml-2 text-xs px-2 py-0.5 rounded-full font-medium transition-all duration-300 border\",\n                            isFollowing \n                                ? \"text-slate-400 border-slate-200 hover:text-red-500 hover:border-red-200 bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-red-900/20\"\n                                : \"text-emerald-600 border-emerald-200 hover:bg-emerald-50 bg-white dark:bg-slate-800 dark:text-emerald-400 dark:border-emerald-800 dark:hover:bg-emerald-900/20\"\n                        )}\n                    >\n                        {isFollowLoading ? '...' : isFollowing ? '已关注' : '+ 关注'}\n                    </button>\n                )}\n              </div>\n              <span className=\"text-xs text-slate-500 dark:text-slate-400\">\n                {formatDistanceToNow(new Date(post.created_at), { addSuffix: true, locale: zhCN })}\n                {post.type === 'album' && <span className=\"ml-1 text-purple-500 font-medium\">• 发布了相册</span>}\n              </span>\n            </div>\n          </div>\n          \n          {isAuthor && (\n            <div className=\"flex items-center gap-1\">\n              <button \n                onClick={() => setIsEditModalOpen(true)}\n                className=\"text-slate-400 hover:text-emerald-500 transition-colors p-2 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-lg\"\n              >\n                <Edit2 size={18} />\n              </button>\n              <button \n                onClick={handleDelete}\n                className=\"text-slate-400 hover:text-red-500 transition-colors p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg\"\n              >\n                <Trash2 size={18} />\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Content */}\n        {post.type === 'album' ? (\n           <div className=\"mb-4\">\n               {/* Album Style Content */}\n               <h3 className=\"font-bold text-xl mb-3 text-slate-900 dark:text-white\">{post.title}</h3>\n               \n               {post.images && post.images.length > 0 && (\n                   <div className=\"rounded-2xl overflow-hidden bg-slate-100 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 mb-4 cursor-pointer relative group\">\n                        <Link href={isDetail ? `/player/${post.author.username}?tab=albums` : `/album/${post.id}`}>\n                          <img \n                            src={post.images[0]} \n                            alt={post.title} \n                            className=\"w-full h-auto max-h-[600px] object-contain bg-black/5 dark:bg-black/20\"\n                          />\n                          <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100 pointer-events-none\">\n                              <span className=\"bg-black/60 text-white px-4 py-2 rounded-full backdrop-blur-md text-sm font-medium transform scale-95 group-hover:scale-100 transition-all\">查看相册</span>\n                          </div>\n                        </Link>\n                   </div>\n               )}\n               \n               {post.content && (\n                  <p className=\"text-slate-600 dark:text-slate-300 text-sm leading-relaxed whitespace-pre-wrap\">\n                      {post.content}\n                  </p>\n               )}\n           </div>\n        ) : (\n        <Link href={`/activity/${post.id}`} className={clsx(\"block group\", isDetail && \"pointer-events-none\")}>\n          <div className=\"mb-4\">\n            <h3 className={clsx(\"font-bold text-slate-900 dark:text-white mb-2 transition-colors\", isDetail ? \"text-2xl\" : \"text-xl group-hover:text-emerald-600 dark:group-hover:text-emerald-400\")}>\n              {post.title}\n            </h3>\n            \n            {/* Images Grid */}\n            {post.images && post.images.length > 0 && (\n              <div className={clsx(\"grid gap-2 mb-4\", \n                post.images.length === 1 ? \"grid-cols-1\" : \n                post.images.length === 2 ? \"grid-cols-2\" : \n                \"grid-cols-3\"\n              )}>\n                {post.images.slice(0, isDetail ? undefined : 3).map((img, idx) => (\n                  <div key={idx} className={clsx(\"relative rounded-xl overflow-hidden bg-slate-100 dark:bg-slate-700 aspect-video\", post.images!.length === 1 && \"aspect-[2/1]\")}>\n                    <img \n                      src={img} \n                      alt={`Image ${idx + 1}`} \n                      className=\"w-full h-full object-cover hover:scale-105 transition-transform duration-500\"\n                    />\n                    {!isDetail && idx === 2 && post.images!.length > 3 && (\n                      <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center text-white font-bold text-xl backdrop-blur-sm\">\n                        +{post.images!.length - 3}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n\n            <div className={clsx(\n              \"prose dark:prose-invert max-w-none text-slate-600 dark:text-slate-300\",\n              (isDetail || isExpanded) ? \"prose-base\" : \"prose-sm line-clamp-6\",\n              \"prose-p:my-1 prose-headings:my-2 prose-ul:my-1 prose-ol:my-1 prose-li:my-0\"\n            )}>\n               <ReactMarkdown \n                 remarkPlugins={[remarkGfm]}\n                 components={{\n                   a: ({node, ...props}) => (\n                     <Link href={props.href || '#'} className=\"text-emerald-500 hover:underline\" onClick={(e) => e.stopPropagation()}>\n                       {props.children}\n                     </Link>\n                   ),\n                   img: () => null\n                 }}\n               >\n                 {(isDetail || isExpanded) ? processedContent : processedContent.slice(0, 300) + (processedContent.length > 300 ? '...' : '')}\n               </ReactMarkdown>\n            </div>\n          </div>\n        </Link>\n        )}\n\n        {/* Tags (Optional) */}\n        {post.tags && post.tags.length > 0 && (\n          <div className=\"flex flex-wrap gap-2 mb-4\">\n            {post.tags.map(tag => (\n              <Link \n                key={tag} \n                href={`/activity?tag=${tag}`}\n                className=\"px-2 py-1 text-xs bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-md hover:bg-emerald-50 hover:text-emerald-600 dark:hover:bg-emerald-900/20 dark:hover:text-emerald-400 transition-colors\"\n                onClick={(e) => e.stopPropagation()}\n              >\n                #{tag}\n              </Link>\n            ))}\n          </div>\n        )}\n\n        {/* Footer Actions */}\n        <div className=\"flex items-center justify-between pt-4 border-t border-slate-100 dark:border-slate-700\">\n          <div className=\"flex items-center gap-4\">\n            <button \n              onClick={handleLike}\n              disabled={!user}\n              className={clsx(\n                \"flex items-center gap-1.5 text-sm transition-colors\",\n                isLiked \n                  ? \"text-red-500\" \n                  : \"text-slate-500 hover:text-red-500\"\n              )}\n            >\n              <Heart size={18} className={clsx(isLiked && \"fill-current\")} />\n              <span>{likesCount > 0 ? likesCount : '点赞'}</span>\n            </button>\n\n            <button \n               onClick={(e) => {\n                 if (!isDetail) {\n                     e.preventDefault();\n                     handleToggleExpand();\n                 }\n               }}\n               className={clsx(\n                 \"flex items-center gap-1.5 text-sm transition-colors\",\n                 isExpanded ? \"text-emerald-600\" : \"text-slate-500 hover:text-emerald-600\"\n               )}\n             >\n               <MessageSquare size={18} className={clsx(isExpanded && \"fill-current\")} />\n               <span>{post.comments_count > 0 ? post.comments_count : '评论'}</span>\n             </button>\n\n            <button \n              onClick={handleCollect}\n              disabled={!user}\n              className={clsx(\n                \"flex items-center gap-1.5 text-sm transition-colors\",\n                isCollected \n                  ? \"text-amber-500\" \n                  : \"text-slate-500 hover:text-amber-500\"\n              )}\n            >\n              <Bookmark size={18} className={clsx(isCollected && \"fill-current\")} />\n              <span>{collectsCount > 0 ? collectsCount : '收藏'}</span>\n            </button>\n          </div>\n          \n          <button \n            onClick={handleShare}\n            className={clsx(\n              \"transition-colors flex items-center gap-1.5\",\n              isCopied ? \"text-emerald-500\" : \"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200\"\n            )}\n            title=\"复制链接\"\n          >\n            {isCopied ? <Check size={18} /> : <Share2 size={18} />}\n            {isCopied && <span className=\"text-xs font-medium\">已复制</span>}\n          </button>\n        </div>\n\n        {/* Expanded Comment Section */}\n        <AnimatePresence>\n          {isExpanded && (\n            <motion.div\n              key=\"expanded-content\"\n              initial={{ height: 0, opacity: 0 }}\n              animate={{ height: 'auto', opacity: 1 }}\n              exit={{ height: 0, opacity: 0 }}\n              transition={{ duration: 0.3, ease: \"easeInOut\" }}\n              className=\"overflow-hidden\"\n            >\n              {post.type === 'album' ? (\n              <div className=\"pt-6 mt-4 border-t border-slate-100 dark:border-slate-700\">\n                 {/* Input Area */}\n                 {user ? (\n                   <form onSubmit={handleSubmitComment} className=\"mb-6\">\n                     {replyingTo && (\n                       <div className=\"flex items-center justify-between bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg mb-2 text-sm\">\n                         <span className=\"text-slate-500\">\n                           回复 <span className=\"font-bold text-emerald-500\">@{replyingTo.author.nickname || replyingTo.author.username}</span>\n                         </span>\n                         <button \n                           type=\"button\"\n                           onClick={() => setReplyingTo(null)}\n                           className=\"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-colors\"\n                         >\n                           <X size={14} />\n                         </button>\n                       </div>\n                     )}\n                     <div className=\"relative\">\n                       <MentionInput\n                         value={commentContent}\n                         onChange={(e) => setCommentContent(e.target.value)}\n                         placeholder={replyingTo ? \"写下你的回复...\" : \"发表你的看法...\"}\n                         className=\"w-full bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 pr-12 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none resize-none min-h-[80px] text-sm text-slate-900 dark:text-white\"\n                       />\n                       <button\n                         type=\"submit\"\n                         disabled={isSubmittingComment || !commentContent.trim()}\n                         className=\"absolute bottom-2 right-2 p-1.5 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                       >\n                         {isSubmittingComment ? <Loader2 size={16} className=\"animate-spin\" /> : <Send size={16} />}\n                       </button>\n                     </div>\n                   </form>\n                 ) : (\n                   <div className=\"text-center py-6 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-dashed border-slate-300 dark:border-slate-700 mb-6\">\n                     <p className=\"text-sm text-slate-500 mb-2\">登录后参与讨论</p>\n                     <Link href=\"/login\" className=\"text-emerald-500 text-sm font-medium hover:underline\">\n                       立即登录\n                     </Link>\n                   </div>\n                 )}\n\n                 {/* Comments List */}\n                 <div className=\"space-y-4\">\n                   {loadingComments ? (\n                     <div className=\"flex justify-center py-4\">\n                       <Loader2 size={24} className=\"text-emerald-500 animate-spin\" />\n                     </div>\n                   ) : comments.length === 0 ? (\n                     <div className=\"text-center py-8 text-slate-500 text-sm\">\n                       暂无评论，快来抢沙发吧！\n                     </div>\n                   ) : (\n                     comments.map(comment => (\n                       <CommentItem \n                         key={comment.id} \n                         comment={comment} \n                         onReply={setReplyingTo}\n                       />\n                     ))\n                   )}\n                 </div>\n              </div>\n              ) : (\n                <div className=\"pt-6 mt-4 border-t border-slate-100 dark:border-slate-700\">\n                  <CommentSection \n                      comments={comments as unknown as UIComment[]}\n                      currentUser={user}\n                      onSubmit={handleNewCommentSubmit}\n                      loading={loadingComments}\n                      title=\"评论\"\n                      className=\"!p-0 !bg-transparent !shadow-none !border-none\"\n                  />\n                </div>\n              )}\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n      \n      <CreatePostModal \n        isOpen={isEditModalOpen}\n        onClose={() => setIsEditModalOpen(false)}\n        onSuccess={handleUpdateSuccess}\n        post={post}\n      />\n    </motion.div>\n  );\n});\n\nPostCard.displayName = 'PostCard';\n\nconst CommentContent = ({ content }: { content: string }) => {\n  const processed = content.replace(\n    /@([^ \\t\\n\\r\\f\\v@,.!?;:，。！？]+)/g, \n    (match, username) => `[${match}](/player/${username})`\n  );\n  \n  return (\n    <div className=\"prose dark:prose-invert prose-sm max-w-none text-slate-700 dark:text-slate-300 leading-relaxed break-words\">\n       <ReactMarkdown \n          remarkPlugins={[remarkGfm]}\n          components={{\n              a: ({node, ...props}) => (\n                <Link href={props.href || '#'} className=\"text-emerald-500 hover:underline\" onClick={(e) => e.stopPropagation()}>\n                  {props.children}\n                </Link>\n              ),\n              p: ({node, ...props}) => <p className=\"mb-1 last:mb-0\" {...props} />\n          }}\n       >\n         {processed}\n       </ReactMarkdown>\n    </div>\n  );\n};\n\nconst CommentItem = ({ comment, onReply }: { comment: Comment, onReply: (comment: Comment) => void }) => {\n  if (!comment || !comment.author) return null; // Safety check\n  \n  return (\n    <div className=\"flex gap-3 group\">\n      <Link href={`/player/${comment.author.username}`} className=\"flex-shrink-0\">\n        <img \n          src={comment.author.avatar || `https://cravatar.eu/helmavatar/${comment.author.username}/64.png`}\n          alt={comment.author.username}\n          className=\"w-8 h-8 rounded-lg bg-slate-100\"\n        />\n      </Link>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center justify-between mb-1\">\n          <div className=\"flex items-center gap-2\">\n            <Link href={`/player/${comment.author.username}`} className=\"font-bold text-sm text-slate-900 dark:text-white hover:text-emerald-500 transition-colors\">\n              {comment.author.nickname || comment.author.username}\n            </Link>\n            {comment.author.custom_title && comment.author.custom_title !== '玩家' && (\n               <span className=\"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50\">\n                 {comment.author.custom_title}\n               </span>\n            )}\n            <span className=\"text-xs text-slate-400\">\n              {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true, locale: zhCN })}\n            </span>\n          </div>\n          <button \n            onClick={() => onReply(comment)}\n            className=\"text-slate-400 hover:text-emerald-500 text-xs opacity-0 group-hover:opacity-100 transition-all\"\n          >\n            回复\n          </button>\n        </div>\n        <CommentContent content={comment.content} />\n\n        {comment.replies && comment.replies.length > 0 && (\n          <div className=\"mt-2 space-y-3 pl-3 border-l-2 border-slate-100 dark:border-slate-800\">\n            {comment.replies.map(reply => (\n              <div key={reply.id} className=\"flex gap-2\">\n                <Link href={`/player/${reply.author.username}`} className=\"flex-shrink-0\">\n                  <img \n                    src={reply.author.avatar || `https://cravatar.eu/helmavatar/${reply.author.username}/64.png`}\n                    alt={reply.author.username}\n                    className=\"w-6 h-6 rounded bg-slate-100\"\n                  />\n                </Link>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2 mb-0.5\">\n                    <Link href={`/player/${reply.author.username}`} className=\"font-bold text-xs text-slate-900 dark:text-white hover:text-emerald-500 transition-colors\">\n                      {reply.author.nickname || reply.author.username}\n                    </Link>\n                     {reply.author.custom_title && reply.author.custom_title !== '玩家' && (\n                       <span className=\"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50\">\n                         {reply.author.custom_title}\n                       </span>\n                    )}\n                    <span className=\"text-xs text-slate-400\">\n                      {formatDistanceToNow(new Date(reply.created_at), { addSuffix: true, locale: zhCN })}\n                    </span>\n                  </div>\n                  <CommentContent content={reply.content} />\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default PostCard;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3824, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3829, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/ContributionGraph.tsx"],"sourcesContent":["import React, { useEffect, useState, useMemo, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { motion } from 'framer-motion';\nimport { \n  subDays, \n  eachDayOfInterval, \n  format, \n  getDay, \n} from 'date-fns';\nimport { zhCN } from 'date-fns/locale';\nimport api from '../utils/api';\nimport clsx from 'clsx';\nimport { Loader2 } from 'lucide-react';\n\ninterface ContributionGraphProps {\n  username: string;\n}\n\nconst ContributionGraph: React.FC<ContributionGraphProps> = ({ username }) => {\n  const [data, setData] = useState<Record<string, number>>({});\n  const [loading, setLoading] = useState(true);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (!username) return;\n      setLoading(true);\n      try {\n        const res = await api.get(`/api/profile/${username}/contributions`);\n        setData(res.data);\n      } catch (err) {\n        console.error(\"Failed to fetch contribution data\", err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [username]);\n\n  // Calculate date range (last 365 days)\n  const today = new Date();\n  const startDate = subDays(today, 364); // 365 days including today\n\n  // Generate all days\n  const days = useMemo(() => {\n    return eachDayOfInterval({\n      start: startDate,\n      end: today\n    });\n  }, [startDate, today]);\n\n  // Calculate total minutes for the summary\n  const totalPlaytimeMinutes = useMemo(() => {\n    return Object.values(data).reduce((acc, curr) => acc + curr, 0);\n  }, [data]);\n\n  // Helper to get color intensity\n  const getColor = (minutes: number) => {\n    if (minutes === 0) return \"bg-slate-100 dark:bg-slate-800/50 border border-transparent hover:border-slate-300 dark:hover:border-slate-600\";\n    if (minutes < 60) return \"bg-emerald-200/80 dark:bg-emerald-900/40 border border-emerald-200 dark:border-emerald-800/50\";\n    if (minutes < 180) return \"bg-emerald-300 dark:bg-emerald-700/60 border border-emerald-300 dark:border-emerald-700/50\";\n    if (minutes < 300) return \"bg-emerald-400 dark:bg-emerald-600/80 border border-emerald-400 dark:border-emerald-600/50 shadow-[0_0_8px_rgba(52,211,153,0.3)]\";\n    return \"bg-emerald-500 dark:bg-emerald-500 border border-emerald-500 shadow-[0_0_12px_rgba(16,185,129,0.4)]\";\n  };\n\n  const getTooltipContent = (date: Date, minutes: number) => {\n    const dateStr = format(date, 'yyyy年MM月dd日', { locale: zhCN });\n    if (minutes === 0) return (\n      <div className=\"flex flex-col gap-1 min-w-[120px]\">\n        <span className=\"font-medium text-slate-200 text-xs\">{dateStr}</span>\n        <span className=\"text-slate-400 text-xs\">无游戏记录</span>\n      </div>\n    );\n    \n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    \n    let timeStr = \"\";\n    if (hours > 0) {\n      timeStr = `${hours}小时${mins}分钟`;\n    } else {\n      timeStr = `${mins}分钟`;\n    }\n\n    return (\n      <div className=\"flex flex-col gap-1 min-w-[120px]\">\n        <span className=\"font-medium text-white text-xs\">{dateStr}</span>\n        <span className=\"text-emerald-300 font-bold text-sm\">{timeStr}</span>\n      </div>\n    );\n  };\n\n  // Group days by week for column-based layout\n  const weeks = useMemo(() => {\n    const weeksArray: Date[][] = [];\n    let currentWeek: Date[] = [];\n\n    days.forEach((day) => {\n      if (getDay(day) === 0 && currentWeek.length > 0) {\n        weeksArray.push(currentWeek);\n        currentWeek = [];\n      }\n      currentWeek.push(day);\n    });\n    if (currentWeek.length > 0) {\n      weeksArray.push(currentWeek);\n    }\n    return weeksArray;\n  }, [days]);\n\n  const [tooltip, setTooltip] = useState<{\n    show: boolean;\n    x: number;\n    y: number;\n    content: React.ReactNode;\n  } | null>(null);\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const handleMouseEnter = (e: React.MouseEvent, date: Date, count: number) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    \n    // Calculate position relative to the viewport\n    const x = rect.left + rect.width / 2;\n    const y = rect.top - 6;\n\n    setTooltip({\n      show: true,\n      x,\n      y,\n      content: getTooltipContent(date, count)\n    });\n  };\n\n  const handleMouseLeave = () => {\n    setTooltip(null);\n  };\n\n  // Month labels\n  const monthLabels = useMemo(() => {\n    const labels: { text: string, index: number }[] = [];\n    \n    weeks.forEach((week, index) => {\n      const firstDayOfMonth = week.find(d => d.getDate() === 1);\n      \n      if (index === 0) {\n         labels.push({ text: format(week[0], 'MMM', { locale: zhCN }), index });\n      } else if (firstDayOfMonth) {\n         labels.push({ text: format(firstDayOfMonth, 'MMM', { locale: zhCN }), index });\n      }\n    });\n    \n    return labels;\n  }, [weeks]);\n\n  // Scroll to end on load\n  useEffect(() => {\n    if (scrollContainerRef.current) {\n        scrollContainerRef.current.scrollLeft = scrollContainerRef.current.scrollWidth;\n    }\n  }, [loading, weeks]);\n\n  return (\n    <motion.div \n      ref={containerRef}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"glass-panel p-6 rounded-3xl border border-white/20 dark:border-slate-800 bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl shadow-xl relative overflow-hidden\"\n    >\n      {/* Decorative Elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl -z-10 transform translate-x-1/2 -translate-y-1/2\"></div>\n      \n      {/* Custom Tooltip Portal */}\n      {tooltip?.show && createPortal(\n        <div \n            className=\"fixed z-[9999] pointer-events-none transform -translate-x-1/2 -translate-y-full px-3 py-2 bg-slate-800 text-white text-xs rounded-lg shadow-lg border border-slate-700/50 whitespace-nowrap\"\n            style={{ \n                left: tooltip.x, \n                top: tooltip.y \n            }}\n        >\n            {tooltip.content}\n            <div className=\"absolute left-1/2 -translate-x-1/2 bottom-[-4px] w-2 h-2 bg-slate-800 rotate-45 border-r border-b border-slate-700/50\"></div>\n        </div>,\n        document.body\n      )}\n\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-base font-semibold text-slate-900 dark:text-white flex items-center gap-2\">\n             {loading ? (\n                <div className=\"h-6 w-48 bg-slate-200 dark:bg-slate-700 rounded animate-pulse\" />\n             ) : (\n                <>过去一年共活跃 {Math.floor(totalPlaytimeMinutes / 60)} 小时</>\n             )}\n          </h3>\n      </div>\n\n      {/* Heatmap Container */}\n      {loading ? (\n        <div className=\"w-full h-40 flex items-center justify-center\">\n            <Loader2 className=\"animate-spin text-emerald-500 w-8 h-8\" />\n        </div>\n      ) : (\n      <div className=\"relative group/scroll\">\n        {/* Scroll Indicators */}\n        <div className=\"absolute left-0 top-0 bottom-0 w-12 bg-gradient-to-r from-white dark:from-slate-900 to-transparent z-10 pointer-events-none opacity-0 md:opacity-100 transition-opacity\"></div>\n        <div className=\"absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-white dark:from-slate-900 to-transparent z-10 pointer-events-none opacity-0 md:opacity-100 transition-opacity\"></div>\n        \n        <div \n            ref={scrollContainerRef}\n            className=\"overflow-x-auto pb-4 hide-scrollbar scroll-smooth relative\"\n            style={{ \n                scrollbarWidth: 'none', \n                msOverflowStyle: 'none' \n            }}\n        >\n            <div className=\"min-w-[800px] w-fit mx-auto px-4\">\n                {/* Month Labels */}\n                <div className=\"relative h-6 mb-2 ml-10 text-xs font-medium text-slate-400 dark:text-slate-500\">\n                    {monthLabels.map((label, i) => (\n                        <div \n                            key={i} \n                            className=\"absolute top-0 whitespace-nowrap\"\n                            style={{ \n                                left: `${label.index * 19}px` // 19px = width (15) + gap (4)\n                            }}\n                        >\n                            {label.text}\n                        </div>\n                    ))}\n                </div>\n\n                <div className=\"flex gap-1.5\">\n                    {/* Day Labels */}\n                    <div className=\"flex flex-col gap-[4px] w-9 pr-2 text-[11px] text-right font-medium text-slate-400 dark:text-slate-500 shrink-0 pt-[1px]\">\n                        <div className=\"h-[15px]\"></div>\n                        <div className=\"h-[15px] flex items-center justify-end\">一</div>\n                        <div className=\"h-[15px]\"></div>\n                        <div className=\"h-[15px] flex items-center justify-end\">三</div>\n                        <div className=\"h-[15px]\"></div>\n                        <div className=\"h-[15px] flex items-center justify-end\">五</div>\n                        <div className=\"h-[15px]\"></div>\n                    </div>\n\n                    {/* The Grid */}\n                    <div className=\"flex gap-[4px] flex-1\">\n                        {weeks.map((week, weekIndex) => (\n                            <div key={weekIndex} className=\"flex flex-col gap-[4px]\">\n                                {week.map((day) => {\n                                    const dateStr = format(day, 'yyyy-MM-dd');\n                                    const count = data[dateStr] || 0;\n                                    return (\n                                        <div\n                                            key={dateStr}\n                                            className={clsx(\n                                                \"w-[15px] h-[15px] rounded-[3px] transition-all duration-300 relative cursor-pointer\",\n                                                getColor(count),\n                                                \"hover:scale-110 hover:z-10 hover:shadow-lg\"\n                                            )}\n                                            onMouseEnter={(e) => handleMouseEnter(e, day, count)}\n                                            onMouseLeave={handleMouseLeave}\n                                        />\n                                    );\n                                })}\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </div>\n        </div>\n      </div>\n      )}\n\n      {/* Footer Legend */}\n      {!loading && (\n      <div className=\"flex items-center justify-end gap-3 mt-4 text-xs font-medium text-slate-500 dark:text-slate-400\">\n        <span className=\"mr-1\">Less</span>\n        <div className=\"flex gap-1.5\">\n            <div className=\"w-[15px] h-[15px] rounded-[2px] bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700\"></div>\n            <div className=\"w-[15px] h-[15px] rounded-[2px] bg-emerald-200 dark:bg-emerald-900/40 border border-emerald-300/30\"></div>\n            <div className=\"w-[15px] h-[15px] rounded-[2px] bg-emerald-300 dark:bg-emerald-700/60 border border-emerald-400/30\"></div>\n            <div className=\"w-[15px] h-[15px] rounded-[2px] bg-emerald-400 dark:bg-emerald-600/80 border border-emerald-500/30\"></div>\n            <div className=\"w-[15px] h-[15px] rounded-[2px] bg-emerald-500 dark:bg-emerald-500 border border-emerald-400 shadow-[0_0_8px_rgba(16,185,129,0.3)]\"></div>\n        </div>\n        <span className=\"ml-1\">More</span>\n      </div>\n      )}\n      \n      {/* Hide scrollbar CSS */}\n      <style>{`\n        .hide-scrollbar::-webkit-scrollbar {\n            display: none;\n        }\n      `}</style>\n    </motion.div>\n  );\n};\n\nexport default ContributionGraph;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4367, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4372, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/utils/levelUtils.ts"],"sourcesContent":["\ninterface LevelStyle {\n  text: string;\n  bg: string;\n  border: string;\n  gradient: string;\n  shadow: string;\n  icon: string;\n}\n\nexport const getLevelColor = (level: number): LevelStyle => {\n  if (level <= 10) {\n    // Novice (0-10): Slate/Gray - The Beginning\n    return {\n      text: \"text-slate-600 dark:text-slate-300\",\n      bg: \"bg-slate-100 dark:bg-slate-800\",\n      border: \"border-slate-200 dark:border-slate-700\",\n      gradient: \"from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-700\",\n      shadow: \"shadow-slate-500/20\",\n      icon: \"text-slate-500\"\n    };\n  } else if (level <= 20) {\n    // Apprentice (11-20): Emerald - Growth\n    return {\n      text: \"text-emerald-600 dark:text-emerald-400\",\n      bg: \"bg-emerald-50 dark:bg-emerald-900/20\",\n      border: \"border-emerald-200 dark:border-emerald-800\",\n      gradient: \"from-emerald-100 to-teal-100 dark:from-emerald-900/40 dark:to-teal-900/40\",\n      shadow: \"shadow-emerald-500/20\",\n      icon: \"text-emerald-500\"\n    };\n  } else if (level <= 30) {\n    // Adept (21-30): Sky/Blue - The Sky\n    return {\n      text: \"text-sky-600 dark:text-sky-400\",\n      bg: \"bg-sky-50 dark:bg-sky-900/20\",\n      border: \"border-sky-200 dark:border-sky-800\",\n      gradient: \"from-sky-100 to-blue-100 dark:from-sky-900/40 dark:to-blue-900/40\",\n      shadow: \"shadow-sky-500/20\",\n      icon: \"text-sky-500\"\n    };\n  } else if (level <= 40) {\n    // Expert (31-40): Indigo/Violet - Mystery\n    return {\n      text: \"text-indigo-600 dark:text-indigo-400\",\n      bg: \"bg-indigo-50 dark:bg-indigo-900/20\",\n      border: \"border-indigo-200 dark:border-indigo-800\",\n      gradient: \"from-indigo-100 to-violet-100 dark:from-indigo-900/40 dark:to-violet-900/40\",\n      shadow: \"shadow-indigo-500/20\",\n      icon: \"text-indigo-500\"\n    };\n  } else if (level <= 50) {\n    // Master (41-50): Purple/Fuchsia - Royalty\n    return {\n      text: \"text-purple-600 dark:text-purple-400\",\n      bg: \"bg-purple-50 dark:bg-purple-900/20\",\n      border: \"border-purple-200 dark:border-purple-800\",\n      gradient: \"from-purple-100 to-fuchsia-100 dark:from-purple-900/40 dark:to-fuchsia-900/40\",\n      shadow: \"shadow-purple-500/20\",\n      icon: \"text-purple-500\"\n    };\n  } else if (level <= 60) {\n    // Grandmaster (51-60): Pink/Rose - Passion\n    return {\n      text: \"text-pink-600 dark:text-pink-400\",\n      bg: \"bg-pink-50 dark:bg-pink-900/20\",\n      border: \"border-pink-200 dark:border-pink-800\",\n      gradient: \"from-pink-100 to-rose-100 dark:from-pink-900/40 dark:to-rose-900/40\",\n      shadow: \"shadow-pink-500/20\",\n      icon: \"text-pink-500\"\n    };\n  } else if (level <= 70) {\n    // Legend (61-70): Orange/Amber - Fire\n    return {\n      text: \"text-orange-600 dark:text-orange-400\",\n      bg: \"bg-orange-50 dark:bg-orange-900/20\",\n      border: \"border-orange-200 dark:border-orange-800\",\n      gradient: \"from-orange-100 to-amber-100 dark:from-orange-900/40 dark:to-amber-900/40\",\n      shadow: \"shadow-orange-500/20\",\n      icon: \"text-orange-500\"\n    };\n  } else if (level <= 80) {\n    // Mythic (71-80): Red/Crimson - Blood\n    return {\n      text: \"text-red-600 dark:text-red-400\",\n      bg: \"bg-red-50 dark:bg-red-900/20\",\n      border: \"border-red-200 dark:border-red-800\",\n      gradient: \"from-red-100 to-rose-100 dark:from-red-900/40 dark:to-rose-900/40\",\n      shadow: \"shadow-red-500/20\",\n      icon: \"text-red-500\"\n    };\n  } else if (level <= 90) {\n    // Divine (81-90): Yellow/Gold - Divinity\n    return {\n      text: \"text-yellow-700 dark:text-yellow-400\",\n      bg: \"bg-yellow-50 dark:bg-yellow-900/20\",\n      border: \"border-yellow-200 dark:border-yellow-800\",\n      gradient: \"from-yellow-100 to-amber-100 dark:from-yellow-900/40 dark:to-amber-900/40\",\n      shadow: \"shadow-yellow-500/20\",\n      icon: \"text-yellow-500\"\n    };\n  } else {\n    // Infinite (91+): Rainbow/Iridescent - The Ultimate\n    return {\n      text: \"text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 font-bold\",\n      bg: \"bg-slate-50 dark:bg-slate-900\",\n      border: \"border-indigo-200 dark:border-indigo-800\",\n      gradient: \"from-indigo-100 via-purple-100 to-pink-100 dark:from-indigo-900/40 dark:via-purple-900/40 dark:to-pink-900/40\",\n      shadow: \"shadow-purple-500/30\",\n      icon: \"text-purple-500\"\n    };\n  }\n};\n"],"names":[],"mappings":";;;AAUO,MAAM,gBAAgB,CAAC;IAC5B,IAAI,SAAS,IAAI;QACf,4CAA4C;QAC5C,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,uCAAuC;QACvC,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,oCAAoC;QACpC,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,0CAA0C;QAC1C,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,2CAA2C;QAC3C,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,2CAA2C;QAC3C,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,sCAAsC;QACtC,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,sCAAsC;QACtC,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO,IAAI,SAAS,IAAI;QACtB,yCAAyC;QACzC,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF,OAAO;QACL,oDAAoD;QACpD,OAAO;YACL,MAAM;YACN,IAAI;YACJ,QAAQ;YACR,UAAU;YACV,QAAQ;YACR,MAAM;QACR;IACF;AACF"}},
    {"offset": {"line": 4478, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4483, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/next/profile/UserListModal.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport Link from 'next/link';\nimport { \n  X, Loader2, Users, ChevronRight\n} from 'lucide-react';\n\nconst UserListModal = ({ \n  isOpen, \n  onClose, \n  title, \n  users, \n  loading \n}: { \n  isOpen: boolean; \n  onClose: () => void; \n  title: string; \n  users: { username: string; nickname?: string; avatar_url?: string }[]; \n  loading: boolean; \n}) => {\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center\"\n          >\n            <motion.div\n              initial={{ opacity: 0, scale: 0.95, y: 0 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.95, y: 0 }}\n              onClick={(e) => e.stopPropagation()}\n              className=\"w-full max-w-md bg-white dark:bg-slate-900 rounded-2xl shadow-2xl overflow-hidden max-h-[80vh] flex flex-col border border-slate-200 dark:border-slate-800 m-4\"\n            >\n              <div className=\"flex items-center justify-between p-4 border-b border-slate-100 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm\">\n                <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">{title}</h3>\n                <button onClick={onClose} className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors\">\n                  <X size={20} className=\"text-slate-500\" />\n                </button>\n              </div>\n              \n              <div className=\"flex-1 overflow-y-auto p-4 custom-scrollbar\">\n                {loading ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 size={32} className=\"animate-spin text-emerald-500\" />\n                  </div>\n                ) : users.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {users.map((u) => (\n                      <Link \n                        key={u.username} \n                        href={`/player/${u.username}`}\n                        onClick={onClose}\n                        className=\"flex items-center gap-4 p-3 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded-xl transition-all group border border-transparent hover:border-slate-100 dark:hover:border-slate-800\"\n                      >\n                        <div className=\"relative\">\n                          <img \n                            src={`https://cravatar.eu/helmavatar/${u.username}/48.png`} \n                            alt={u.username}\n                            className=\"w-12 h-12 rounded-xl shadow-sm group-hover:scale-105 transition-transform duration-300\"\n                          />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2\">\n                             <div className=\"font-bold text-slate-900 dark:text-white group-hover:text-emerald-500 transition-colors truncate text-base\">\n                               {u.nickname || u.username}\n                             </div>\n                             {u.nickname && u.nickname !== u.username && (\n                               <span className=\"text-xs px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded font-mono\">\n                                 {u.username}\n                               </span>\n                             )}\n                          </div>\n                          <div className=\"text-xs text-slate-500 truncate mt-0.5\">\n                            访问主页\n                          </div>\n                        </div>\n                        <div className=\"text-slate-300 group-hover:text-emerald-500 transition-colors\">\n                          <ChevronRight size={18} />\n                        </div>\n                      </Link>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"flex flex-col items-center justify-center py-12 text-slate-500\">\n                    <div className=\"w-16 h-16 bg-slate-50 dark:bg-slate-800/50 rounded-full flex items-center justify-center mb-4\">\n                       <Users size={24} className=\"text-slate-300 dark:text-slate-600\" />\n                    </div>\n                    <p>暂时没有用户</p>\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default UserListModal;\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;AASA,MAAM,gBAAgB,CAAC,EACrB,MAAM,EACN,OAAO,EACP,KAAK,EACL,KAAK,EACL,OAAO,EAOR;IACC,qBACE,6LAAC,4LAAA,CAAA,kBAAe;kBACb,wBACC;sBACE,cAAA,6LAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,SAAS;gBAAE;gBACtB,SAAS;oBAAE,SAAS;gBAAE;gBACtB,MAAM;oBAAE,SAAS;gBAAE;gBACnB,SAAS;gBACT,WAAU;0BAEV,cAAA,6LAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAE;oBACzC,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAE;oBACtC,SAAS,CAAC,IAAM,EAAE,eAAe;oBACjC,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAG,WAAU;8CAAoD;;;;;;8CAClE,6LAAC;oCAAO,SAAS;oCAAS,WAAU;8CAClC,cAAA,6LAAC,+LAAA,CAAA,IAAC;wCAAC,MAAM;wCAAI,WAAU;;;;;;;;;;;;;;;;;sCAI3B,6LAAC;4BAAI,WAAU;sCACZ,wBACC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,oNAAA,CAAA,UAAO;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;uCAE7B,MAAM,MAAM,GAAG,kBACjB,6LAAC;gCAAI,WAAU;0CACZ,MAAM,GAAG,CAAC,CAAC,kBACV,6LAAC,+HAAA,CAAA,UAAI;wCAEH,MAAM,CAAC,QAAQ,EAAE,EAAE,QAAQ,CAAC,CAAC;wCAC7B,SAAS;wCACT,WAAU;;0DAEV,6LAAC;gDAAI,WAAU;0DACb,cAAA,6LAAC;oDACC,KAAK,CAAC,+BAA+B,EAAE,EAAE,QAAQ,CAAC,OAAO,CAAC;oDAC1D,KAAK,EAAE,QAAQ;oDACf,WAAU;;;;;;;;;;;0DAGd,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;wDAAI,WAAU;;0EACZ,6LAAC;gEAAI,WAAU;0EACZ,EAAE,QAAQ,IAAI,EAAE,QAAQ;;;;;;4DAE1B,EAAE,QAAQ,IAAI,EAAE,QAAQ,KAAK,EAAE,QAAQ,kBACtC,6LAAC;gEAAK,WAAU;0EACb,EAAE,QAAQ;;;;;;;;;;;;kEAIlB,6LAAC;wDAAI,WAAU;kEAAyC;;;;;;;;;;;;0DAI1D,6LAAC;gDAAI,WAAU;0DACb,cAAA,6LAAC,yNAAA,CAAA,eAAY;oDAAC,MAAM;;;;;;;;;;;;uCA5BjB,EAAE,QAAQ;;;;;;;;;qDAkCrB,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;kDACZ,cAAA,6LAAC,uMAAA,CAAA,QAAK;4CAAC,MAAM;4CAAI,WAAU;;;;;;;;;;;kDAE9B,6LAAC;kDAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUvB;KA/FM;uCAiGS"}},
    {"offset": {"line": 4730, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4735, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/components/next/profile/ProfileClient.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { useParams, useSearchParams, useRouter, usePathname } from 'next/navigation';\nimport Link from 'next/link';\nimport api, { generateUploadHeaders } from '@/utils/api';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  User, Clock, MessageSquare, \n  AlertCircle, Loader2, Send, Shield, \n  Hash, Activity, CalendarDays,\n  Reply, Trash2, X, Heart, Edit2, AlertTriangle, ThumbsUp, Image as ImageIcon, Upload, MessageCircle,\n  UserPlus, UserMinus, Bookmark, Ban,\n  Star, Play, Pause\n} from 'lucide-react';\nimport clsx from 'clsx';\nimport { useAuth } from '@/context/AuthContext';\nimport PostCard from '@/components/next/PostCard';\nimport CommentSection, { UIComment } from '@/components/next/CommentSection';\nimport ContributionGraph from '@/components/ContributionGraph';\nimport { getPosts } from '@/services/activity';\nimport { followUser, unfollowUser, getFollowStats } from '@/services/follow';\nimport { getLevelColor } from '@/utils/levelUtils';\nimport { useCurrentUserLevel } from '@/hooks/useCurrentUserLevel';\nimport { useToast } from '@/context/ToastContext';\nimport { useConfirm } from '@/context/ConfirmContext';\n\nimport { Post, FollowStats } from '@/types/activity';\nimport MessageCard from './MessageCard';\nimport UserListModal from './UserListModal';\n\ninterface UserProfile {\n  username: string;\n  signature: string | null;\n  bio: string | null;\n  tags: string[];\n  likes: number;\n  total_likes: number;\n  is_liked: boolean;\n  likers: string[];\n  custom_title?: string;\n  music_id?: string | null;\n}\n\ninterface MusicMeta {\n  name: string;\n  artist: string;\n  cover: string | null;\n  id: string;\n  url?: string | null;\n}\n\ninterface LevelInfo {\n  username: string;\n  level: number;\n  current_xp: number;\n  next_level_xp: number;\n  level_start_xp: number;\n  rank: number;\n  progress: {\n    current: number;\n    max: number;\n    start: number;\n  };\n}\n\ninterface Album {\n  id: number;\n  username: string;\n  title: string;\n  description: string | null;\n  image_url: string;\n  thumbnail_url?: string; // Add thumbnail field\n  likes: number;\n  created_at: string;\n  is_liked: boolean;\n  is_collected?: boolean;\n  comment_count: number;\n}\n\ninterface PlayerDetails {\n  uuid: string;\n  username: string;\n  login_count: number;\n  total_playtime: number; // minutes\n  total_playtime_hours: number;\n  last_login: string;\n  last_logout: string | null;\n  first_seen: string;\n  last_play_date: string;\n  days_played_30: number;\n  recent_week_minutes: number;\n  recent_week_hours: number;\n  online_now: boolean;\n  ip: string | null;\n  location: string | null;\n  qq: string | null;\n  ban_history: any[];\n  ban_count: number;\n  warn_history: any[];\n  warn_count: number;\n}\n\ninterface Message {\n  id: number;\n  player: string;\n  recipient: string | null;\n  content: string;\n  timestamp: number;\n  parent_id: number | null;\n  replies?: Message[];\n  likes: number;\n  is_liked: boolean;\n}\n\nconst ADMIN_KEY_STORAGE = 'admin_key';\n\nconst getThumbnailUrl = (url: string) => {\n  if (!url) return url;\n  // Naming convention: name.ext -> name_thumb.ext\n  const parts = url.split('.');\n  if (parts.length < 2) return url;\n  const ext = parts.pop();\n  return `${parts.join('.')}_thumb.${ext}`;\n};\n\nconst ProfileClient = () => {\n  const params = useParams();\n  const username = params?.username as string;\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const pathname = usePathname();\n  const { error: toastError, success: toastSuccess, warning: toastWarning } = useToast();\n  const { confirm } = useConfirm();\n  \n  const { user, token, loading: authLoading } = useAuth();\n  \n  const [details, setDetails] = useState<PlayerDetails | null>(null);\n  const [levelInfo, setLevelInfo] = useState<LevelInfo | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Message Board State\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [msgLoading, setMsgLoading] = useState(true);\n  const [postContent, setPostContent] = useState('');\n  const [isPosting, setIsPosting] = useState(false);\n  const [replyingTo, setReplyingTo] = useState<number | null>(null);\n  const [replyContent, setReplyContent] = useState('');\n  const [isReplying, setIsReplying] = useState(false);\n\n  // User List Modal State\n  const [showUserList, setShowUserList] = useState<'followers' | 'following' | null>(null);\n  const [userList, setUserList] = useState<{ username: string; nickname?: string }[]>([]);\n  const [userListLoading, setUserListLoading] = useState(false);\n  \n  // Admin State\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [adminKey, setAdminKey] = useState<string | null>(null);\n\n  // Profile Extended State\n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  \n  // Music Player State\n  const [musicMeta, setMusicMeta] = useState<MusicMeta | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false); // Default to false\n  const [autoplayBlocked, setAutoplayBlocked] = useState(false);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [progress, setProgress] = useState(0);\n\n  useEffect(() => {\n    if (profile?.music_id) {\n       // Reset state when music changes\n       setMusicMeta(null);\n       setProgress(0);\n       setIsPlaying(false); // Don't preemptively set playing state\n       setAutoplayBlocked(false);\n       \n       api.get(`/api/profile/music/${profile.music_id}`)\n         .then(res => {\n           setMusicMeta(res.data);\n         })\n         .catch(err => console.error(err));\n    }\n  }, [profile?.music_id]);\n\n  useEffect(() => {\n    if (musicMeta && audioRef.current) {\n        const audio = audioRef.current;\n        audio.volume = 0.5;\n        \n        const attemptPlay = async () => {\n            try {\n                await audio.play();\n            } catch (error) {\n                console.log(\"Autoplay blocked:\", error);\n                setAutoplayBlocked(true);\n                setIsPlaying(false);\n            }\n        };\n        \n        if (audio.readyState >= 3) {\n            attemptPlay();\n        } else {\n            audio.addEventListener('canplay', attemptPlay, { once: true });\n        }\n\n        return () => {\n            audio.removeEventListener('canplay', attemptPlay);\n            audio.pause();\n        };\n    }\n  }, [musicMeta]);\n\n  // Handle interaction fallback for autoplay blocked\n  useEffect(() => {\n    const handleInteraction = () => {\n        // Only run if autoplay was specifically blocked\n        if (!autoplayBlocked) return;\n        \n        const audio = audioRef.current;\n        if (!audio) return;\n        \n        // Try to play on interaction\n        if (audio.paused) {\n            const playPromise = audio.play();\n            if (playPromise && typeof (playPromise as any).catch === 'function') {\n                (playPromise as any).catch((err: any) => {\n                    console.error(\"Interaction play failed\", err);\n                });\n            }\n        }\n    };\n\n    if (autoplayBlocked) {\n        document.addEventListener('click', handleInteraction, { once: true });\n        document.addEventListener('keydown', handleInteraction, { once: true });\n        document.addEventListener('touchstart', handleInteraction, { once: true });\n    }\n\n    return () => {\n        document.removeEventListener('click', handleInteraction);\n        document.removeEventListener('keydown', handleInteraction);\n        document.removeEventListener('touchstart', handleInteraction);\n    };\n  }, [autoplayBlocked]);\n\n\n  // Album State\n  const [albums, setAlbums] = useState<Album[]>([]);\n  const [isAlbumLoading, setIsAlbumLoading] = useState(true);\n  \n  // Activity & Follow State\n  const [activeTab, setActiveTab] = useState<'overview' | 'posts' | 'collections' | 'albums'>('overview');\n  const [userPosts, setUserPosts] = useState<Post[]>([]);\n  const [userCollections, setUserCollections] = useState<Post[]>([]);\n  const [followStats, setFollowStats] = useState<FollowStats>({ followers_count: 0, following_count: 0, is_following: false });\n  const [isFollowLoading, setIsFollowLoading] = useState(false);\n  const [postsLoading, setPostsLoading] = useState(false);\n  \n  const [collectedAlbums, setCollectedAlbums] = useState<Album[]>([]);\n  const { level: currentUserLevel } = useCurrentUserLevel();\n  const [uploadForm, setUploadForm] = useState({\n    title: '',\n    description: '',\n    file: null as File | null\n  });\n  const [showUploadModal, setShowUploadModal] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n  const [selectedAlbum, setSelectedAlbum] = useState<Album | null>(null);\n  const [albumComments, setAlbumComments] = useState<any[]>([]); // Relaxed type to avoid crash if model mismatches\n  const [newComment, setNewComment] = useState('');\n  const [isCommentLoading, setIsCommentLoading] = useState(false);\n  const [isSendingComment, setIsSendingComment] = useState(false);\n  \n  // Cache state for tabs\n  const [tabDataCache, setTabDataCache] = useState<{\n    username: string | null,\n    posts: { data: Post[], loaded: boolean },\n    collections: { data: Post[], loaded: boolean }\n  }>({\n    username: null,\n    posts: { data: [], loaded: false },\n    collections: { data: [], loaded: false }\n  });\n\n\n  // Fetch public details that don't require auth or don't change with auth\n  useEffect(() => {\n    if (username) {\n      fetchDetails(username);\n      fetchLevelInfo(username);\n    }\n  }, [username]);\n\n  // Fetch data that depends on user authentication (likes, follow status, etc.)\n  useEffect(() => {\n    if (authLoading) return; // Wait for auth to initialize\n\n    // Use typeof window check for localStorage in SSR/SSG\n    if (typeof window !== 'undefined') {\n        const storedKey = localStorage.getItem(ADMIN_KEY_STORAGE);\n        if (storedKey) {\n            setAdminKey(storedKey);\n            setIsAdmin(true);\n        }\n    }\n    \n    if (username) {\n      fetchMessages(username);\n      fetchProfile(username);\n      fetchAlbums(username);\n      fetchFollowStatsData(username);\n    }\n  }, [username, token, authLoading]); \n\n  useEffect(() => {\n    const tab = searchParams.get('tab');\n    if (tab && ['overview', 'posts', 'collections', 'albums'].includes(tab)) {\n        setActiveTab(tab as any);\n    }\n  }, [searchParams]);\n\n  useEffect(() => {\n    // Reset cache when switching users\n    setTabDataCache({\n      username: username || null,\n      posts: { data: [], loaded: false },\n      collections: { data: [], loaded: false }\n    });\n    setUserPosts([]);\n    setUserCollections([]);\n    setCollectedAlbums([]);\n  }, [username]);\n\n  useEffect(() => {\n    if (username) {\n      const isCacheValid = tabDataCache.username === username;\n\n      if (activeTab === 'posts') {\n         if (!isCacheValid || !tabDataCache.posts.loaded) {\n             fetchUserPosts(username);\n         } else {\n             setUserPosts(tabDataCache.posts.data);\n         }\n      }\n      if (activeTab === 'collections') {\n         if (!isCacheValid || !tabDataCache.collections.loaded) {\n             fetchUserCollections();\n         } else {\n             setUserCollections(tabDataCache.collections.data);\n         }\n      }\n    }\n  }, [username, token, activeTab, tabDataCache]);\n\n  const fetchFollowStatsData = async (name: string) => {\n    try {\n      const stats = await getFollowStats(name);\n      setFollowStats(stats);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const fetchUserPosts = async (name: string) => {\n    setPostsLoading(true);\n    try {\n      const res = await getPosts({ author: name });\n      setUserPosts(res.data);\n      setTabDataCache(prev => ({ \n          ...prev, \n          username: name,\n          posts: { data: res.data, loaded: true } \n      }));\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setPostsLoading(false);\n    }\n  };\n\n  const fetchUserCollections = async () => { \n    setPostsLoading(true);\n    try {\n      // Fetch collected posts (Now returns both posts and albums)\n      const postsRes = await getPosts({ is_collected: true });\n      setUserCollections(postsRes.data);\n      \n      setCollectedAlbums([]); \n\n      setTabDataCache(prev => ({ \n          ...prev, \n          username: username || prev.username,\n          collections: { data: postsRes.data, loaded: true } \n      }));\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setPostsLoading(false);\n    }\n  };\n\n  const fetchUserList = async (type: 'followers' | 'following') => {\n    if (!username) return;\n    setUserListLoading(true);\n    setShowUserList(type);\n    setUserList([]); // Reset list before fetching\n    try {\n      const res = await api.get<any>(`/api/social/${type}/${username}`);\n      if (Array.isArray(res.data)) {\n        setUserList(res.data);\n      } else if (res.data.data && Array.isArray(res.data.data)) {\n        setUserList(res.data.data);\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setUserListLoading(false);\n    }\n  };\n\n  const handleFollow = async () => {\n    if (!username || isFollowLoading) return;\n    setIsFollowLoading(true);\n    try {\n      if (followStats.is_following) {\n        await unfollowUser(username);\n        setFollowStats(prev => ({ ...prev, is_following: false, followers_count: prev.followers_count - 1 }));\n      } else {\n        await followUser(username);\n        setFollowStats(prev => ({ ...prev, is_following: true, followers_count: prev.followers_count + 1 }));\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsFollowLoading(false);\n    }\n  };\n\n  const fetchAlbums = async (name: string) => {\n    setIsAlbumLoading(true);\n    try {\n      const config = token ? { headers: { Authorization: `Bearer ${token}` } } : {};\n      const res = await api.get<Album[]>(`/api/album/list/${name}`, {\n        ...config,\n        params: { _t: Date.now() }\n      });\n      setAlbums(res.data);\n    } catch (err) {\n      console.error('Failed to fetch albums', err);\n    } finally {\n      setIsAlbumLoading(false);\n    }\n  };\n\n  const handleUpload = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!uploadForm.file || !uploadForm.title) return;\n\n    setIsUploading(true);\n    try {\n      let fileToUpload = uploadForm.file;\n\n      // Check size and compress if needed (limit 5MB)\n      if (fileToUpload.size > 5 * 1024 * 1024) {\n         try {\n            fileToUpload = await compressImage(fileToUpload);\n            if (fileToUpload.size > 5 * 1024 * 1024) {\n               throw new Error('图片压缩后仍然超过5MB限制，请选择更小的图片');\n            }\n         } catch (e: any) {\n            throw new Error(e.message || '图片压缩失败');\n         }\n      }\n\n      // 1. Upload Image First\n      const imageFormData = new FormData();\n      imageFormData.append('file', fileToUpload); \n      \n      const securityHeaders = await generateUploadHeaders();\n\n      // Use internal API for upload\n      const uploadRes = await api.post('/api/upload/image', imageFormData, {\n         headers: {\n            'Content-Type': 'multipart/form-data',\n            ...securityHeaders\n         }\n      });\n      \n      const imageUrl = uploadRes.data.url;\n      const thumbnailUrl = uploadRes.data.thumbnail_url;\n      \n      // 2. Create Album Entry\n      await api.post('/api/album/upload', {\n        title: uploadForm.title,\n        description: uploadForm.description,\n        image_url: imageUrl,\n        thumbnail_url: thumbnailUrl\n      }, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n\n      closeUploadModal();\n      if (username) fetchAlbums(username);\n    } catch (err: any) {\n      alert(err.message || '上传失败');\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const compressImage = (file: File): Promise<File> => {\n     return new Promise((resolve, reject) => {\n        const img = new Image();\n        const reader = new FileReader();\n        \n        reader.onload = (e) => {\n           img.src = e.target?.result as string;\n        };\n        reader.onerror = reject;\n        \n        img.onload = () => {\n           const canvas = document.createElement('canvas');\n           let width = img.width;\n           let height = img.height;\n           \n           // Resize if too large (max dimension 1920px)\n           const MAX_DIMENSION = 1920;\n           if (width > MAX_DIMENSION || height > MAX_DIMENSION) {\n              if (width > height) {\n                 height *= MAX_DIMENSION / width;\n                 width = MAX_DIMENSION;\n              } else {\n                 width *= MAX_DIMENSION / height;\n                 height = MAX_DIMENSION;\n              }\n           }\n           \n           canvas.width = width;\n           canvas.height = height;\n           const ctx = canvas.getContext('2d');\n           if (!ctx) {\n              reject(new Error('Canvas context not available'));\n              return;\n           }\n           \n           ctx.drawImage(img, 0, 0, width, height);\n           \n           canvas.toBlob((blob) => {\n              if (!blob) {\n                 reject(new Error('Compression failed'));\n                 return;\n              }\n              const compressedFile = new File([blob], file.name.replace(/\\.[^/.]+$/, \"\") + \".jpg\", {\n                 type: 'image/jpeg',\n                 lastModified: Date.now(),\n              });\n              resolve(compressedFile);\n           }, 'image/jpeg', 0.7);\n        };\n        img.onerror = reject;\n        \n        reader.readAsDataURL(file);\n     });\n  };\n\n  const closeUploadModal = () => {\n     setShowUploadModal(false);\n     setUploadForm({ title: '', description: '', file: null });\n  };\n\n  const openAlbumDetail = async (album: Album) => {\n    setSelectedAlbum(album);\n    setIsCommentLoading(true);\n    setAlbumComments([]);\n    try {\n      const config = token ? { headers: { Authorization: `Bearer ${token}` } } : {};\n      const res = await api.get(`/api/album/${album.id}`, config);\n      setAlbumComments(Array.isArray(res.data.comments) ? res.data.comments : []);\n      setSelectedAlbum(prev => prev ? { ...prev, ...res.data } : null);\n    } catch (err) {\n      console.error(err);\n      setAlbumComments([]); \n    } finally {\n      setIsCommentLoading(false);\n    }\n  };\n\n  const handleAlbumLike = async (album: Album) => {\n    if (!user) return;\n    try {\n      const res = await api.post(`/api/album/${album.id}/like`, {}, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      \n      const updateAlbum = (a: Album) => {\n        if (a.id === album.id) {\n          return { ...a, likes: res.data.likes, is_liked: res.data.status === 'liked' };\n        }\n        return a;\n      };\n      \n      setAlbums(prev => prev.map(updateAlbum));\n      if (selectedAlbum && selectedAlbum.id === album.id) {\n        setSelectedAlbum(prev => prev ? updateAlbum(prev) : null);\n      }\n    } catch (err: any) {\n      alert(err.response?.data?.detail || '操作失败');\n    }\n  };\n\n  const handleAlbumCollect = async (album: Album) => {\n    if (!user) return;\n    try {\n      const res = await api.post(`/api/album/${album.id}/collect`, {}, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      \n      const updateAlbum = (a: Album) => {\n        if (a.id === album.id) {\n          return { ...a, is_collected: res.data.is_collected };\n        }\n        return a;\n      };\n      \n      setAlbums(prev => prev.map(updateAlbum));\n      if (res.data.is_collected) {\n          setCollectedAlbums(prev => {\n              if (prev.find(a => a.id === album.id)) return prev;\n              return [{ ...album, is_collected: true }, ...prev];\n          });\n      } else {\n          setCollectedAlbums(prev => prev.filter(a => a.id !== album.id));\n      }\n\n      if (selectedAlbum && selectedAlbum.id === album.id) {\n        setSelectedAlbum(prev => prev ? updateAlbum(prev) : null);\n      }\n    } catch (err: any) {\n      alert(err.response?.data?.detail || '操作失败');\n    }\n  };\n\n  const handleAlbumComment = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedAlbum || !newComment.trim()) return;\n\n    if (currentUserLevel !== null && currentUserLevel < 5) {\n      alert('您的等级不足 5 级，无法评论。请前往游戏内升级！');\n      return;\n    }\n    \n    setIsSendingComment(true);\n    try {\n      const res = await api.post(`/api/album/${selectedAlbum.id}/comment`, { content: newComment }, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      \n      if (res.data.data) {\n         setAlbumComments(prev => [...(prev || []), res.data.data]);\n      } else {\n         const config = token ? { headers: { Authorization: `Bearer ${token}` } } : {};\n         const detailRes = await api.get(`/api/album/${selectedAlbum.id}`, config);\n         setAlbumComments(Array.isArray(detailRes.data.comments) ? detailRes.data.comments : []);\n      }\n      \n      setNewComment('');\n      setAlbums(prev => prev.map(a => a.id === selectedAlbum.id ? { ...a, comment_count: a.comment_count + 1 } : a));\n    } catch (err: any) {\n      alert(err.response?.data?.detail || '评论失败');\n    } finally {\n      setIsSendingComment(false);\n    }\n  };\n\n  const handleDeleteAlbum = async (albumId: number) => {\n    const isConfirmed = await confirm({\n      title: '删除照片',\n      message: '确定要删除这张照片吗？此操作无法撤销。',\n      isDangerous: true,\n      confirmText: '删除',\n    });\n\n    if (!isConfirmed) return;\n\n    try {\n      await api.delete(`/api/album/${albumId}`, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      if (selectedAlbum?.id === albumId) setSelectedAlbum(null);\n      setAlbums(prev => prev.filter(a => a.id !== albumId));\n      toastSuccess('删除成功');\n    } catch (err: any) {\n      toastError(err.response?.data?.detail || '删除失败');\n    }\n  };\n\n  const fetchProfile = async (name: string) => {\n    try {\n      const config = token ? { headers: { Authorization: `Bearer ${token}` } } : {};\n      const res = await api.get<UserProfile>(`/api/profile/${name}`, {\n        ...config,\n        params: { _t: Date.now() }\n      });\n      setProfile(res.data);\n    } catch (err) {\n      console.error('Failed to fetch profile', err);\n    }\n  };\n\n  const handleBindQQ = () => {\n    router.push('/settings');\n  };\n\n  const handleLike = async () => {\n    if (!user || !username) return;\n    try {\n      await api.post('/api/profile/like', { target_username: username }, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      fetchProfile(username);\n    } catch (err: any) {\n      toastError(err.response?.data?.detail || '操作失败');\n    }\n  };\n\n  const fetchLevelInfo = async (name: string) => {\n    try {\n      const res = await api.get<LevelInfo>('/api/level/my-info', { params: { username: name } });\n      setLevelInfo(res.data);\n    } catch (err) {\n      console.error('Failed to fetch level info', err);\n    }\n  };\n\n  const fetchDetails = async (name: string) => {\n    setLoading(true);\n    try {\n      const res = await api.get<PlayerDetails>(`/api/playtime/player/details`, { params: { name } });\n      setDetails(res.data);\n      setError(null);\n    } catch (err: any) {\n      setError(err.response?.data?.error || '无法获取玩家信息');\n      setDetails(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMessages = async (recipient: string) => {\n    setMsgLoading(true);\n    try {\n      const response = await api.get<Message[]>('/api/message/read', { params: { recipient } });\n      const data = response.data;\n      \n      const messageMap = new Map<number, Message>();\n      const rootMessages: Message[] = [];\n\n      data.forEach(msg => {\n        messageMap.set(msg.id, { ...msg, replies: [] });\n      });\n\n      data.forEach(msg => {\n        const processedMsg = messageMap.get(msg.id)!;\n        if (msg.parent_id) {\n          const parent = messageMap.get(msg.parent_id);\n          if (parent) {\n            parent.replies?.push(processedMsg);\n          } else {\n            rootMessages.push(processedMsg);\n          }\n        } else {\n          rootMessages.push(processedMsg);\n        }\n      });\n\n      const sortMessages = (msgs: Message[]) => {\n        msgs.sort((a, b) => b.timestamp - a.timestamp);\n        msgs.forEach(msg => {\n          if (msg.replies && msg.replies.length > 0) {\n            msg.replies.sort((a, b) => b.timestamp - a.timestamp);\n          }\n        });\n      };\n      \n      sortMessages(rootMessages);\n      setMessages(rootMessages);\n    } catch (err) {\n      console.error('Failed to load messages', err);\n    } finally {\n      setMsgLoading(false);\n    }\n  };\n\n  const handleLikeMessage = async (msgId: number) => {\n    if (!user) return;\n    try {\n      const res = await api.post(`/api/message/${msgId}/like`, {}, {\n         headers: { Authorization: `Bearer ${token}` }\n      });\n      \n      const updateMsg = (msg: Message): Message => {\n        if (msg.id === msgId) {\n          return { ...msg, likes: res.data.likes, is_liked: res.data.liked };\n        }\n        if (msg.replies) {\n          return { ...msg, replies: msg.replies.map(updateMsg) };\n        }\n        return msg;\n      };\n      \n      setMessages(prev => prev.map(updateMsg));\n    } catch (err: any) {\n      console.error(err);\n    }\n  };\n\n  const comments: UIComment[] = useMemo(() => {\n    const mapMessage = (msg: Message): UIComment => ({\n      id: msg.id,\n      content: msg.content,\n      created_at: msg.timestamp,\n      author: {\n        username: msg.player,\n        nickname: msg.player,\n        avatar: `https://cravatar.eu/helmavatar/${msg.player}/48.png`\n      },\n      likes_count: msg.likes,\n      is_liked: msg.is_liked,\n      replies: (msg.replies || []).map(mapMessage),\n      parent_id: msg.parent_id || undefined\n    });\n    return messages.map(mapMessage);\n  }, [messages]);\n\n  const handleCommentSubmit = async (content: string, parentId?: number) => {\n     if (!user || !username) return;\n\n     if (currentUserLevel !== null && currentUserLevel < 5) {\n       toastError('您的等级不足 5 级，无法留言。请前往游戏内升级！');\n       return;\n     }\n\n     if (parentId) {\n         // Reply\n         setIsReplying(true); \n         try {\n             await api.post('/api/message/write', {\n                message: content,\n                player: user.username,\n                recipient: username,\n                parent_id: parentId\n              }, {\n                headers: { Authorization: `Bearer ${token}` }\n              });\n              fetchMessages(username);\n              toastSuccess('回复成功');\n         } catch (err: any) {\n             toastError(err.response?.data?.error || '回复失败');\n             throw err;\n         } finally {\n             setIsReplying(false);\n         }\n     } else {\n         // New Post\n         setIsPosting(true);\n         try {\n            await api.post('/api/message/write', {\n                message: content,\n                player: user.username,\n                recipient: username,\n                parent_id: null\n            }, {\n                headers: { Authorization: `Bearer ${token}` }\n            });\n            fetchMessages(username);\n            toastSuccess('留言发布成功');\n         } catch (err: any) {\n             toastError(err.response?.data?.error || '发布失败');\n             throw err;\n         } finally {\n             setIsPosting(false);\n         }\n     }\n  };\n\n  const handleLikeComment = async (msgId: number) => {\n      await handleLikeMessage(msgId);\n  };\n\n  const handleDeleteComment = async (msgId: number) => {\n      await handleDelete(msgId);\n  };\n\n  const handleReply = async (e: React.FormEvent, parentId: number) => {\n    e.preventDefault();\n    if (!replyContent.trim() || !user || !username) return;\n\n    setIsReplying(true);\n    try {\n      await api.post('/api/message/write', {\n        message: replyContent,\n        player: user.username,\n        recipient: username, \n        parent_id: parentId\n      }, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      setReplyContent('');\n      setReplyingTo(null);\n      fetchMessages(username);\n      toastSuccess('回复成功');\n    } catch (err: any) {\n      toastError(err.response?.data?.error || '回复失败');\n    } finally {\n      setIsReplying(false);\n    }\n  };\n\n  const handleDelete = async (id: number) => {\n    const isConfirmed = await confirm({\n      title: '删除留言',\n      message: '确定要删除这条留言吗？此操作无法撤销。',\n      isDangerous: true,\n      confirmText: '删除',\n    });\n\n    if (!isConfirmed) return;\n\n    const authHeader = adminKey ? `Bearer ${adminKey}` : (token ? `Bearer ${token}` : null);\n    \n    if (!authHeader) {\n      toastError('无权删除');\n      return;\n    }\n\n    try {\n      await api.delete(`/api/message/${id}`, {\n        headers: { 'Authorization': authHeader }\n      });\n      if (username) fetchMessages(username);\n      toastSuccess('删除成功');\n    } catch (err: any) {\n      toastError('删除失败: ' + (err.response?.data?.error || err.message));\n    }\n  };\n\n  const handlePostUpdate = (updatedPost: Post) => {\n    setUserPosts(prev => prev.map(p => p.id === updatedPost.id ? updatedPost : p));\n    \n    setUserCollections(prev => {\n        const isInCollection = prev.some(p => p.id === updatedPost.id);\n        if (isInCollection) {\n            if (!updatedPost.is_collected) {\n                return prev.filter(p => p.id !== updatedPost.id);\n            }\n            return prev.map(p => p.id === updatedPost.id ? updatedPost : p);\n        } else if (updatedPost.is_collected) {\n            return [updatedPost, ...prev];\n        }\n        return prev;\n    });\n\n    setTabDataCache(prev => {\n      const newPostsData = prev.posts.data.map(p => p.id === updatedPost.id ? updatedPost : p);\n      \n      let newCollectionsData = prev.collections.data;\n      const isInCollectionCache = newCollectionsData.some(p => p.id === updatedPost.id);\n      \n      if (isInCollectionCache) {\n          if (!updatedPost.is_collected) {\n              newCollectionsData = newCollectionsData.filter(p => p.id !== updatedPost.id);\n          } else {\n              newCollectionsData = newCollectionsData.map(p => p.id === updatedPost.id ? updatedPost : p);\n          }\n      } else if (updatedPost.is_collected) {\n          newCollectionsData = [updatedPost, ...newCollectionsData];\n      }\n\n      return {\n        ...prev,\n        posts: { ...prev.posts, data: newPostsData },\n        collections: { ...prev.collections, data: newCollectionsData }\n      };\n    });\n  };\n\n  const handlePostDelete = (postId: number) => {\n    setUserPosts(prev => prev.filter(p => p.id !== postId));\n    setUserCollections(prev => prev.filter(p => p.id !== postId));\n    \n    setTabDataCache(prev => ({\n      ...prev,\n      posts: { ...prev.posts, data: prev.posts.data.filter(p => p.id !== postId) },\n      collections: { ...prev.collections, data: prev.collections.data.filter(p => p.id !== postId) }\n    }));\n  };\n\n  const formatHistoryDate = (dateStr: string | number | null | undefined) => {\n    if (!dateStr) return '未知日期';\n    \n    let date: Date;\n    \n    if (typeof dateStr === 'number') {\n       if (dateStr < 10000000000) {\n          date = new Date(dateStr * 1000);\n       } else {\n          date = new Date(dateStr);\n       }\n    } else {\n       let processedStr = String(dateStr);\n       \n       if (processedStr.includes(' +')) {\n          processedStr = processedStr.replace(' +', '+');\n       } else if (processedStr.includes(' -')) {\n          processedStr = processedStr.replace(' -', '-');\n       }\n       \n       date = new Date(processedStr);\n       \n       if (isNaN(date.getTime())) {\n          if (/^\\d+$/.test(dateStr)) {\n             const timestamp = parseInt(dateStr);\n             if (!isNaN(timestamp)) {\n                if (timestamp < 10000000000) {\n                   date = new Date(timestamp * 1000);\n                } else {\n                   date = new Date(timestamp);\n                }\n             }\n          }\n       }\n    }\n\n    if (isNaN(date.getTime())) {\n       if (typeof dateStr === 'string' && /^\\d{4}-\\d{2}-\\d{2}/.test(dateStr)) {\n          const simpleDate = new Date(dateStr.substring(0, 10));\n          if (!isNaN(simpleDate.getTime())) {\n             return simpleDate.toLocaleDateString();\n          }\n       }\n       return String(dateStr);\n    }\n    \n    return date.toLocaleString('zh-CN', {\n       year: 'numeric',\n       month: '2-digit',\n       day: '2-digit',\n       hour: '2-digit',\n       minute: '2-digit'\n    }).replace(/\\//g, '-');\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 size={40} className=\"text-brand-500 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error || !details) {\n    return (\n      <div className=\"min-h-screen flex flex-col items-center justify-center p-4\">\n        <AlertCircle size={48} className=\"text-red-500 mb-4\" />\n        <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">未找到玩家</h1>\n        <p className=\"text-slate-500 mb-8\">{error || '该玩家不存在或从未进入过服务器。'}</p>\n        <Link href=\"/stats\" className=\"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors\">\n          返回排行榜\n        </Link>\n      </div>\n    );\n  }\n\n  const isBanned = details.ban_history?.some((ban: any) => ban.active) || false;\n\n  return (\n    <div className=\"min-h-screen py-12 px-4 sm:px-6 lg:px-8 pt-24\">\n      <div className=\"max-w-5xl mx-auto space-y-8\">\n        \n        {/* Header Profile Card */}\n        <motion.div \n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className={clsx(\n            \"relative overflow-hidden bg-white/80 dark:bg-slate-900/50 backdrop-blur-md rounded-3xl p-8 border shadow-xl transition-all duration-300\",\n            isBanned \n              ? \"border-red-500/50 shadow-red-500/20\" \n              : \"border-slate-200 dark:border-slate-800\"\n          )}\n        >\n          {isBanned && (\n            <div className=\"absolute -top-12 -right-12 z-10 pointer-events-none opacity-20 dark:opacity-10 rotate-12\">\n               <Ban size={300} className=\"text-red-500\" />\n            </div>\n          )}\n          <div className={clsx(\n            \"absolute top-0 left-0 w-full h-32\",\n            isBanned \n              ? \"bg-gradient-to-r from-red-500/20 to-orange-500/20 dark:from-red-900/40 dark:to-orange-900/40\"\n              : \"bg-gradient-to-r from-blue-500/10 to-purple-500/10 dark:from-blue-500/20 dark:to-purple-500/20\"\n          )} />\n          \n          <div className=\"relative flex flex-col md:flex-row gap-8 mt-4\">\n            <div className=\"relative group self-center md:self-end shrink-0\">\n              <div className={clsx(\n                \"w-32 h-32 rounded-2xl overflow-hidden ring-4 shadow-2xl relative\",\n                isBanned ? \"ring-red-500 grayscale\" : \"ring-white dark:ring-slate-900\"\n              )}>\n                <img\n                  src={`https://cravatar.eu/helmavatar/${details.username}/256.png`}\n                  alt={details.username}\n                  className=\"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500\"\n                />\n                {isBanned && (\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/10\">\n                     <Ban size={48} className=\"text-red-500 drop-shadow-lg\" />\n                  </div>\n                )}\n              </div>\n              <div className={clsx(\n                \"absolute -bottom-2 -right-2 w-8 h-8 rounded-full border-4 border-white dark:border-slate-900 flex items-center justify-center shadow-lg\",\n                details.online_now ? \"bg-green-500\" : \"bg-slate-400\"\n              )} title={details.online_now ? \"在线\" : \"离线\"}>\n                {details.online_now && <div className=\"w-2 h-2 bg-white rounded-full animate-ping\" />}\n              </div>\n            </div>\n\n            <div className=\"flex-1 text-center md:text-left mb-2 self-center md:self-end flex flex-col md:flex-row md:items-end justify-between w-full\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center justify-center md:justify-start gap-4 mb-2\">\n                <h1 className=\"text-4xl font-bold text-slate-900 dark:text-white flex items-center gap-3\">\n                  {details.username}\n                  {levelInfo && (\n                    <span className={`px-3 py-1 rounded-lg border ${getLevelColor(levelInfo.level).bg} ${getLevelColor(levelInfo.level).border} flex items-center gap-1.5`}>\n                      <Star size={16} className={getLevelColor(levelInfo.level).icon} />\n                      <span className={`text-sm font-bold ${getLevelColor(levelInfo.level).icon}`}>Lv.{levelInfo.level}</span>\n                    </span>\n                  )}\n                </h1>\n                \n                <div className=\"flex items-center gap-3\">\n                  {/* Like Button */}\n                  {profile && (\n                    <button\n                      onClick={handleLike}\n                      disabled={!user || user.username === details.username}\n                      className={clsx(\n                        \"flex items-center gap-1.5 px-3 py-1.5 rounded-full transition-all border\",\n                        profile.is_liked \n                          ? \"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800\" \n                          : \"bg-slate-100 dark:bg-slate-800 text-slate-500 border-transparent hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20\",\n                        (!user || user.username === details.username) && \"opacity-50 cursor-not-allowed\"\n                      )}\n                      title={user?.username === details.username ? \"不能给自己点赞\" : (profile.is_liked ? \"取消点赞\" : \"点赞\")}\n                    >\n                      <Heart size={18} className={clsx(profile.is_liked && \"fill-current\")} />\n                      <span className=\"font-bold\">{profile.likes}</span>\n                    </button>\n                  )}\n\n                  {/* Follow Button */}\n                  {user && user.username !== details.username && (\n                    <button\n                      onClick={handleFollow}\n                      disabled={isFollowLoading}\n                      className={clsx(\n                        \"flex items-center gap-1.5 px-3 py-1.5 rounded-full transition-all border\",\n                        followStats.is_following\n                          ? \"bg-slate-100 dark:bg-slate-800 text-slate-500 border-transparent hover:bg-red-50 hover:text-red-500 dark:hover:bg-red-900/20\"\n                          : \"bg-emerald-500 text-white border-emerald-500 hover:bg-emerald-600 shadow-lg shadow-emerald-500/20\"\n                      )}\n                    >\n                      {isFollowLoading ? (\n                        <Loader2 size={16} className=\"animate-spin\" />\n                      ) : followStats.is_following ? (\n                        <>\n                          <UserMinus size={16} />\n                          <span className=\"font-medium\">已关注</span>\n                        </>\n                      ) : (\n                        <>\n                          <UserPlus size={16} />\n                          <span className=\"font-medium\">关注</span>\n                        </>\n                      )}\n                    </button>\n                  )}\n                </div>\n              </div>\n              \n                  {/* Follow Stats */}\n              \n              {/* Signature */}\n              <div className=\"mb-4 text-slate-600 dark:text-slate-300 italic min-h-[1.5em]\">\n                {profile?.signature ? (\n                  <span>\"{profile.signature}\"</span>\n                ) : (\n                  <span className=\"text-slate-400 dark:text-slate-500 text-sm\">这个人很懒，什么也没写...</span>\n                )}\n              </div>\n\n              <div className=\"flex flex-wrap justify-center md:justify-start gap-3 items-center\">\n                <span className=\"px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-sm font-medium flex items-center gap-1.5\">\n                  <User size={14} />\n                  {profile?.custom_title || '玩家'}\n                </span>\n                {details.qq ? (\n                   <span className=\"px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium flex items-center gap-1.5\">\n                     <MessageSquare size={14} />\n                     QQ已绑定\n                   </span>\n                ) : (\n                  user && user.username === details.username && (\n                    <button \n                      onClick={handleBindQQ}\n                      className=\"px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-sm font-medium flex items-center gap-1.5 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors cursor-pointer\"\n                    >\n                      <MessageSquare size={14} />\n                      绑定QQ\n                    </button>\n                  )\n                )}\n                 {details.ban_count > 0 && (\n                   <span className=\"px-3 py-1 rounded-full bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-sm font-medium flex items-center gap-1.5\">\n                     <Shield size={14} />\n                     {details.ban_count} 次封禁记录\n                   </span>\n                )}\n                 {details.warn_count > 0 && (\n                   <span className=\"px-3 py-1 rounded-full bg-orange-50 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 text-sm font-medium flex items-center gap-1.5\">\n                     <AlertTriangle size={14} />\n                     {details.warn_count} 次警告记录\n                   </span>\n                )}\n                \n                {/* Edit Profile Button */}\n                {user && user.username === details.username && (\n                  <Link \n                    href=\"/settings\"\n                    className=\"ml-2 px-3 py-1 rounded-full bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 text-sm font-medium flex items-center gap-1.5 hover:bg-emerald-100 dark:hover:bg-emerald-900/50 transition-colors\"\n                  >\n                    <Edit2 size={14} />\n                    编辑资料\n                  </Link>\n                )}\n              </div>\n              {isBanned && (\n                 <div className=\"mt-4 bg-red-500/10 border border-red-500/20 rounded-xl p-3 flex items-center gap-3 text-red-600 dark:text-red-400 animate-pulse\">\n                    <Ban size={20} className=\"shrink-0\" />\n                    <span className=\"font-medium text-sm\">此玩家已被服务器封禁</span>\n                 </div>\n              )}\n              </div>\n\n              {/* Right Side Stats */}\n              <div className=\"flex flex-col items-center md:items-end gap-4 mt-4 md:mt-0\">\n                  {/* Follow Stats */}\n                  <div className=\"flex items-center gap-4 mb-2\">\n                    <div \n                      onClick={() => fetchUserList('following')}\n                      className=\"flex flex-col items-center cursor-pointer group transition-all hover:-translate-y-0.5\"\n                    >\n                      <span className=\"text-2xl font-bold text-slate-900 dark:text-white group-hover:text-indigo-500 transition-colors\">\n                        {followStats.following_count}\n                      </span>\n                      <span className=\"text-xs text-slate-500 dark:text-slate-400 group-hover:text-indigo-400 transition-colors\">关注</span>\n                    </div>\n                    <div className=\"w-px h-8 bg-slate-200 dark:bg-slate-700\"></div>\n                    <div \n                      onClick={() => fetchUserList('followers')}\n                      className=\"flex flex-col items-center cursor-pointer group transition-all hover:-translate-y-0.5\"\n                    >\n                      <span className=\"text-2xl font-bold text-slate-900 dark:text-white group-hover:text-indigo-500 transition-colors\">\n                        {followStats.followers_count}\n                      </span>\n                      <span className=\"text-xs text-slate-500 dark:text-slate-400 group-hover:text-indigo-400 transition-colors\">粉丝</span>\n                    </div>\n                  </div>\n\n                  \n                  <div className=\"text-slate-500 dark:text-slate-400 text-xs uppercase tracking-wider flex items-center gap-2 bg-slate-50 dark:bg-slate-800/30 px-3 py-1 rounded-full\">\n                    <span>最后登录</span>\n                    <span className=\"text-slate-900 dark:text-white font-medium font-mono\">\n                       {details.last_login ? new Date(details.last_login).toLocaleDateString() : '未知'}\n                    </span>\n                  </div>\n              </div>\n            </div>\n\n\n          </div>\n\n          <div className=\"absolute top-6 right-6 flex flex-wrap justify-end gap-2 max-w-[40%]\">\n             {profile && profile.tags && profile.tags.length > 0 && profile.tags.map((tag, idx) => (\n                <span key={idx} className=\"px-2 py-0.5 rounded text-xs font-medium bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 border border-indigo-100 dark:border-indigo-800/50 whitespace-nowrap shadow-sm\">\n                  #{tag}\n                </span>\n             ))}\n          </div>\n        </motion.div>\n\n        {/* Tab Navigation */}\n        <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-2 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex justify-center gap-2 sm:gap-4 flex-wrap\">\n          <button\n            onClick={() => setActiveTab('overview')}\n            className={clsx(\n              \"px-6 py-2.5 rounded-xl font-medium transition-all duration-300 flex items-center gap-2.5 text-sm sm:text-base relative\",\n              activeTab === 'overview'\n                ? \"bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md\"\n                : \"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white\"\n            )}\n          >\n            <User size={18} />\n            个人主页\n          </button>\n          <button\n            onClick={() => setActiveTab('posts')}\n            className={clsx(\n              \"px-6 py-2.5 rounded-xl font-medium transition-all duration-300 flex items-center gap-2.5 text-sm sm:text-base relative\",\n              activeTab === 'posts'\n                ? \"bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md\"\n                : \"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white\"\n            )}\n          >\n            <Activity size={18} />\n            动态\n          </button>\n          <button\n            onClick={() => setActiveTab('collections')}\n            className={clsx(\n              \"px-6 py-2.5 rounded-xl font-medium transition-all duration-300 flex items-center gap-2.5 text-sm sm:text-base relative\",\n              activeTab === 'collections'\n                ? \"bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md\"\n                : \"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white\"\n            )}\n          >\n            <Bookmark size={18} />\n            收藏\n          </button>\n          <button\n            onClick={() => setActiveTab('albums')}\n            className={clsx(\n              \"px-6 py-2.5 rounded-xl font-medium transition-all duration-300 flex items-center gap-2.5 text-sm sm:text-base relative\",\n              activeTab === 'albums'\n                ? \"bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md\"\n                : \"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white\"\n            )}\n          >\n            <ImageIcon size={18} />\n            相册\n          </button>\n        </div>\n\n        {/* Content Area */}\n        <AnimatePresence mode=\"wait\">\n          {activeTab === 'overview' ? (\n             <motion.div\n               key=\"overview\"\n               initial={{ opacity: 0, x: -20 }}\n               animate={{ opacity: 1, x: 0 }}\n               exit={{ opacity: 0, x: 20 }}\n               transition={{ duration: 0.3, ease: \"easeOut\" }}\n               className=\"space-y-8\"\n             >\n               {/* Stats Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n\n\n\n                <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-purple-500/30 transition-colors group\">\n                  <div className=\"flex items-center gap-4 mb-4\">\n                    <div className=\"p-3 bg-purple-50 dark:bg-purple-900/20 text-purple-500 rounded-xl group-hover:scale-110 transition-transform\">\n                      <CalendarDays size={24} />\n                    </div>\n                    <div>\n                      <div className=\"text-slate-500 dark:text-slate-400 text-sm\">首次加入</div>\n                      <div className=\"text-lg font-bold text-slate-900 dark:text-white truncate\" title={details.first_seen}>\n                          {details.first_seen ? new Date(details.first_seen).toLocaleDateString() : '未知'}\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"text-xs text-slate-500\">\n                      已陪伴服务器 {Math.floor((Date.now() - new Date(details.first_seen).getTime()) / (1000 * 60 * 60 * 24))} 天\n                  </div>\n                </div>\n\n                <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-blue-500/30 transition-colors group\">\n                  <div className=\"flex items-center gap-4 mb-4\">\n                    <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-500 rounded-xl group-hover:scale-110 transition-transform\">\n                      <Clock size={24} />\n                    </div>\n                    <div>\n                      <div className=\"text-slate-500 dark:text-slate-400 text-sm\">总游戏时长</div>\n                      <div className=\"text-2xl font-bold text-slate-900 dark:text-white\">{details.total_playtime_hours} <span className=\"text-sm font-normal text-slate-500\">小时</span></div>\n                    </div>\n                  </div>\n                  <div className=\"w-full bg-slate-100 dark:bg-slate-800 h-1.5 rounded-full overflow-hidden\">\n                    <div className=\"bg-blue-500 h-full rounded-full\" style={{ width: '100%' }} />\n                  </div>\n                </div>\n\n                <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-emerald-500/30 transition-colors group\">\n                  <div className=\"flex items-center gap-4 mb-4\">\n                    <div className=\"p-3 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-500 rounded-xl group-hover:scale-110 transition-transform\">\n                      <Activity size={24} />\n                    </div>\n                    <div>\n                      <div className=\"text-slate-500 dark:text-slate-400 text-sm\">近30天活跃</div>\n                      <div className=\"text-2xl font-bold text-slate-900 dark:text-white\">{details.days_played_30} <span className=\"text-sm font-normal text-slate-500\">天</span></div>\n                    </div>\n                  </div>\n                  <div className=\"w-full bg-slate-100 dark:bg-slate-800 h-1.5 rounded-full overflow-hidden\">\n                    <div className=\"bg-emerald-500 h-full rounded-full\" style={{ width: `${(details.days_played_30 / 30) * 100}%` }} />\n                  </div>\n                </div>\n\n                <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-amber-500/30 transition-colors group\">\n                  <div className=\"flex items-center gap-4 mb-4\">\n                    <div className=\"p-3 bg-amber-50 dark:bg-amber-900/20 text-amber-500 rounded-xl group-hover:scale-110 transition-transform\">\n                      <Heart size={24} />\n                    </div>\n                    <div>\n                      <div className=\"text-slate-500 dark:text-slate-400 text-sm\">获得总赞数</div>\n                      <div className=\"text-2xl font-bold text-slate-900 dark:text-white\">{profile?.total_likes || 0}</div>\n                    </div>\n                  </div>\n                   <div className=\"text-xs text-slate-500\">\n                      包括动态、相册、评论及主页获赞\n                  </div>\n                </div>\n              </div>\n\n               {/* Contribution Graph */}\n               <ContributionGraph username={details.username} />\n\n              {/* Detail Info Lists */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                 {/* Left Column: Detailed Properties */}\n                 <div className=\"lg:col-span-1 space-y-6\">\n                    {/* Bio Card */}\n                    <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800\">\n                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2\">\n                            <User size={20} className=\"text-slate-400\" />\n                            个人简介\n                        </h3>\n                        <div className=\"text-slate-600 dark:text-slate-300 whitespace-pre-wrap leading-relaxed text-sm\">\n                            {profile?.bio || \"暂无简介\"}\n                        </div>\n                    </div>\n                    \n                    {/* Liked By List (Mini) */}\n                    {profile && profile.likers && profile.likers.length > 0 && (\n                       <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800\">\n                          <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2\">\n                              <ThumbsUp size={20} className=\"text-slate-400\" />\n                              最近点赞\n                          </h3>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {profile.likers.map(liker => (\n                              <Link href={`/player/${liker}`} key={liker} title={liker}>\n                                <img \n                                  src={`https://cravatar.eu/helmavatar/${liker}/32.png`} \n                                  className=\"w-8 h-8 rounded-md border border-slate-200 dark:border-slate-700 hover:scale-110 transition-transform\"\n                                  alt={liker}\n                                />\n                              </Link>\n                            ))}\n                          </div>\n                       </div>\n                    )}\n     \n                    <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800\">\n                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2\">\n                            <Hash size={20} className=\"text-slate-400\" />\n                            基础信息\n                        </h3>\n                        <div className=\"space-y-4\">\n                            <div>\n                                <div className=\"text-xs text-slate-500 uppercase tracking-wider mb-1\">UUID</div>\n                                <div className=\"font-mono text-xs sm:text-sm bg-slate-100 dark:bg-slate-950 p-2 rounded select-all text-slate-700 dark:text-slate-300 break-all\">\n                                    {details.uuid}\n                                </div>\n                            </div>\n                            <div>\n                                <div className=\"text-xs text-slate-500 uppercase tracking-wider mb-1\">绑定的QQ</div>\n                                <div className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\n                                    <MessageSquare size={16} />\n                                    <span>{details.qq || '未绑定'}</span>\n                                </div>\n                            </div>\n                             <div>\n                                <div className=\"text-xs text-slate-500 uppercase tracking-wider mb-1\">最近活跃 (7天)</div>\n                                <div className=\"text-slate-700 dark:text-slate-300\">\n                                    {details.recent_week_hours} 小时 ({details.recent_week_minutes} 分钟)\n                                </div>\n                            </div>\n                            <div>\n                                <div className=\"text-xs text-slate-500 uppercase tracking-wider mb-1\">最后登出</div>\n                                <div className=\"text-slate-700 dark:text-slate-300 font-mono text-sm\">\n                                    {details.last_logout ? new Date(details.last_logout).toLocaleString() : '未知'}\n                                </div>\n                            </div>\n                            <div>\n                                <div className=\"text-xs text-slate-500 uppercase tracking-wider mb-1\">登录次数</div>\n                                <div className=\"text-slate-700 dark:text-slate-300 font-mono text-sm\">\n                                    {details.login_count} 次\n                                </div>\n                            </div>\n                            <div>\n                                 <div className=\"text-xs text-slate-500 uppercase tracking-wider mb-1\">最近游玩</div>\n                                 <div className=\"text-slate-700 dark:text-slate-300 font-mono text-sm\">\n                                     {details.last_play_date || '未知'}\n                                 </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Violation Records */}\n                    {(details.warn_count > 0 || details.ban_count > 0) && (\n                        <div className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800\">\n                            <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2\">\n                                <AlertTriangle size={20} className=\"text-slate-400\" />\n                                违规记录\n                            </h3>\n                            <div className=\"space-y-3 max-h-[400px] overflow-y-auto pr-1 custom-scrollbar\">\n                                {details.ban_history && details.ban_history.map((ban, idx) => (\n                                    <div key={`ban-${idx}`} className=\"p-3 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-100 dark:border-red-900/30\">\n                                        <div className=\"flex items-center justify-between mb-1\">\n                                            <span className=\"px-1.5 py-0.5 bg-red-500 text-white text-[10px] rounded font-bold uppercase\">封禁</span>\n                                            <span className=\"text-xs text-red-600 dark:text-red-400 font-medium\">\n                                                {formatHistoryDate(ban.time || ban.created)}\n                                            </span>\n                                        </div>\n                                        <div className=\"text-sm text-slate-700 dark:text-slate-300 font-medium mb-1 break-words\">\n                                            {ban.reason}\n                                        </div>\n                                        <div className=\"flex justify-between items-center text-xs text-slate-500\">\n                                            <span>操作: {ban.banned_by_name}</span>\n                                            <span>{ban.active ? '生效中' : '已过期'}</span>\n                                        </div>\n                                    </div>\n                                ))}\n                                {details.warn_history && details.warn_history.map((warn, idx) => (\n                                    <div key={`warn-${idx}`} className=\"p-3 bg-orange-50 dark:bg-orange-900/10 rounded-xl border border-orange-100 dark:border-orange-900/30\">\n                                        <div className=\"flex items-center justify-between mb-1\">\n                                            <span className=\"px-1.5 py-0.5 bg-orange-500 text-white text-[10px] rounded font-bold uppercase\">警告</span>\n                                            <span className=\"text-xs text-orange-600 dark:text-orange-400 font-medium\">\n                                                {formatHistoryDate(warn.time || warn.created_at)}\n                                            </span>\n                                        </div>\n                                        <div className=\"text-sm text-slate-700 dark:text-slate-300 font-medium mb-1 break-words\">\n                                            {warn.reason}\n                                        </div>\n                                        <div className=\"flex justify-between items-center text-xs text-slate-500\">\n                                            <span>操作: {warn.operator}</span>\n                                            {warn.kicked && <span>已踢出</span>}\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n                 </div>\n     \n                 {/* Right Column: Message Board */}\n                 <div className=\"lg:col-span-2\">\n                   <CommentSection \n                       comments={comments}\n                       currentUser={user}\n                       onSubmit={handleCommentSubmit}\n                       onDelete={handleDeleteComment}\n                       onLike={handleLikeComment}\n                       loading={msgLoading}\n                       title=\"留言板\"\n                       className=\"bg-white/80 dark:bg-slate-900/50 backdrop-blur-md border border-slate-200 dark:border-slate-800 h-full\"\n                   />\n                 </div>\n              </div>\n            </motion.div>\n          ) : activeTab === 'posts' ? (\n            <motion.div\n              key=\"posts\"\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              transition={{ duration: 0.3, ease: \"easeOut\" }}\n              className=\"space-y-6\"\n            >\n              <div className=\"grid grid-cols-1 gap-6\">\n                {postsLoading ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 size={32} className=\"animate-spin text-emerald-500\" />\n                  </div>\n                ) : userPosts && userPosts.length > 0 ? (\n                  userPosts.map(post => (\n                    <PostCard \n                      key={`${post.type || 'post'}-${post.id}`} \n                      post={post} \n                      onUpdate={handlePostUpdate}\n                      onDelete={handlePostDelete}\n                    />\n                  ))\n                ) : (\n                  <div className=\"text-center py-12 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700\">\n                    <p className=\"text-slate-500\">暂时没有动态</p>\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          ) : activeTab === 'collections' ? (\n            <motion.div\n              key=\"collections\"\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              transition={{ duration: 0.3, ease: \"easeOut\" }}\n              className=\"space-y-6\"\n            >\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\n                {postsLoading ? (\n                   <div className=\"flex justify-center py-12 col-span-full\">\n                    <Loader2 size={32} className=\"animate-spin text-emerald-500\" />\n                  </div>\n                ) : ((userCollections?.length || 0) === 0 && (collectedAlbums?.length || 0) === 0) ? (\n                  <div className=\"text-center py-12 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 col-span-full\">\n                    <p className=\"text-slate-500\">暂时没有收藏的内容</p>\n                  </div>\n                ) : (\n                  <>\n                  {/* Merge and Sort Collections */}\n                  {[\n                    ...(userCollections || []).map(item => ({ type: (item.type || 'post') as 'post' | 'album', data: item, date: item.created_at })),\n                    ...(collectedAlbums || []).map(album => ({ type: 'album' as const, data: album, date: album.created_at }))\n                  ]\n                  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\n                  .map((item, idx) => (\n                    <div key={`${item.type}-${item.data.id}-${idx}`} className=\"h-full\">\n                      {item.type === 'post' ? (\n                        /* Compact Post Card */\n                        <Link href={`/activity/${(item.data as Post).id}`} className=\"block group h-full\">\n                          <div className=\"bg-white dark:bg-slate-900 rounded-xl overflow-hidden border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-all duration-300 h-full flex flex-col relative aspect-square\">\n                            {/* Type Badge */}\n                            <div className=\"absolute top-2 right-2 z-10\">\n                                <span className=\"px-2 py-1 bg-black/40 backdrop-blur-sm text-white text-[10px] rounded-full flex items-center gap-1\">\n                                    <Activity size={10} />\n                                    动态\n                                </span>\n                            </div>\n\n                            {/* Post Image Cover if available */}\n                            {(item.data as Post).images && (item.data as Post).images!.length > 0 ? (\n                               <div className=\"relative h-[60%] overflow-hidden bg-slate-100 dark:bg-slate-800 flex-shrink-0\">\n                                 <img \n                                   src={(item.data as Post).images![0]} \n                                   alt={(item.data as Post).title}\n                                   className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\n                                 />\n                                 {(item.data as Post).images!.length > 1 && (\n                                   <div className=\"absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-0.5 rounded-full backdrop-blur-sm\">\n                                     +{(item.data as Post).images!.length - 1}\n                                   </div>\n                                 )}\n                               </div>\n                            ) : (\n                               /* Text-only Post visual pattern */\n                               <div className=\"h-[60%] p-4 bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 dark:from-indigo-900/20 dark:via-purple-900/20 dark:to-pink-900/20 border-b border-slate-100 dark:border-slate-800 flex flex-col justify-center items-center text-center relative overflow-hidden flex-shrink-0\">\n                                  <div className=\"absolute top-0 left-0 w-full h-full opacity-30\" style={{ backgroundImage: 'radial-gradient(circle at 2px 2px, rgba(0,0,0,0.05) 1px, transparent 0)', backgroundSize: '16px 16px' }}></div>\n                                  <MessageSquare size={24} className=\"text-indigo-400/50 mb-2 relative z-10\" />\n                                  <h3 className=\"font-bold text-slate-800 dark:text-slate-200 line-clamp-2 relative z-10 px-2 text-sm\">\n                                    {(item.data as Post).title}\n                                  </h3>\n                               </div>\n                            )}\n                            \n                            <div className=\"p-3 flex-1 flex flex-col justify-between overflow-hidden\">\n                              <div>\n                                {/* Show title here only if image post (text post shows title in header) */}\n                                {((item.data as Post).images && (item.data as Post).images!.length > 0) && (\n                                  <h3 className=\"font-bold text-slate-900 dark:text-white mb-1 line-clamp-1 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors text-sm\">\n                                    {(item.data as Post).title}\n                                  </h3>\n                                )}\n\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400 line-clamp-2 mb-2\">\n                                  {(item.data as Post).content.replace(/[#*`]/g, '')}\n                                </p>\n                              </div>\n                              \n                              <div className=\"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-slate-800 mt-auto\">\n                                <div className=\"flex items-center gap-2 min-w-0\">\n                                   <img \n                                      src={`https://cravatar.eu/helmavatar/${(item.data as Post).author.username}/24.png`} \n                                      className=\"w-5 h-5 rounded-full flex-shrink-0\"\n                                      alt={(item.data as Post).author.username}\n                                   />\n                                   <span className=\"text-xs text-slate-500 truncate\">\n                                     {(item.data as Post).author.nickname || (item.data as Post).author.username}\n                                   </span>\n                                </div>\n                                <div className=\"flex items-center gap-3 text-xs text-slate-400 flex-shrink-0\">\n                                   <span className=\"flex items-center gap-1\">\n                                     <Heart size={12} className={clsx((item.data as Post).is_liked && \"fill-red-500 text-red-500\")} />\n                                     {(item.data as Post).likes_count}\n                                   </span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </Link>\n                      ) : (\n                        /* Album Card - Fixed aspect ratio */\n                        <div className=\"group relative rounded-xl overflow-hidden bg-slate-100 dark:bg-slate-800 cursor-pointer border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-all h-full flex flex-col aspect-square\" onClick={() => openAlbumDetail(item.data as Album)}>\n                           <div className=\"relative h-[75%] overflow-hidden flex-shrink-0\">\n                             {/* Type Badge */}\n                             <div className=\"absolute top-2 right-2 z-10\">\n                                <span className=\"px-2 py-1 bg-black/40 backdrop-blur-sm text-white text-[10px] rounded-full flex items-center gap-1\">\n                                    <ImageIcon size={10} />\n                                    相册\n                                </span>\n                             </div>\n\n                             <img \n                              src={getThumbnailUrl((item.data as Album).image_url)} \n                              alt={(item.data as Album).description || (item.data as Album).title} \n                              className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\" \n                              onError={(e) => {\n                                // Fallback to original image if thumbnail fails\n                                (e.target as HTMLImageElement).src = (item.data as Album).image_url;\n                              }}\n                            />\n                             <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4\">\n                               <h4 className=\"text-white font-bold text-sm line-clamp-1 mb-1\">{(item.data as Album).title}</h4>\n                               <p className=\"text-slate-200 text-xs line-clamp-2\">{(item.data as Album).description}</p>\n                             </div>\n                           </div>\n                           {/* Footer for Album to match Post card style */}\n                           <div className=\"p-3 bg-white dark:bg-slate-900 flex items-center justify-between flex-1 border-t border-slate-100 dark:border-slate-800\">\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                 <img \n                                    src={`https://cravatar.eu/helmavatar/${(item.data as any).author?.username || (item.data as Album).username}/24.png`} \n                                    className=\"w-5 h-5 rounded-full flex-shrink-0\"\n                                    alt={(item.data as any).author?.username || (item.data as Album).username}\n                                 />\n                                 <span className=\"text-xs text-slate-500 truncate\">\n                                   {(item.data as any).author?.nickname || (item.data as any).author?.username || (item.data as Album).username}\n                                 </span>\n                              </div>\n                              <div className=\"flex items-center gap-3 text-xs text-slate-400 flex-shrink-0\">\n                                 <span className=\"flex items-center gap-1\">\n                                   <Heart size={12} className={clsx((item.data as Album).is_liked && \"fill-red-500 text-red-500\")} />\n                                   {(item.data as any).likes_count !== undefined ? (item.data as any).likes_count : (item.data as Album).likes}\n                                 </span>\n                              </div>\n                           </div>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                  </>\n                )}\n              </div>\n            </motion.div>\n          ) : (\n             <motion.div\n               key=\"albums\"\n               initial={{ opacity: 0, x: 20 }}\n               animate={{ opacity: 1, x: 0 }}\n               exit={{ opacity: 0, x: -20 }}\n               transition={{ duration: 0.3, ease: \"easeOut\" }}\n               className=\"space-y-6\"\n             >\n                {/* Album Header */}\n                <div className=\"flex flex-col md:flex-row items-center justify-between gap-4 bg-white/80 dark:bg-slate-900/50 backdrop-blur-md p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm\">\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2\">\n                      <ImageIcon className=\"text-purple-500\" size={28} />\n                      {details.username} 的相册\n                    </h2>\n                    <p className=\"text-slate-500 dark:text-slate-400 mt-1\">\n                      共 {albums.length} 张照片 • 收获 {albums.reduce((acc, curr) => acc + curr.likes, 0)} 个赞\n                    </p>\n                  </div>\n                  \n                  {user && user.username === details.username && (\n                    <button \n                      onClick={() => setShowUploadModal(true)}\n                      className=\"px-6 py-2.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-xl font-medium shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95 flex items-center gap-2\"\n                    >\n                      <Upload size={18} />\n                      上传新照片\n                    </button>\n                  )}\n                </div>\n       \n                 {isAlbumLoading ? (\n                    <div className=\"flex justify-center py-24\">\n                       <div className=\"flex flex-col items-center gap-4\">\n                          <Loader2 size={48} className=\"text-purple-500 animate-spin\" />\n                          <p className=\"text-slate-500\">加载精彩瞬间...</p>\n                       </div>\n                    </div>\n                 ) : albums.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-24 bg-white/50 dark:bg-slate-900/30 rounded-3xl border-2 border-dashed border-slate-200 dark:border-slate-800\">\n                       <div className=\"w-24 h-24 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-6\">\n                          <ImageIcon size={40} className=\"text-slate-300 dark:text-slate-600\" />\n                       </div>\n                       <h3 className=\"text-xl font-medium text-slate-900 dark:text-white mb-2\">相册空空如也</h3>\n                       <p className=\"text-slate-500 dark:text-slate-400 max-w-sm text-center mb-8\">\n                         {user && user.username === details.username \n                           ? \"快来分享你在服务器里的第一个精彩瞬间吧！\" \n                           : \"这位玩家还没有上传过任何照片，稍后再来看看吧。\"}\n                       </p>\n                       {user && user.username === details.username && (\n                         <button \n                           onClick={() => setShowUploadModal(true)}\n                           className=\"px-6 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors\"\n                         >\n                           立即上传\n                         </button>\n                       )}\n                    </div>\n                 ) : (\n                    <div className=\"columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6\">\n                      {albums.map(album => (\n                        <div \n                          key={album.id} \n                          className=\"break-inside-avoid group relative bg-white dark:bg-slate-900 rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-xl hover:shadow-purple-500/10 transition-all duration-300 cursor-pointer\"\n                          onClick={() => openAlbumDetail(album)}\n                        >\n                           <div className=\"relative aspect-auto overflow-hidden\">\n                             <img \n                               src={getThumbnailUrl(album.image_url)} \n                               alt={album.title}\n                               className=\"w-full h-auto object-cover transition-transform duration-700 group-hover:scale-105\"\n                               loading=\"lazy\"\n                               onError={(e) => {\n                                 (e.target as HTMLImageElement).src = album.image_url;\n                               }}\n                             />\n                             <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n                           </div>\n                           \n                           <div className=\"p-4\">\n                              <h4 className=\"font-bold text-slate-900 dark:text-white mb-1 line-clamp-1 group-hover:text-purple-500 transition-colors\">\n                                {album.title}\n                              </h4>\n                              {album.description && (\n                                <p className=\"text-sm text-slate-500 dark:text-slate-400 line-clamp-2 mb-3\">\n                                  {album.description}\n                                </p>\n                              )}\n                              \n                              <div className=\"flex items-center justify-between pt-3 border-t border-slate-100 dark:border-slate-800\">\n                                 <div className=\"text-xs text-slate-400\">\n                                   {new Date(album.created_at).toLocaleDateString()}\n                                 </div>\n                                 <div className=\"flex items-center gap-3 text-sm text-slate-500\">\n                                    <span className={clsx(\"flex items-center gap-1\", album.is_liked && \"text-red-500\")}>\n                                       <Heart size={14} className={clsx(album.is_liked && \"fill-current\")} />\n                                       {album.likes}\n                                    </span>\n                                    <span className=\"flex items-center gap-1\">\n                                       <MessageCircle size={14} />\n                                       {album.comment_count}\n                                    </span>\n                                 </div>\n                              </div>\n                           </div>\n                        </div>\n                      ))}\n                    </div>\n                 )}\n             </motion.div>\n           )}\n         </AnimatePresence>\n\n        {/* Warning Banner */}\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/50 rounded-xl p-4 flex items-start gap-3\">\n          <AlertTriangle className=\"text-red-500 shrink-0 mt-0.5\" size={20} />\n          <div>\n            <h4 className=\"font-bold text-red-600 dark:text-red-400 text-sm mb-1\">文明用语提醒</h4>\n            <p className=\"text-sm text-red-500/80 dark:text-red-400/80\">\n              请在个人简介、签名及留言中保持文明用语。严禁发布广告、辱骂、色情或政治敏感内容。\n              违规者将被永久封禁账号并清空所有数据。\n            </p>\n          </div>\n        </div>\n\n      </div>\n\n\n\n      {/* User List Modal */}\n      <UserListModal \n        isOpen={showUserList !== null}\n        onClose={() => setShowUserList(null)}\n        title={showUserList === 'following' ? '关注列表' : '粉丝列表'}\n        users={userList}\n        loading={userListLoading}\n      />\n\n      {/* Upload Modal */}\n      <AnimatePresence>\n        {showUploadModal && (\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n            <motion.div \n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"absolute inset-0 bg-black/60 backdrop-blur-md\"\n              onClick={() => setShowUploadModal(false)}\n            />\n            <motion.div \n              initial={{ scale: 0.95, opacity: 0, y: 20 }}\n              animate={{ scale: 1, opacity: 1, y: 0 }}\n              exit={{ scale: 0.95, opacity: 0, y: 20 }}\n              className=\"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-slate-200 dark:border-slate-800\"\n            >\n              <div className=\"px-8 py-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center\">\n                <div>\n                   <h3 className=\"text-2xl font-bold text-slate-900 dark:text-white\">上传新照片</h3>\n                   <p className=\"text-slate-500 dark:text-slate-400 text-sm mt-1\">分享你在服务器里的精彩瞬间</p>\n                </div>\n                <button onClick={closeUploadModal} className=\"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors\" title=\"关闭\">\n                  <X size={24} />\n                </button>\n              </div>\n              \n              <form onSubmit={handleUpload} className=\"p-8 space-y-6\">\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-semibold text-slate-700 dark:text-slate-300\">\n                    照片标题 <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    type=\"text\"\n                    required\n                    value={uploadForm.title}\n                    onChange={(e) => setUploadForm({...uploadForm, title: e.target.value})}\n                    className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-white focus:ring-2 focus:ring-slate-900 dark:focus:ring-white focus:border-transparent transition-all placeholder:text-slate-400\"\n                    placeholder=\"给这张照片起个好听的名字...\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-semibold text-slate-700 dark:text-slate-300\">\n                    照片描述 <span className=\"text-slate-400 font-normal\">(选填)</span>\n                  </label>\n                  <textarea\n                    value={uploadForm.description}\n                    onChange={(e) => setUploadForm({...uploadForm, description: e.target.value})}\n                    className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-white focus:ring-2 focus:ring-slate-900 dark:focus:ring-white focus:border-transparent h-32 resize-none transition-all placeholder:text-slate-400\"\n                    placeholder=\"这张照片背后有什么故事？说来听听...\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                   <label className=\"block text-sm font-semibold text-slate-700 dark:text-slate-300\">\n                    选择图片 <span className=\"text-red-500\">*</span>\n                  </label>\n                  <div className=\"relative group\">\n                    <input \n                      type=\"file\" \n                      accept=\"image/*\"\n                      onChange={(e) => setUploadForm({...uploadForm, file: e.target.files ? e.target.files[0] : null})}\n                      className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10\"\n                    />\n                    <div className={clsx(\n                      \"w-full border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center gap-3 transition-all\",\n                      uploadForm.file \n                        ? \"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/10\" \n                        : \"border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-950 group-hover:border-slate-400 dark:group-hover:border-slate-600\"\n                    )}>\n                       {uploadForm.file ? (\n                          <>\n                             <ImageIcon size={32} className=\"text-emerald-500\" />\n                             <div className=\"text-center\">\n                                <p className=\"font-medium text-emerald-700 dark:text-emerald-400\">{uploadForm.file.name}</p>\n                                <p className=\"text-xs text-emerald-600/70 dark:text-emerald-400/70 mt-1\">点击可更换图片</p>\n                                <p className=\"text-xs text-slate-400 mt-1\">{(uploadForm.file.size / 1024 / 1024).toFixed(2)} MB</p>\n                             </div>\n                          </>\n                       ) : (\n                          <>\n                             <div className=\"p-3 bg-white dark:bg-slate-800 rounded-full shadow-sm\">\n                                <Upload size={24} className=\"text-slate-400\" />\n                             </div>\n                             <div className=\"text-center\">\n                                <p className=\"font-medium text-slate-600 dark:text-slate-300\">点击或拖拽上传图片</p>\n                                <p className=\"text-xs text-slate-400 mt-1\">支持 JPG, PNG, GIF 格式 (自动压缩)</p>\n                             </div>\n                          </>\n                       )}\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"pt-6 flex justify-end gap-4 border-t border-slate-100 dark:border-slate-800\">\n                  <button \n                    type=\"button\"\n                    onClick={closeUploadModal}\n                    className=\"px-6 py-2.5 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors font-medium\"\n                  >\n                    取消\n                  </button>\n                  <button \n                    type=\"submit\"\n                    disabled={isUploading || !uploadForm.file}\n                    className=\"px-8 py-2.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-xl hover:opacity-90 disabled:opacity-50 flex items-center gap-2 font-bold shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5\"\n                  >\n                    {isUploading ? (\n                      <>\n                        <Loader2 size={18} className=\"animate-spin\" />\n                        处理中...\n                      </>\n                    ) : (\n                      <>\n                        <Upload size={18} />\n                        发布照片\n                      </>\n                    )}\n                  </button>\n                </div>\n              </form>\n            </motion.div>\n          </div>\n        )}\n      </AnimatePresence>\n\n      {/* Album Detail Modal */}\n      <AnimatePresence>\n        {selectedAlbum && (\n           <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n            <motion.div \n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"absolute inset-0 bg-black/80 backdrop-blur-md\"\n              onClick={() => setSelectedAlbum(null)}\n            />\n            <motion.div \n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.95, opacity: 0 }}\n              className=\"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-7xl overflow-hidden border border-slate-200 dark:border-slate-800 flex flex-col md:flex-row max-h-[90vh]\"\n            >\n               <button \n                  onClick={() => setSelectedAlbum(null)} \n                  className=\"absolute top-4 right-4 z-10 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition-colors md:hidden\"\n                  title=\"关闭\"\n                >\n                  <X size={20} />\n                </button>\n\n               {/* Image Side */}\n                <div className=\"flex-[1.5] bg-black flex items-center justify-center overflow-hidden relative group\">\n                   <img \n                     src={selectedAlbum.image_url} \n                     alt={selectedAlbum.title}\n                     className=\"max-w-full max-h-[50vh] md:max-h-full object-contain\"\n                   />\n                  \n                  {/* Delete Button (Owner/Admin) */}\n                  {(user && (user.username === selectedAlbum.username || isAdmin)) && (\n                    <button\n                      onClick={() => handleDeleteAlbum(selectedAlbum.id)}\n                      className=\"absolute top-4 right-4 p-2 bg-red-500/80 text-white rounded-lg hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100\"\n                      title=\"删除图片\"\n                    >\n                      <Trash2 size={20} />\n                    </button>\n                  )}\n               </div>\n\n               {/* Info Side */}\n               <div className=\"w-full md:w-[400px] flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-800\">\n                  <div className=\"p-6 border-b border-slate-200 dark:border-slate-800 flex-shrink-0\">\n                     <div className=\"flex items-start justify-between mb-4\">\n                        <div>\n                           <h3 className=\"text-xl font-bold text-slate-900 dark:text-white mb-1\">{selectedAlbum.title}</h3>\n                           <div className=\"text-sm text-slate-500 flex items-center gap-2\">\n                              <span>{new Date(selectedAlbum.created_at).toLocaleDateString()}</span>\n                              <span>•</span>\n                              <span>{selectedAlbum.username}</span>\n                           </div>\n                        </div>\n                        <button onClick={() => setSelectedAlbum(null)} className=\"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 hidden md:block\" title=\"关闭\">\n                          <X size={20} />\n                        </button>\n                     </div>\n                     \n                     {selectedAlbum.description && (\n                        <p className=\"text-slate-600 dark:text-slate-300 text-sm mb-4 whitespace-pre-wrap\">\n                           {selectedAlbum.description}\n                        </p>\n                     )}\n\n                     <div className=\"flex items-center gap-4\">\n                        <button \n                          onClick={() => handleAlbumLike(selectedAlbum)}\n                          disabled={!user}\n                          className={clsx(\n                            \"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-all border text-sm font-medium\",\n                            selectedAlbum.is_liked \n                              ? \"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800\" \n                              : \"bg-slate-100 dark:bg-slate-800 text-slate-500 border-transparent hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20\",\n                             !user && \"opacity-50 cursor-not-allowed\"\n                          )}\n                        >\n                           <Heart size={16} className={clsx(selectedAlbum.is_liked && \"fill-current\")} />\n                           {selectedAlbum.likes}\n                        </button>\n\n                        <button \n                          onClick={() => handleAlbumCollect(selectedAlbum)}\n                          disabled={!user}\n                          className={clsx(\n                            \"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-all border text-sm font-medium\",\n                            selectedAlbum.is_collected \n                              ? \"bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800\" \n                              : \"bg-slate-100 dark:bg-slate-800 text-slate-500 border-transparent hover:text-amber-500 dark:hover:text-amber-400 hover:bg-amber-50 dark:hover:bg-amber-900/20\",\n                             !user && \"opacity-50 cursor-not-allowed\"\n                          )}\n                        >\n                           <Bookmark size={16} className={clsx(selectedAlbum.is_collected && \"fill-current\")} />\n                           {selectedAlbum.is_collected ? '已收藏' : '收藏'}\n                        </button>\n                     </div>\n                  </div>\n\n                  {/* Comments List */}\n                  <div className=\"flex-1 overflow-y-auto p-6 space-y-4 min-h-[200px]\">\n                     {isCommentLoading ? (\n                        <div className=\"flex justify-center py-8\">\n                           <Loader2 size={24} className=\"text-purple-500 animate-spin\" />\n                        </div>\n                     ) : !albumComments || albumComments.length === 0 ? (\n                        <div className=\"text-center py-8 text-slate-500\">\n                           <p>暂无评论，快来抢沙发~</p>\n                        </div>\n                     ) : (\n                        albumComments.map(comment => (\n                           <div key={comment.id} className=\"flex gap-3 group\">\n                              <Link href={`/player/${comment.username}`}>\n                                <img \n                                  src={`https://cravatar.eu/helmavatar/${comment.username}/32.png`} \n                                  alt={comment.username}\n                                  className=\"w-8 h-8 rounded-md flex-shrink-0 bg-slate-200 hover:opacity-80 transition-opacity\"\n                                />\n                              </Link>\n                              <div className=\"flex-1 min-w-0\">\n                                 <div className=\"flex items-baseline justify-between mb-1\">\n                                    <Link href={`/player/${comment.username}`} className=\"font-bold text-sm text-slate-900 dark:text-white hover:text-emerald-500 hover:underline transition-colors\">\n                                      {comment.username}\n                                    </Link>\n                                    <span className=\"text-xs text-slate-400\">{new Date(comment.created_at).toLocaleDateString()}</span>\n                                 </div>\n                                 <p className=\"text-sm text-slate-600 dark:text-slate-300 break-words\">{comment.content}</p>\n                              </div>\n                              {/* Delete Comment (Admin/Owner) */}\n                              {(user && (user.username === comment.username || user.username === selectedAlbum.username || isAdmin)) && (\n                                 <button \n                                   onClick={async () => {\n                                      const isConfirmed = await confirm({\n                                        title: '删除评论',\n                                        message: '确定要删除这条评论吗？',\n                                        isDangerous: true,\n                                        confirmText: '删除'\n                                      });\n                                      if (!isConfirmed) return;\n                                      try {\n                                         await api.delete(`/api/album/comment/${comment.id}`, { headers: { Authorization: `Bearer ${token}` } });\n                                         setAlbumComments(prev => prev.filter(c => c.id !== comment.id));\n                                         // Update count\n                                         setAlbums(prev => prev.map(a => a.id === selectedAlbum.id ? { ...a, comment_count: Math.max(0, a.comment_count - 1) } : a));\n                                         toastSuccess('删除成功');\n                                      } catch (e) { toastError('删除失败'); }\n                                   }}\n                                   className=\"text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity\"\n                                   title=\"删除评论\"\n                                 >\n                                   <Trash2 size={14} />\n                                 </button>\n                              )}\n                           </div>\n                        ))\n                     )}\n                  </div>\n\n                  {/* Comment Input */}\n                  <div className=\"p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950/30\">\n                     {user ? (\n                        <form onSubmit={handleAlbumComment} className=\"relative\">\n                           <input\n                             type=\"text\"\n                             value={newComment}\n                             onChange={(e) => setNewComment(e.target.value)}\n                             placeholder=\"写下你的评论...\"\n                             className=\"w-full pl-4 pr-12 py-2 rounded-lg border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-purple-500 text-sm\"\n                           />\n                           <button \n                             type=\"submit\"\n                             disabled={!newComment.trim() || isSendingComment}\n                             className=\"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-md disabled:opacity-50\"\n                             title=\"发送评论\"\n                           >\n                              {isSendingComment ? <Loader2 size={16} className=\"animate-spin\" /> : <Send size={16} />}\n                           </button>\n                        </form>\n                     ) : (\n                        <div className=\"text-center text-sm text-slate-500\">\n                           <Link href=\"/login\" className=\"text-purple-500 hover:underline\">登录</Link> 后参与评论\n                        </div>\n                     )}\n                  </div>\n               </div>\n            </motion.div>\n           </div>\n        )}\n      </AnimatePresence>\n      {/* Floating Music Player */}\n      <AnimatePresence>\n        {profile?.music_id && (\n          <motion.div\n            initial={{ opacity: 0, y: 50, scale: 0.9 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 50, scale: 0.9 }}\n            className=\"fixed bottom-6 right-6 z-40\"\n          >\n            <div className=\"relative group\">\n              {/* Main Player Card */}\n              <div className=\"bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl p-3 pr-4 rounded-full shadow-2xl border border-slate-200 dark:border-slate-800 flex items-center gap-3 transition-all hover:scale-105 hover:shadow-emerald-500/10\">\n                 {/* Album Art / Spinning Disc */}\n                 <div className=\"relative w-10 h-10 flex items-center justify-center\">\n                    <div className={clsx(\n                        \"absolute inset-0 rounded-full overflow-hidden border-2 border-slate-200 dark:border-slate-700 shadow-md bg-slate-900\",\n                        isPlaying ? \"animate-[spin_8s_linear_infinite]\" : \"\"\n                    )}>\n                       {musicMeta?.cover ? (\n                          <img src={musicMeta.cover} alt=\"Cover\" className=\"w-full h-full object-cover\" />\n                       ) : (\n                          <div className=\"w-full h-full bg-[repeating-radial-gradient(#333_0,#333_2px,#000_3px,#000_4px)] opacity-50\"></div>\n                       )}\n                    </div>\n                    {!musicMeta?.cover && (\n                        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-emerald-500 rounded-full border-2 border-white dark:border-slate-900 z-10\"></div>\n                    )}\n                    {musicMeta?.cover && (\n                         <div className=\"absolute w-2 h-2 bg-white/20 backdrop-blur-sm rounded-full top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border border-white/40\"></div>\n                    )}\n                 </div>\n                 \n                 {/* Controls & Info */}\n                 <div className=\"flex flex-col gap-1 min-w-[140px]\">\n                    <div className=\"flex items-center justify-between gap-4\">\n                       <div className=\"flex flex-col overflow-hidden\">\n                          <span className=\"text-xs font-bold text-slate-800 dark:text-slate-200 max-w-[110px] truncate leading-tight\">\n                            {musicMeta?.name || \"加载中...\"}\n                          </span>\n                          <span className=\"text-[10px] text-slate-500 dark:text-slate-400 max-w-[110px] truncate leading-tight\">\n                            {musicMeta?.artist || \"网易云音乐\"}\n                          </span>\n                       </div>\n                       \n                       <button \n                         onClick={() => {\n                            if (audioRef.current) {\n                                if (isPlaying) audioRef.current.pause();\n                                else audioRef.current.play();\n                            }\n                         }}\n                         className=\"w-8 h-8 flex items-center justify-center bg-slate-100 dark:bg-slate-800 rounded-full hover:bg-emerald-500 hover:text-white text-slate-700 dark:text-slate-200 transition-colors flex-shrink-0\"\n                       >\n                          {isPlaying ? <Pause size={14} className=\"fill-current\" /> : <Play size={14} className=\"fill-current ml-0.5\" />}\n                       </button>\n                    </div>\n                    \n                    {/* Progress Bar */}\n                    <div className=\"w-full h-1 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden cursor-pointer\"\n                         onClick={(e) => {\n                             if (audioRef.current) {\n                                 const rect = e.currentTarget.getBoundingClientRect();\n                                 const x = e.clientX - rect.left;\n                                 const width = rect.width;\n                                 const percent = x / width;\n                                 audioRef.current.currentTime = percent * audioRef.current.duration;\n                                 setProgress(percent * 100);\n                             }\n                         }}\n                    >\n                       <motion.div \n                          className=\"h-full bg-emerald-500 rounded-full\"\n                          style={{ width: `${progress}%` }}\n                          layoutId=\"progressBar\"\n                       />\n                    </div>\n                 </div>\n\n                 <audio \n                    ref={audioRef}\n                    src={musicMeta?.url || `https://music.163.com/song/media/outer/url?id=${profile.music_id}.mp3`}\n                    preload=\"auto\"\n                    loop\n                    onPlay={() => {\n                        setIsPlaying(true);\n                        setAutoplayBlocked(false);\n                    }}\n                    onPause={() => setIsPlaying(false)}\n                    onEnded={() => setIsPlaying(false)}\n                    onError={(e) => {\n                        console.error(\"Audio playback error:\", e);\n                        setIsPlaying(false);\n                    }}\n                    onTimeUpdate={() => {\n                        if (audioRef.current) {\n                            const current = audioRef.current.currentTime;\n                            const duration = audioRef.current.duration;\n                            if (duration) setProgress((current / duration) * 100);\n                        }\n                    }}\n                    className=\"hidden\"\n                 />\n              </div>\n              \n              {/* Tooltip */}\n              <div className={clsx(\n                  \"absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-xs py-1 px-2 rounded transition-opacity whitespace-nowrap pointer-events-none z-50\",\n                  autoplayBlocked ? \"opacity-100 animate-bounce\" : \"opacity-0 group-hover:opacity-100\"\n              )}>\n                 {autoplayBlocked ? \"点击播放背景音乐\" : \"正在播放用户设置的背景音乐\"}\n                 <div className=\"absolute bottom-[-4px] left-1/2 -translate-x-1/2 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-900\"></div>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\nexport default ProfileClient;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9301, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}