(()=>{var e={};e.id=202,e.ids=[202],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},41041:e=>{"use strict";e.exports=require("node:url")},77726:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),r(23673),r(12701),r(35866);var s=r(23191),a=r(88716),n=r(37922),i=r.n(n),o=r(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d=["",{children:["news",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,23673)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\news\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,12701)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\news\\[id]\\page.tsx"],u="/news/[id]/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/news/[id]/page",pathname:"/news/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},43007:(e,t,r)=>{Promise.resolve().then(r.bind(r,61717))},86333:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},37358:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},15515:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]])},59593:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]])},61717:(e,t,r)=>{"use strict";r.d(t,{default:()=>w});var s=r(10326),a=r(17577),n=r(35047),i=r(90434),o=r(88129),l=r(24846),d=r(9080),c=r(26394),u=r(86333),p=r(37358),m=r(79635),f=r(15515),x=r(33385),h=r(41135),b=r(74690),y=r(76910),g=r(23495);let v={thumbs_up:"\uD83D\uDC4D",thumbs_down:"\uD83D\uDC4E",laugh:"\uD83D\uDE04",hooray:"\uD83C\uDF89",confused:"\uD83D\uDE15",heart:"❤️",rocket:"\uD83D\uDE80",eyes:"\uD83D\uDC40"},w=({initialNews:e})=>{let t=(0,n.useRouter)(),{user:r}=(0,b.a)(),{showToast:w}=(0,y.p)(),[j,_]=(0,a.useState)(e),[k,N]=(0,a.useState)(!1),[P,M]=(0,a.useState)([]),[S,R]=(0,a.useState)(!0),[C,D]=(0,a.useState)([]);(0,a.useEffect)(()=>{E()},[j.id]);let E=()=>{x.ZP.get(`/api/website/news/${j.id}/comments`).then(e=>{let t=e.data,r=new Map,s=[];t.forEach(e=>{r.set(e.id,{id:e.id,content:e.content,created_at:e.created_at,parent_id:e.parent_id,author:{username:e.author_name,nickname:e.author_name,avatar:`https://cravatar.eu/helmavatar/${e.author_name}/100.png`},replies:[]})}),t.forEach(e=>{let t=r.get(e.id);if(e.parent_id){let a=r.get(e.parent_id);a?a.replies?.push(t):s.push(t)}else s.push(t)}),s.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),M(s),R(!1)}).catch(e=>console.error(e))},q=async(e,t)=>{if(j){if(t){let r=Date.now();D(s=>[...s,{id:r,emoji:v[e],x:t.clientX,y:t.clientY}]),setTimeout(()=>{D(e=>e.filter(e=>e.id!==r))},1e3)}try{await x.ZP.post(`/api/website/news/${j.id}/reaction`,{reaction_type:e,reactor_identifier:r?.username});let t=await x.ZP.get(`/api/website/news/${j.id}`);_(t.data)}catch(e){console.error(e),w("操作失败","error")}}},O=async(e,s)=>{if(j){if(!r){w("请先登录后再评论","error"),t.push("/login");return}try{await x.ZP.post(`/api/website/news/${j.id}/comments`,{author_name:r.username||"Anonymous",content:e,parent_id:s}),w("评论发表成功","success"),E()}catch(e){throw console.error(e),w("评论发表失败","error"),e}}},Z=async e=>{if(j&&confirm("确定要删除这条评论吗？"))try{await x.ZP.delete(`/api/website/news/${j.id}/comments/${e}`),w("删除成功","success"),E()}catch(e){console.error(e),w(e.response?.data?.detail||"删除失败","error")}};return s.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[s.jsx(o.M,{children:C.map(e=>s.jsx(l.E.div,{initial:{opacity:1,y:0,scale:.5},animate:{opacity:0,y:-100,scale:1.5},exit:{opacity:0},transition:{duration:.8,ease:"easeOut"},style:{position:"fixed",left:e.x,top:e.y,pointerEvents:"none",zIndex:9999,fontSize:"2rem",transform:"translate(-50%, -50%)"},children:e.emoji},e.id))}),(0,s.jsxs)(i.default,{href:"/news",className:"flex items-center text-slate-500 hover:text-emerald-500 mb-6 transition-colors inline-flex",children:[s.jsx(u.Z,{size:20,className:"mr-2"}),"返回列表"]}),(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-panel p-8 rounded-2xl relative mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-4",children:j.title}),(0,s.jsxs)("div",{className:"flex items-center text-slate-500 dark:text-slate-400 text-sm mb-8 pb-4 border-b border-slate-200 dark:border-white/10",children:[s.jsx(p.Z,{size:16,className:"mr-2"}),s.jsx("span",{className:"mr-6",children:new Date(j.created_at).toLocaleDateString()}),s.jsx(m.Z,{size:16,className:"mr-2"}),s.jsx("span",{children:j.author})]}),s.jsx("div",{className:"prose prose-slate dark:prose-invert prose-emerald max-w-none",children:s.jsx(d.UG,{remarkPlugins:[c.Z],components:{a:({node:e,...t})=>s.jsx("a",{...t,className:"text-emerald-600 dark:text-emerald-400 hover:text-emerald-500 transition-colors",target:"_blank",rel:"noopener noreferrer"}),img:({node:e,...t})=>s.jsx("img",{...t,className:"rounded-xl shadow-lg my-6"}),code:({node:e,inline:t,className:r,children:a,...n})=>t?s.jsx("code",{className:"bg-slate-100 dark:bg-slate-800/50 px-1.5 py-0.5 rounded text-emerald-600 dark:text-emerald-300 text-sm font-mono",...n,children:a}):s.jsx("pre",{className:"bg-slate-100 dark:bg-slate-950/50 p-4 rounded-lg overflow-x-auto border border-slate-200 dark:border-white/10 my-4",children:s.jsx("code",{className:r,...n,children:a})})},children:j.content})}),s.jsx("div",{className:"mt-12 pt-8 border-t border-slate-200 dark:border-white/10",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative",children:[s.jsx("button",{onClick:()=>N(!k),className:"flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 transition-colors border border-transparent hover:border-slate-300 dark:hover:border-slate-600",title:"Add reaction",children:s.jsx(f.Z,{size:18})}),s.jsx(o.M,{children:k&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>N(!1)}),s.jsx(l.E.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"absolute bottom-full left-0 mb-2 z-20 bg-white dark:bg-slate-800 rounded-full shadow-xl border border-slate-200 dark:border-slate-700 p-1 flex items-center gap-1 min-w-max",children:Object.entries(v).map(([e,t])=>{let r=j.user_selected_reactions?.includes(e);return s.jsx("button",{onClick:t=>{q(e,t),N(!1)},className:(0,h.Z)("w-9 h-9 flex items-center justify-center text-lg rounded-full transition-all hover:scale-110 active:scale-95",r?"bg-emerald-100 dark:bg-emerald-900/30":"hover:bg-slate-100 dark:hover:bg-slate-700"),title:e,children:t},e)})})]})})]}),Object.entries(j.reactions).map(([e,t])=>{if(t<=0)return null;let r=j.user_selected_reactions?.includes(e),a=j.reaction_users?.[e]||[],n="";if(a.length>0){let t=Array.from(new Set(a)),r=t.slice(0,5),s=t.length-5;n=r.join(", "),s>0&&(n+=` 等 ${s} 人`),n+=` 点了 ${v[e]}`}return(0,s.jsxs)("div",{className:"relative group/tooltip",children:[(0,s.jsxs)(l.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>q(e,t),className:(0,h.Z)("flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium transition-colors duration-200 border",r?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500/30 text-emerald-600 dark:text-emerald-400":"bg-transparent border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800"),children:[s.jsx("span",{children:v[e]}),s.jsx("span",{children:t})]}),n&&(0,s.jsxs)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-xs text-white bg-slate-800 rounded-lg opacity-0 group-hover/tooltip:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-50 shadow-xl",children:[n,s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"})]})]},e)})]})})]}),s.jsx(g.Z,{comments:P,currentUser:r,onSubmit:O,onDelete:Z,loading:S,title:"评论",className:"glass-panel p-8 rounded-2xl relative overflow-hidden"})]})})}},58585:(e,t,r)=>{"use strict";var s=r(61085);r.o(s,"notFound")&&r.d(t,{notFound:function(){return s.notFound}})},61085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return i},RedirectType:function(){return s.RedirectType},notFound:function(){return a.notFound},permanentRedirect:function(){return s.permanentRedirect},redirect:function(){return s.redirect}});let s=r(83953),a=r(16399);class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class i extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},16399:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isNotFoundError:function(){return a},notFound:function(){return s}});let r="NEXT_NOT_FOUND";function s(){let e=Error(r);throw e.digest=r,e}function a(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8586:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},83953:(e,t,r)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RedirectType:function(){return s},getRedirectError:function(){return l},getRedirectStatusCodeFromError:function(){return f},getRedirectTypeFromError:function(){return m},getURLFromRedirectError:function(){return p},isRedirectError:function(){return u},permanentRedirect:function(){return c},redirect:function(){return d}});let a=r(54580),n=r(72934),i=r(8586),o="NEXT_REDIRECT";function l(e,t,r){void 0===r&&(r=i.RedirectStatusCode.TemporaryRedirect);let s=Error(o);s.digest=o+";"+t+";"+e+";"+r+";";let n=a.requestAsyncStorage.getStore();return n&&(s.mutableCookies=n.mutableCookies),s}function d(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw l(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.TemporaryRedirect)}function c(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw l(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.PermanentRedirect)}function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r,s,a]=e.digest.split(";",4),n=Number(a);return t===o&&("replace"===r||"push"===r)&&"string"==typeof s&&!isNaN(n)&&n in i.RedirectStatusCode}function p(e){return u(e)?e.digest.split(";",3)[2]:null}function m(e){if(!u(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function f(e){if(!u(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(s||(s={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},23673:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,generateMetadata:()=>l,generateStaticParams:()=>d,revalidate:()=>i});var s=r(19510),a=r(58585);let n=(0,r(68570).createProxy)(String.raw`D:\编程\KukeMC-Website\KukeMC-WebSite\src\components\next\NewsDetailClient.tsx#default`),i=60;async function o(e){try{let t=await fetch(`https://api.kuke.ink/api/website/news/${e}`,{next:{revalidate:60}});if(!t.ok){if(404===t.status)return null;throw Error("Failed to fetch news")}return t.json()}catch(e){return console.error(e),null}}async function l({params:e}){let t=await o(e.id);return t?{title:`${t.title} - KukeMC`,description:t.content?t.content.substring(0,160).replace(/[#*`]/g,""):"KukeMC 服务器公告",openGraph:{title:t.title,description:t.content?t.content.substring(0,160):"KukeMC 服务器公告",type:"article",publishedTime:t.created_at,authors:[t.author]}}:{title:"公告不存在 - KukeMC"}}async function d(){return[]}async function c({params:e}){let t=await o(e.id);return t||(0,a.notFound)(),s.jsx(n,{initialNews:t})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[856,503,64,609,136,495],()=>r(77726));module.exports=s})();