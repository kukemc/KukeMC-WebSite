(()=>{var e={};e.id=750,e.ids=[750],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},41041:e=>{"use strict";e.exports=require("node:url")},15876:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>o}),s(62607),s(12701),s(35866);var r=s(23191),a=s(88716),l=s(37922),i=s.n(l),n=s(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);s.d(t,d);let o=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,62607)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\messages\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,12701)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\messages\\page.tsx"],u="/messages/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},37320:(e,t,s)=>{Promise.resolve().then(s.bind(s,74362))},98091:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},74362:(e,t,s)=>{"use strict";s.d(t,{default:()=>q});var r=s(10326),a=s(17577),l=s.n(a),i=s(24846),n=s(88129);let d=(0,s(62881).Z)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var o=s(98091),c=s(94019),u=s(77506),m=s(69436),x=s(40617),p=s(79635),h=s(41291),g=s(41135),b=s(33385),f=s(74690),v=s(90434);let j=l().forwardRef(({value:e,onChange:t,className:s,containerClassName:l,...i},n)=>{let[d,o]=(0,a.useState)([]),[c,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)(0),[h,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(""),[j,y]=(0,a.useState)(-1),k=(0,a.useRef)(null),N=(0,a.useRef)(null);(0,a.useEffect)(()=>{n&&("function"==typeof n?n(k.current):n.current=k.current)},[n]),(0,a.useEffect)(()=>{if(i.autoFocus&&k.current){let e=setTimeout(()=>{k.current?.focus()},50);return()=>clearTimeout(e)}},[i.autoFocus]),(0,a.useEffect)(()=>{if(!c)return;let e=setTimeout(async()=>{g(!0);try{let e=await b.ZP.get(`/api/profile/search?q=${f}`);o(e.data),p(0)}catch(e){console.error("Failed to search users",e)}finally{g(!1)}},300);return()=>clearTimeout(e)},[f,c]);let w=s=>{if(-1===j)return;let r=e.substring(0,j),a=e.substring(j+1+f.length),l=`${r}@${s.username} ${a}`;t({target:{value:l},currentTarget:{value:l}}),m(!1),setTimeout(()=>{if(k.current){k.current.focus();let e=j+1+s.username.length+1;k.current.setSelectionRange(e,e)}},0)};return(0,r.jsxs)("div",{className:`relative ${l||""}`,children:[r.jsx("textarea",{ref:k,value:e,onChange:e=>{t(e);let s=e.target.value,r=e.target.selectionStart,a=!1;for(let e=r-1;e>=0;e--){let t=s[e];if("@"===t){if(0===e||/\s/.test(s[e-1])){let t=s.substring(e+1,r);/\s/.test(t)||(y(e),v(t),m(!0),a=!0)}break}if(/\s/.test(t))break}a||m(!1)},onKeyDown:e=>{c&&d.length>0&&("ArrowDown"===e.key?(e.preventDefault(),p(e=>(e+1)%d.length)):"ArrowUp"===e.key?(e.preventDefault(),p(e=>(e-1+d.length)%d.length)):"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),w(d[x])):"Escape"===e.key&&m(!1))},className:s,...i}),c&&r.jsx("div",{ref:N,className:"absolute z-50 w-64 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden mt-1 left-0",style:{top:"100%"},children:h?(0,r.jsxs)("div",{className:"p-2 flex items-center justify-center text-slate-500",children:[r.jsx(u.Z,{size:16,className:"animate-spin mr-2"})," 搜索中..."]}):d.length>0?r.jsx("ul",{className:"max-h-48 overflow-y-auto",children:d.map((e,t)=>(0,r.jsxs)("li",{onClick:()=>w(e),className:`flex items-center px-3 py-2 cursor-pointer transition-colors ${t===x?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"hover:bg-slate-50 dark:hover:bg-slate-700/50 text-slate-700 dark:text-slate-200"}`,children:[r.jsx("img",{src:e.avatar||`https://cravatar.eu/helmavatar/${e.username}/16.png`,alt:e.username,className:"w-6 h-6 rounded-full mr-2"}),r.jsx("span",{className:"text-sm",children:e.username})]},e.username))}):r.jsx("div",{className:"p-2 text-center text-slate-500 text-xs",children:"没有找到用户"})})]})});var y=s(9080),k=s(26394),N=s(76910),w=s(45213);let S=({content:e})=>{let t=e.replace(/@([^ \t\n\r\f\v@,.!?;:，。！？]+)/g,(e,t)=>`[${e}](/player/${t})`);return r.jsx("div",{className:"text-slate-600 dark:text-slate-300 whitespace-pre-wrap break-words text-sm sm:text-base leading-relaxed",children:r.jsx(y.UG,{remarkPlugins:[k.Z],components:{a:({node:e,...t})=>r.jsx(v.default,{href:t.href||"#",className:"text-emerald-500 hover:underline",onClick:e=>e.stopPropagation(),children:t.children}),p:({node:e,...t})=>r.jsx("span",{...t})},children:t})})},C=({msg:e,depth:t=0,user:s,isAdmin:a,replyingTo:l,setReplyingTo:x,replyContent:p,setReplyContent:h,handleReply:b,handleDelete:f,isReplying:y,formatTime:k})=>{let N=l===e.id;return(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:(0,g.Z)("flex flex-col relative",t>0&&"mt-4"),children:[t>0&&r.jsx("div",{className:"absolute -left-4 top-0 bottom-0 w-[2px] bg-slate-200 dark:bg-slate-700 rounded-full"}),(0,r.jsxs)("div",{className:(0,g.Z)("glass-panel p-5 rounded-2xl relative group transition-all duration-300 border border-slate-100/50 dark:border-slate-700/50","hover:bg-white/90 dark:hover:bg-slate-800/90 hover:shadow-lg hover:shadow-emerald-500/5 hover:-translate-y-0.5",t>0?"bg-slate-50/80 dark:bg-slate-800/30":"bg-white/60 dark:bg-slate-900/60"),children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[r.jsx(v.default,{href:`/player/${e.player}`,className:"relative flex-shrink-0",children:r.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl overflow-hidden ring-2 ring-slate-100 dark:ring-slate-700 shadow-sm group-hover:ring-emerald-400 dark:group-hover:ring-emerald-500 transition-all duration-300",children:r.jsx("img",{src:`https://cravatar.eu/helmavatar/${encodeURIComponent(e.player)}/128.png`,alt:e.player,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500",loading:"lazy",onError:e=>{e.target.src="https://cravatar.eu/helmavatar/MHF_Steve/128.png"}})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-2 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx(v.default,{href:`/player/${e.player}`,className:"font-bold text-base text-slate-800 dark:text-slate-200 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors duration-300 hover:underline",children:e.player}),(0,r.jsxs)("span",{className:"text-xs font-mono text-slate-400 dark:text-slate-500 bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded",children:["#",e.id]}),e.recipient&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-sm text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-800/50 px-2 py-0.5 rounded-full",children:[r.jsx("span",{className:"text-xs",children:"To"}),(0,r.jsxs)(v.default,{href:`/player/${e.recipient}`,className:"font-medium text-emerald-600 dark:text-emerald-400 hover:underline flex items-center gap-1",children:[r.jsx("img",{src:`https://cravatar.eu/helmavatar/${e.recipient}/16.png`,className:"w-4 h-4 rounded-sm",alt:""}),e.recipient]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-500 whitespace-nowrap",children:k(e.timestamp)}),s&&!N&&r.jsx("button",{onClick:()=>x(e.id),className:"text-slate-400 hover:text-emerald-500 transition-colors p-1 rounded-md hover:bg-emerald-50 dark:hover:bg-emerald-900/20",title:"回复",children:r.jsx(d,{size:14})}),(a||s&&s.username===e.player)&&r.jsx("button",{onClick:()=>f(e.id),className:"p-1 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-md opacity-0 group-hover:opacity-100 transition-all duration-200",title:"删除留言",children:r.jsx(o.Z,{size:14})})]})]}),r.jsx(S,{content:e.content})]})]}),r.jsx(n.M,{children:N&&r.jsx(i.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mt-4 pl-14 sm:pl-16",children:(0,r.jsxs)("form",{onSubmit:t=>b(t,e.id),className:"group bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus-within:ring-2 focus-within:ring-emerald-500/20 focus-within:border-emerald-500 transition-all",children:[r.jsx("div",{className:"relative",children:r.jsx(j,{value:p,onChange:e=>h(e.target.value),placeholder:`回复 @${e.player}...`,className:"w-full bg-transparent border-none p-3 text-sm focus:ring-0 focus:outline-none resize-none placeholder:text-slate-400 min-h-[80px]",autoFocus:!0})}),(0,r.jsxs)("div",{className:"flex justify-end px-2 pb-2 gap-2",children:[r.jsx("button",{type:"button",onClick:()=>{x(null),h("")},className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 hover:bg-slate-100 dark:hover:bg-white/10 rounded-lg transition-colors",children:r.jsx(c.Z,{size:16})}),r.jsx("button",{type:"submit",disabled:y||!p.trim(),className:"p-1.5 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all hover:shadow-emerald-500/25",children:y?r.jsx(u.Z,{size:16,className:"animate-spin"}):r.jsx(m.Z,{size:16})})]})]})})})]}),e.replies&&e.replies.length>0&&r.jsx("div",{className:"pl-4 sm:pl-8 space-y-4 mt-4",children:e.replies.map(e=>r.jsx(C,{msg:e,depth:t+1,user:s,isAdmin:a,replyingTo:l,setReplyingTo:x,replyContent:p,setReplyContent:h,handleReply:b,handleDelete:f,isReplying:y,formatTime:k},e.id))})]})},q=()=>{let{user:e,token:t,loading:s}=(0,f.a)(),{error:l,success:i,warning:n}=(0,N.p)(),{confirm:o}=(0,w.N)(),[c,g]=(0,a.useState)([]),[y,k]=(0,a.useState)(!0),[S,q]=(0,a.useState)(null),[z,Z]=(0,a.useState)(!1),[P,$]=(0,a.useState)(null),[M,_]=(0,a.useState)(""),[T,E]=(0,a.useState)(!1),[D,R]=(0,a.useState)(null),[A,K]=(0,a.useState)(""),[W,F]=(0,a.useState)(!1);(0,a.useEffect)(()=>{s||G()},[s,t]);let G=async()=>{try{k(!0);let e=(await b.ZP.get("/api/message/read")).data,t=new Map,s=[];e.forEach(e=>{t.set(e.id,{...e,replies:[]})}),e.forEach(e=>{let r=t.get(e.id);if(e.parent_id){let a=t.get(e.parent_id);a?a.replies?.push(r):s.push(r)}else s.push(r)}),(e=>{e.sort((e,t)=>t.timestamp-e.timestamp),e.forEach(e=>{e.replies&&e.replies.length>0&&e.replies.sort((e,t)=>t.timestamp-e.timestamp)})})(s),g(s),q(null)}catch(e){q("无法加载留言列表，请稍后重试"),console.error(e)}finally{k(!1)}},B=async s=>{if(s.preventDefault(),M.trim()&&e){E(!0);try{await b.ZP.post("/api/message/write",{message:M,player:e.username,parent_id:null},{headers:{Authorization:`Bearer ${t}`}}),_(""),G()}catch(e){l(e.response?.data?.error||(e.response?.data?.detail?JSON.stringify(e.response.data.detail):"发布失败"))}finally{E(!1)}}},H=async(s,r)=>{if(s.preventDefault(),A.trim()&&e){F(!0);try{await b.ZP.post("/api/message/write",{message:A,player:e.username,parent_id:r},{headers:{Authorization:`Bearer ${t}`}}),K(""),R(null),G()}catch(e){l(e.response?.data?.error||(e.response?.data?.detail?JSON.stringify(e.response.data.detail):"回复失败"))}finally{F(!1)}}},O=async e=>{if(await o({title:"删除留言",message:"确定要删除这条留言吗？",isDangerous:!0,confirmText:"删除"})){if(!P&&!t){n("请先登录");return}try{let s={};P?s.Authorization=`Bearer ${P}`:t&&(s.Authorization=`Bearer ${t}`),await b.ZP.delete(`/api/message/${e}`,{headers:s}),G(),i("删除成功")}catch(e){l("删除失败: "+(e.response?.data?.error||e.message))}}},U=e=>new Date(1e3*e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-");return r.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-4xl font-bold text-slate-900 dark:text-white mb-2 text-gradient",children:"玩家留言"}),r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-sm sm:text-base",children:"分享游戏心得，记录精彩瞬间"})]})}),r.jsx("div",{className:"mb-8",children:e?r.jsx("div",{className:"bg-slate-50 dark:bg-slate-950/50 p-4 rounded-xl border border-slate-200 dark:border-slate-800 focus-within:ring-2 focus-within:ring-emerald-500/20 transition-all",children:(0,r.jsxs)("form",{onSubmit:B,children:[r.jsx(j,{value:M,onChange:e=>_(e.target.value),placeholder:`以 ${e.username} 的身份留言...`,className:"w-full bg-transparent border-none resize-none focus:ring-0 focus:outline-none p-0 text-slate-800 dark:text-slate-200 placeholder:text-slate-400 min-h-[80px]"}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-3 pt-3 border-t border-slate-200 dark:border-slate-800",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[r.jsx("img",{src:`https://cravatar.eu/helmavatar/${e.username}/32.png`,className:"w-6 h-6 rounded bg-slate-200",alt:e.username}),(0,r.jsxs)("span",{children:["以 ",e.username," 身份"]})]}),(0,r.jsxs)("button",{type:"submit",disabled:T||!M.trim(),className:"px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm font-medium hover:bg-emerald-600 disabled:opacity-50 transition-colors flex items-center gap-2",children:[T?r.jsx(u.Z,{size:16,className:"animate-spin"}):r.jsx(m.Z,{size:16}),"发布"]})]})]})}):(0,r.jsxs)("div",{className:"glass-panel p-8 rounded-2xl text-center border border-dashed border-slate-300 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/30",children:[r.jsx(x.Z,{size:48,className:"mx-auto mb-4 text-slate-300 dark:text-slate-600"}),r.jsx("h3",{className:"text-lg font-medium text-slate-900 dark:text-white mb-2",children:"想要参与讨论？"}),r.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-6",children:"登录后即可发布留言并回复他人"}),(0,r.jsxs)(v.default,{href:"/login",className:"inline-flex items-center gap-2 px-6 py-2.5 bg-emerald-500 text-white rounded-xl font-medium hover:bg-emerald-600 hover:shadow-lg hover:shadow-emerald-500/25 transition-all",children:[r.jsx(p.Z,{size:18}),r.jsx("span",{children:"立即登录"})]})]})}),(0,r.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4 mb-8",children:[(0,r.jsxs)("div",{className:"glass-panel p-5 rounded-xl flex items-center gap-4 border border-emerald-100 dark:border-emerald-900/20 bg-emerald-50/30 dark:bg-emerald-900/10",children:[r.jsx("div",{className:"p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400",children:r.jsx(x.Z,{size:20})}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 text-sm mb-1",children:"游戏内留言"}),r.jsx("code",{className:"text-xs font-mono text-emerald-600 dark:text-emerald-400 bg-emerald-100/50 dark:bg-emerald-900/30 px-2 py-1 rounded",children:"/lmsg <内容>"})]})]}),(0,r.jsxs)("div",{className:"glass-panel p-5 rounded-xl flex items-center gap-4 border border-blue-100 dark:border-blue-900/20 bg-blue-50/30 dark:bg-blue-900/10",children:[r.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",children:r.jsx(d,{size:20})}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 text-sm mb-1",children:"游戏内回复"}),r.jsx("code",{className:"text-xs font-mono text-blue-600 dark:text-blue-400 bg-blue-100/50 dark:bg-blue-900/30 px-2 py-1 rounded",children:"/lmsg reply <id> <内容>"})]})]})]}),y?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[r.jsx(u.Z,{size:40,className:"text-emerald-500 animate-spin mb-4"}),r.jsx("p",{className:"text-slate-400 text-sm",children:"正在加载留言..."})]}):S?(0,r.jsxs)("div",{className:"flex items-center justify-center py-20 text-red-400 gap-2",children:[r.jsx(h.Z,{size:20}),r.jsx("span",{children:S})]}):0===c.length?(0,r.jsxs)("div",{className:"text-center py-20",children:[r.jsx("div",{className:"w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300 dark:text-slate-600",children:r.jsx(x.Z,{size:32})}),r.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"暂无留言，快来抢占沙发吧！"})]}):r.jsx("div",{className:"space-y-6",children:c.map(t=>r.jsx(C,{msg:t,user:e,isAdmin:z,replyingTo:D,setReplyingTo:R,replyContent:A,setReplyContent:K,handleReply:H,handleDelete:O,isReplying:W,formatTime:U},t.id))})]})})}},62607:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>l});var r=s(19510);let a=(0,s(68570).createProxy)(String.raw`D:\编程\KukeMC-Website\KukeMC-WebSite\src\components\next\MessagesClient.tsx#default`),l={title:"留言板 | KukeMC",description:"玩家留言交流，分享游戏心得。"};function i(){return r.jsx(a,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[856,64,136],()=>s(15876));module.exports=r})();