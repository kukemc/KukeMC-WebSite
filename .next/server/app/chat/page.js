(()=>{var e={};e.id=929,e.ids=[929],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},48711:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o}),r(19365),r(12701),r(35866);var s=r(23191),a=r(88716),l=r(37922),i=r.n(l),n=r(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);r.d(t,d);let o=["",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,19365)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\chat\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,12701)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\chat\\page.tsx"],u="/chat/page",x={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},28099:(e,t,r)=>{Promise.resolve().then(r.bind(r,256))},69436:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},45091:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},256:(e,t,r)=>{"use strict";r.d(t,{default:()=>v});var s=r(10326),a=r(17577),l=r(24846),i=r(88129),n=r(62881);let d=(0,n.Z)("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),o=(0,n.Z)("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);var c=r(24061),u=r(41291),x=r(69436),p=r(45091),h=r(8621),m=r(33385),b=r(74690),g=r(91272),f=r(41135),y=r(90434);let v=()=>{let{user:e,token:t}=(0,b.a)(),{level:r}=(0,g.h)(),n=(0,a.useRef)(e);(0,a.useEffect)(()=>{n.current=e},[e]);let[v,k]=(0,a.useState)([]),[w,j]=(0,a.useState)(""),[N,q]=(0,a.useState)(0),[M,S]=(0,a.useState)(!1),[_,P]=(0,a.useState)(null),[C,E]=(0,a.useState)([]),[$,W]=(0,a.useState)(0),[Z,z]=(0,a.useState)(!1),[A,T]=(0,a.useState)(!0),K=(0,a.useRef)(null),D=(0,a.useRef)(null),I=()=>{let e=process.env.NEXT_PUBLIC_API_BASE||"https://api.kuke.ink",r=e.startsWith("https")?"wss":"ws",s=e.replace(/^https?:\/\//,""),a=`${r}://${s}/api/chatlog/public/ws`;return t?`${a}?token=${t}`:a};(0,a.useEffect)(()=>{(async()=>{try{let e=await m.ZP.get("/api/chatlog/public/recent?limit=50");k(e.data.reverse())}catch(e){console.error("Failed to fetch recent chat",e)}})()},[]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=await m.ZP.get("/api/playerlist/grouped");if(e.data&&e.data.servers){E(e.data.servers);let t=e.data.servers.reduce((e,t)=>e+t.count,0);W(t)}}catch(e){console.error("Failed to fetch players",e)}};e();let t=setInterval(e,1e4);return()=>clearInterval(t)},[]),(0,a.useEffect)(()=>{let e;let t=()=>{D.current&&D.current.close();let r=new WebSocket(I());r.onopen=()=>{S(!0),P(null)},r.onmessage=e=>{try{let t=JSON.parse(e.data);if("message"===t.type){let e=t.data;if(e.id&&!e.recipient&&"staff"!==e.channel&&(k(t=>{if(t.some(t=>t.id===e.id))return t;if("Web"===e.server&&e.player===n.current?.username){let r=t.findIndex(t=>t.id>1e12&&t.content===e.content&&t.player===e.player);if(-1!==r){let s=[...t];return s[r]=e,s}}let r=[...t,e];return r.length>100&&r.shift(),r}),A&&e.player!==n.current?.username)){let e=new Audio("/sounds/pop.mp3");e.volume=.5,e.play().catch(()=>{})}}else"error"===t.type&&(P(t.message||"发送失败"),setTimeout(()=>P(null),3e3))}catch(e){}},r.onclose=()=>{S(!1),D.current===r&&(e=setTimeout(t,3e3))},r.onerror=()=>{S(!1)},D.current=r};return t(),()=>{D.current&&(D.current.close(),D.current=null),clearTimeout(e)}},[t,A]),(0,a.useEffect)(()=>{if(K.current){let{scrollHeight:e,clientHeight:t}=K.current;K.current.scrollTo({top:e-t,behavior:"smooth"})}},[v]),(0,a.useEffect)(()=>{if(N>0){let e=setInterval(()=>{q(e=>e-1)},1e3);return()=>clearInterval(e)}},[N]);let L=async s=>{if(s.preventDefault(),w.trim()&&!(N>0)){if(!t){P("请先登录后再发送消息"),setTimeout(()=>P(null),3e3);return}if(null!==r&&r<5){P("您的等级不足 5 级，无法发送消息。请前往游戏内升级！"),setTimeout(()=>P(null),3e3);return}if(!D.current||D.current.readyState!==WebSocket.OPEN){P("实时连接未就绪，请稍后重试"),setTimeout(()=>P(null),3e3);return}try{q(5);let t=`&8[&2Web&8] &f${e?.username||"Unknown"} &7>> &f${w}`;D.current.send(JSON.stringify({type:"send",content:t,raw_content:w})),k(t=>[...t,{id:Date.now(),player:e?.username||"Unknown",content:w,timestamp:Date.now(),server:"Web"}]),j("")}catch(e){P("发送失败"),q(0),setTimeout(()=>P(null),3e3)}}};return s.jsx("div",{className:"min-h-screen pt-20 pb-10 px-4 sm:px-6 lg:px-8 text-slate-900 dark:text-white transition-colors duration-300 relative overflow-hidden h-screen flex flex-col",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto relative z-10 w-full flex-1 flex flex-col md:flex-row gap-6 h-full overflow-hidden",children:[(0,s.jsxs)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},className:"flex-1 flex flex-col bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-2xl border border-slate-200 dark:border-slate-800 shadow-xl overflow-hidden h-[calc(100vh-160px)]",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between bg-white/50 dark:bg-slate-950/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:(0,f.Z)("w-3 h-3 rounded-full animate-pulse",M?"bg-emerald-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"bg-red-500")}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:["实时互动",s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-normal",children:"Live"})]}),s.jsx("p",{className:"text-xs text-slate-500",children:M?"已连接实时通道":"正在连接..."})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>T(!A),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-500 transition-colors",title:A?"关闭提示音":"开启提示音",children:A?s.jsx(d,{size:20}):s.jsx(o,{size:20})}),s.jsx("button",{onClick:()=>z(!Z),className:"lg:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-500",children:s.jsx(c.Z,{size:20})})]})]}),s.jsx("div",{ref:K,className:"flex-1 overflow-y-auto px-4 sm:px-6 py-6 space-y-4 custom-scrollbar bg-slate-50/50 dark:bg-black/20",children:s.jsx(i.M,{initial:!1,children:v.map(t=>{let r=e?.username===t.player;return(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{type:"spring",damping:25,stiffness:500},className:`flex items-start gap-3 group ${r?"flex-row-reverse":""}`,children:[s.jsx("div",{className:"flex-shrink-0 mt-1",children:s.jsx(y.default,{href:`/player/${t.player}`,children:s.jsx("img",{src:`https://minotar.net/helm/${t.player}/40.png`,alt:t.player,className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg shadow-sm border border-slate-100 dark:border-white/10 hover:opacity-80 transition-opacity",onError:e=>{e.target.src="https://minotar.net/helm/steve/40.png"}})})}),(0,s.jsxs)("div",{className:`flex-1 flex flex-col ${r?"items-end":"items-start"} max-w-[85%] sm:max-w-[75%]`,children:[(0,s.jsxs)("div",{className:`flex items-baseline gap-2 mb-1 ${r?"flex-row-reverse":""}`,children:[s.jsx(y.default,{href:`/player/${t.player}`,className:"font-bold text-sm sm:text-base text-slate-700 dark:text-gray-200 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors hover:underline",children:t.player}),t.server&&s.jsx("span",{className:"text-[10px] uppercase tracking-wider px-1.5 py-0.5 rounded bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-gray-500 border border-slate-200 dark:border-white/5",children:t.server})]}),s.jsx("div",{className:`
                                        px-4 py-2.5 rounded-2xl text-sm sm:text-base leading-relaxed shadow-sm break-words relative transition-all duration-200
                                        ${r?"bg-blue-600 text-white rounded-tr-none shadow-blue-500/10":"bg-slate-100 dark:bg-white/5 text-slate-700 dark:text-gray-300 rounded-tl-none border border-slate-200 dark:border-white/5"}
                                    `,children:t.content}),s.jsx("span",{className:`text-[10px] text-slate-400 dark:text-gray-500 mt-1 ${r?"text-right":"text-left"}`,children:(0,h.WU)(new Date(t.timestamp),"HH:mm:ss")})]})]},t.id)})})}),s.jsx(i.M,{children:_&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"absolute bottom-20 left-1/2 -translate-x-1/2 bg-red-500/90 text-white px-4 py-2 rounded-full shadow-lg backdrop-blur-md flex items-center gap-2 text-sm z-20",children:[s.jsx(u.Z,{className:"w-4 h-4"}),_]})}),(0,s.jsxs)("div",{className:"p-4 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800",children:[(0,s.jsxs)("form",{onSubmit:L,className:"relative flex items-center gap-2",children:[s.jsx("input",{type:"text",value:w,onChange:e=>j(e.target.value),placeholder:t?"参与讨论...":"请登录后参与聊天",disabled:!t||N>0,className:"w-full bg-slate-100 dark:bg-slate-950 hover:bg-slate-50 dark:hover:bg-slate-900 focus:bg-white dark:focus:bg-slate-950 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-gray-500 rounded-xl py-3 pl-4 pr-12 border border-transparent focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all outline-none disabled:opacity-50 disabled:cursor-not-allowed shadow-inner"}),s.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:s.jsx("button",{type:"submit",disabled:!w.trim()||N>0,className:`p-2 rounded-lg transition-all flex items-center justify-center
                                ${w.trim()&&0===N?"bg-blue-600 hover:bg-blue-500 text-white shadow-md shadow-blue-500/20":"bg-slate-200 dark:bg-white/10 text-slate-400 dark:text-gray-500 cursor-not-allowed"}`,children:N>0?s.jsx("span",{className:"text-xs font-bold w-5 h-5 flex items-center justify-center",children:N}):s.jsx(x.Z,{className:"w-5 h-5"})})})]}),s.jsx("div",{className:"text-center mt-2",children:s.jsx("span",{className:"text-[10px] text-slate-400 dark:text-gray-600",children:"每5秒仅限发送一条消息 • 请文明发言"})})]})]}),(0,s.jsxs)(l.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5},className:`
                fixed inset-0 z-50 lg:static lg:z-auto lg:w-80 lg:block
                ${Z?"block":"hidden"}
            `,children:[s.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm lg:hidden",onClick:()=>z(!1)}),(0,s.jsxs)("div",{className:"absolute right-0 top-0 bottom-0 w-3/4 max-w-xs lg:w-full lg:static lg:h-full bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl lg:rounded-2xl border-l lg:border border-slate-200 dark:border-slate-800 shadow-xl flex flex-col transition-transform duration-300 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4 lg:hidden",children:[(0,s.jsxs)("h2",{className:"text-lg font-bold text-slate-800 dark:text-white",children:["在线玩家 (",$,")"]}),s.jsx("button",{onClick:()=>z(!1),className:"p-1 rounded-md hover:bg-slate-100 dark:hover:bg-white/10",children:s.jsx(c.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"hidden lg:flex items-center gap-2 mb-4 px-2 pb-2 border-b border-slate-200 dark:border-slate-800",children:[s.jsx(c.Z,{className:"w-5 h-5 text-blue-500"}),s.jsx("h2",{className:"font-bold text-slate-800 dark:text-white",children:"在线玩家"}),s.jsx("span",{className:"bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 text-xs px-2 py-0.5 rounded-full ml-auto",children:$})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-6 pr-1",children:[C.map(e=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-500 dark:text-gray-400 uppercase tracking-wider px-2",children:[s.jsx("span",{children:e.server}),s.jsx("span",{className:"w-px h-3 bg-slate-300 dark:bg-white/10"}),(0,s.jsxs)("span",{children:[e.count," 人"]})]}),s.jsx("div",{className:"space-y-1",children:e.players.map(e=>(0,s.jsxs)(y.default,{href:`/player/${e.name}`,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800/50 transition-colors group",children:[(0,s.jsxs)("div",{className:"relative",children:[s.jsx("img",{src:`https://minotar.net/helm/${e.name}/32.png`,alt:e.name,className:"w-8 h-8 rounded-md shadow-sm border border-slate-200 dark:border-white/10",onError:e=>{e.target.src="https://minotar.net/helm/steve/32.png"}}),s.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-900 rounded-full"})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-gray-200 truncate group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors",children:e.name}),void 0!==e.ping&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-gray-500",children:[s.jsx(p.Z,{className:"w-3 h-3"}),(0,s.jsxs)("span",{children:[e.ping,"ms"]})]})]})]},e.uuid))})]},e.server)),0===C.length&&s.jsx("div",{className:"text-center py-10 text-slate-400 dark:text-gray-600 text-sm",children:"暂无玩家在线"})]})]})]})]})})}},91272:(e,t,r)=>{"use strict";r.d(t,{h:()=>a});var s=r(20655);let a=()=>(0,s.l)()},19365:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i,metadata:()=>l});var s=r(19510);let a=(0,r(68570).createProxy)(String.raw`D:\编程\KukeMC-Website\KukeMC-WebSite\src\components\next\LiveChatClient.tsx#default`),l={title:"在线聊天 | KukeMC",description:"与服务器内的玩家实时互通聊天。"};function i(){return s.jsx(a,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[856,503,621,136],()=>r(48711));module.exports=s})();