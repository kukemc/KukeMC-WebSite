(()=>{var e={};e.id=988,e.ids=[988],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},40475:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>d.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>b,tree:()=>o}),s(64698),s(12701),s(35866);var a=s(23191),r=s(88716),l=s(37922),d=s.n(l),i=s(95231),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);s.d(t,n);let o=["",{children:["tickets",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,64698)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\tickets\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,12701)),"D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\编程\\KukeMC-Website\\KukeMC-WebSite\\src\\app\\tickets\\page.tsx"],x="/tickets/page",m={require:s,loadChunk:()=>Promise.resolve()},b=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/tickets/page",pathname:"/tickets",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},827:(e,t,s)=>{Promise.resolve().then(s.bind(s,63841))},86333:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},63062:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},48998:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},70717:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},77506:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},83855:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},69436:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},60763:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},63841:(e,t,s)=>{"use strict";s.d(t,{default:()=>W});var a=s(10326),r=s(17577),l=s(60962),d=s(74690),i=s(33385),n=s(88129),o=s(24846),c=s(35047),x=s(41291),m=s(62881);let b=(0,m.Z)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),u=(0,m.Z)("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var p=s(79635),h=s(63062),g=s(77506),f=s(71709),k=s(21985),v=s(30361),j=s(48998),y=s(83855),N=s(36283),w=s(39183),Z=s(40617),S=s(86333),_=s(60763),z=s(70717),C=s(69436);let M=(0,m.Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var P=s(41135),q=s(53187),D=s(76910);let E=[{id:"bug",label:"Bug反馈",icon:x.Z,color:"text-red-500"},{id:"suggestion",label:"功能建议",icon:b,color:"text-yellow-500"},{id:"report",label:"违规举报",icon:u,color:"text-orange-500"},{id:"account",label:"账号问题",icon:p.Z,color:"text-blue-500"},{id:"other",label:"其他问题",icon:h.Z,color:"text-slate-500"}],O=({status:e})=>{let t={open:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800",in_progress:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800",resolved:"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300 border-slate-200 dark:border-slate-700",rejected:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800"};return(0,a.jsxs)("span",{className:(0,P.Z)("px-2.5 py-0.5 rounded-full text-xs font-medium border flex items-center gap-1.5 w-fit",t[e]||t.open),children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-current"}),{open:"待受理",in_progress:"处理中",resolved:"已解决",rejected:"已驳回"}[e]||e]})},K=({onUploadComplete:e,disabled:t})=>{let[s,l]=(0,r.useState)(!1),d=(0,r.useRef)(null),{warning:n,error:o}=(0,D.p)(),c=async t=>{if(t.target.files&&t.target.files.length>0){let s=t.target.files[0];if(!s.type.startsWith("image/")){n("请上传有效的图片文件");return}l(!0);let a=new FormData;a.append("file",s);try{let t=await (0,i.lY)(),s=await i.ZP.post("/api/upload/image",a,{headers:{"Content-Type":"multipart/form-data",...t}});e(s.data.url)}catch(e){o("图片上传失败，请稍后重试"),console.error(e)}finally{l(!1),d.current&&(d.current.value="")}}};return(0,a.jsxs)(a.Fragment,{children:[a.jsx("input",{type:"file",ref:d,onChange:c,accept:"image/*",className:"hidden"}),a.jsx("button",{type:"button",onClick:()=>d.current?.click(),disabled:s||t,className:"p-3 text-slate-400 hover:text-brand-500 transition-colors rounded-xl hover:bg-slate-200/50 dark:hover:bg-slate-700/50",title:"上传图片",children:s?a.jsx(g.Z,{size:20,className:"animate-spin"}):a.jsx(f.Z,{size:20})})]})},L=({children:e})=>{let[t,s]=(0,r.useState)(!1);return((0,r.useEffect)(()=>(s(!0),()=>s(!1)),[]),t)?(0,l.createPortal)(e,document.body):null},W=()=>{let{user:e}=(0,d.a)(),t=(0,c.useSearchParams)();(0,c.useRouter)();let{warning:s,error:l}=(0,D.p)(),[m,b]=(0,r.useState)([]),[u,p]=(0,r.useState)(!0),[h,f]=(0,r.useState)(null),[W,$]=(0,r.useState)(!1),[I,A]=(0,r.useState)([]),[F,H]=(0,r.useState)(!1);(0,r.useEffect)(()=>{},[]),(0,r.useEffect)(()=>{if(e?.role==="admin"&&F){let e=setInterval(()=>{i.ZP.post("/api/feedback/support/heartbeat")},6e4);return i.ZP.post("/api/feedback/support/heartbeat"),()=>clearInterval(e)}},[F,e]);let J=async()=>{let e=!F;H(e),e?await i.ZP.post("/api/feedback/support/heartbeat"):await i.ZP.post("/api/feedback/support/offline")},[R,U]=(0,r.useState)(null),[T,G]=(0,r.useState)(null),Q=(0,r.useRef)(null),[V,X]=(0,r.useState)(null);(0,r.useRef)(null),(0,r.useEffect)(()=>{},[R,e]);let[Y,B]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(""),[es,ea]=(0,r.useState)(!1),[er,el]=(0,r.useState)({player_name:"",player_uuid:"",description:"",server:"",contact:"",category:"bug"}),[ed,ei]=(0,r.useState)(!1),[en,eo]=(0,r.useState)("all");(0,r.useEffect)(()=>{e&&(ec(),ex())},[e]),(0,r.useEffect)(()=>{let e=t.get("id");if(e&&!R){let t=parseInt(e);isNaN(t)||em(t)}},[t,R]);let ec=async()=>{if(e)try{let t=await i.ZP.get("/api/playtime/player/details",{params:{name:e.username}});t.data&&t.data.uuid&&(f(t.data.uuid),el(s=>({...s,player_name:e.username,player_uuid:t.data.uuid})))}catch(e){console.error("Failed to fetch UUID",e)}},ex=async()=>{p(!0);try{let t=await i.ZP.get("/api/feedback/list",{params:{player_name:e?.username,per_page:50}});t.data.ok&&b(t.data.items)}catch(e){console.error("Failed to fetch tickets",e)}finally{p(!1)}},em=async e=>{B(!0),U(e);try{let t=await i.ZP.get(`/api/feedback/detail/${e}`);t.data.ok&&G(t.data)}catch(e){console.error("Failed to fetch detail",e)}finally{B(!1)}},eb=async e=>{if(e.preventDefault(),er.description.trim()){if(!h){s("无法获取您的UUID，请稍后重试或联系管理员");return}ei(!0);try{let e={...er,player_uuid:h};(await i.ZP.post("/api/feedback/create",e)).data.ok&&(ea(!1),el({...er,description:"",server:"",contact:""}),ex())}catch(e){l(e.response?.data?.detail||"提交失败")}finally{ei(!1)}}},eu=(0,r.useRef)(0),ep=t=>{et(t);let s=Date.now();s-eu.current>2e3&&Q.current?.readyState===WebSocket.OPEN&&(Q.current.send(JSON.stringify({type:"typing",user:e?.username})),eu.current=s)},eh=async t=>{if(t.preventDefault(),!e||!ee.trim()||!R)return;let s=Date.now(),a={id:s,actor:e.username,action:"comment",message:ee,created_at:new Date().toISOString()};G(e=>e?{...e,logs:[...e.logs,a]}:null),et(""),Q.current&&Q.current.readyState===WebSocket.OPEN&&Q.current.send(JSON.stringify({type:"comment",message:ee,user:e.username}));try{await i.ZP.post("/api/feedback/comment",{ticket_id:R,message:ee,user:e.username,player_name:e.username})}catch(e){G(e=>e?{...e,logs:e.logs.filter(e=>e.id!==s)}:null),et(ee),l(e.response?.data?.detail||"回复失败")}},eg=async t=>{if(R&&e)try{(await i.ZP.post("/api/feedback/status",{ticket_id:R,status:t,user:e.username})).data.ok&&ex()}catch(e){l(e.response?.data?.detail||"状态更新失败")}},ef=async()=>{if(R&&e)try{(await i.ZP.post("/api/feedback/assign",{ticket_id:R,resolver:e.username,user:e.username})).data.ok&&ex()}catch(e){l(e.response?.data?.detail||"分配失败")}},ek=m.filter(e=>"all"===en||e.status===en),ev=(0,r.useRef)(null);(0,r.useEffect)(()=>{ev.current&&ev.current.scrollTo({top:ev.current.scrollHeight,behavior:"smooth"})},[T?.logs]);let ej=e=>{try{let t=JSON.parse(e);if(t&&"object"==typeof t){if(t.contact)return`联系方式: ${t.contact}`;if(t.resolver)return`分配给: ${t.resolver}`;if(t.status)return`状态更新为: ${({open:"待受理",in_progress:"处理中",resolved:"已解决",rejected:"已驳回"})[t.status]||t.status}`}}catch(e){}return e};return e?(0,a.jsxs)("div",{className:"min-h-screen pt-24 px-4 sm:px-6 lg:px-8 pb-12",children:[(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white flex items-center gap-3",children:[a.jsx(k.Z,{className:"text-brand-500",size:32}),"工单中心"]}),a.jsx("p",{className:"text-slate-500 mt-2",children:"遇到问题？提交工单，我们将尽快为您解决。"})]}),e?.role==="admin"&&(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsxs)("button",{onClick:J,className:(0,P.Z)("px-4 py-2 rounded-xl font-medium shadow-lg transition-all flex items-center gap-2 w-fit mr-2",F?"bg-green-500 hover:bg-green-600 text-white shadow-green-500/20":"bg-slate-200 hover:bg-slate-300 text-slate-700 dark:bg-slate-700 dark:text-slate-300"),children:[F?a.jsx(v.Z,{size:20}):a.jsx(j.Z,{size:20}),F?"客服在线":"客服离线"]}),I.length>0&&(0,a.jsxs)("div",{className:"text-xs text-slate-500 mt-1 mr-2",children:["在线: ",I.join(", ")]})]}),(0,a.jsxs)("button",{onClick:()=>ea(!0),className:"px-4 py-2 bg-brand-500 hover:bg-brand-600 text-white rounded-xl font-medium shadow-lg shadow-brand-500/20 transition-all flex items-center gap-2 w-fit",children:[a.jsx(y.Z,{size:20}),"提交新工单"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 h-[calc(100vh-240px)] min-h-[600px]",children:[(0,a.jsxs)("div",{className:(0,P.Z)("lg:col-span-1 flex flex-col bg-white/80 dark:bg-slate-900/50 backdrop-blur-md rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden",R?"hidden lg:flex":"flex"),children:[a.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex items-center gap-2 overflow-x-auto scrollbar-hide",children:["all","open","in_progress","resolved","rejected"].map(e=>a.jsx("button",{onClick:()=>eo(e),className:(0,P.Z)("px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap transition-colors",en===e?"bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"),children:"all"===e?"全部":"open"===e?"待受理":"in_progress"===e?"处理中":"resolved"===e?"已解决":"已驳回"},e))}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:u?a.jsx("div",{className:"flex justify-center py-10",children:a.jsx(g.Z,{className:"animate-spin text-brand-500"})}):0===ek.length?(0,a.jsxs)("div",{className:"text-center py-10 text-slate-500",children:[a.jsx(N.Z,{size:32,className:"mx-auto mb-3 opacity-50"}),"暂无工单"]}):ek.map(e=>(0,a.jsxs)("div",{onClick:()=>em(e.id),className:(0,P.Z)("group p-4 rounded-xl border cursor-pointer transition-all duration-200",R===e.id?"bg-brand-50 dark:bg-brand-900/20 border-brand-500 dark:border-brand-500 ring-1 ring-brand-500":"bg-white dark:bg-slate-950/50 border-slate-200 dark:border-slate-800 hover:border-brand-300 dark:hover:border-brand-700 hover:shadow-md"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("span",{className:"font-mono text-xs text-slate-400",children:["#",e.id]}),a.jsx(O,{status:e.status})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(()=>{let t=E.find(t=>t.id===e.category)||E.find(e=>"other"===e.id);return a.jsx(t.icon,{size:14,className:t.color})})(),a.jsx("h3",{className:"font-medium text-slate-900 dark:text-white line-clamp-1 flex-1",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500 mt-2",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx(j.Z,{size:12}),new Date(e.updated_at).toLocaleDateString()]}),a.jsx(w.Z,{size:14,className:(0,P.Z)("transition-transform",R===e.id&&"translate-x-1 text-brand-500")})]})]},e.id))})]}),a.jsx("div",{className:(0,P.Z)("lg:col-span-2 bg-white/80 dark:bg-slate-900/50 backdrop-blur-md rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden flex-col relative",R?"flex":"hidden lg:flex"),children:Y?a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 backdrop-blur-sm z-10",children:a.jsx(g.Z,{size:40,className:"animate-spin text-brand-500"})}):T?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-6 border-b border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-950/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("button",{onClick:()=>U(null),className:"lg:hidden mr-1 p-1.5 -ml-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:a.jsx(S.Z,{size:20})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex-1",children:["工单 #",T.item.id]}),a.jsx(O,{status:T.item.status})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50",children:[a.jsx("div",{className:"text-slate-500 text-xs mb-1",children:"分类"}),a.jsx("div",{className:"font-medium dark:text-slate-200 flex items-center gap-2",children:(()=>{let e=E.find(e=>e.id===T.item.category)||E.find(e=>"other"===e.id);return(0,a.jsxs)(a.Fragment,{children:[a.jsx(e.icon,{size:16,className:e.color}),e.label]})})()})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50",children:[a.jsx("div",{className:"text-slate-500 text-xs mb-1",children:"服务器"}),a.jsx("div",{className:"font-medium dark:text-slate-200",children:q.u[T.item.server||""]||T.item.server||"-"})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50",children:[a.jsx("div",{className:"text-slate-500 text-xs mb-1",children:"创建时间"}),a.jsx("div",{className:"font-medium dark:text-slate-200",children:new Date(T.item.created_at).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50",children:[a.jsx("div",{className:"text-slate-500 text-xs mb-1",children:"联系方式"}),a.jsx("div",{className:"font-medium dark:text-slate-200 truncate",title:T.item.contact||"",children:T.item.contact||"-"})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50",children:[a.jsx("div",{className:"text-slate-500 text-xs mb-1",children:"受理人"}),a.jsx("div",{className:"font-medium dark:text-slate-200",children:T.item.resolver||"暂无"})]})]}),!W&&(0,a.jsxs)("div",{className:"mt-4 bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 px-4 py-3 rounded-xl text-sm flex items-center justify-center gap-2 border border-amber-100 dark:border-amber-800/30",children:[a.jsx(j.Z,{size:16}),a.jsx("span",{children:"暂无管理在线，请耐心等待，如有急事联系腐竹"})]}),(0,a.jsxs)("div",{className:"mt-4 p-4 rounded-xl bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800/30",children:[a.jsx("h3",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mb-2 uppercase tracking-wider",children:"问题描述"}),a.jsx("p",{className:"text-slate-700 dark:text-slate-300 text-sm leading-relaxed whitespace-pre-wrap",children:T.item.description})]}),e?.role==="admin"&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-800 flex flex-wrap gap-3 items-center",children:[a.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"管理操作:"}),T.item.resolver!==e.username&&(0,a.jsxs)("button",{onClick:ef,className:"px-3 py-1.5 bg-brand-50 text-brand-600 hover:bg-brand-100 dark:bg-brand-900/20 dark:text-brand-400 dark:hover:bg-brand-900/40 rounded-lg text-xs font-medium transition-colors flex items-center gap-1",children:[a.jsx(_.Z,{size:14}),"受理此工单"]}),a.jsx("div",{className:"h-4 w-[1px] bg-slate-200 dark:bg-slate-700 mx-1"}),["open","in_progress","resolved","rejected"].map(e=>e===T.item.status?null:a.jsx("button",{onClick:()=>eg(e),className:(0,P.Z)("px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",{open:"text-slate-600 bg-slate-100 hover:bg-slate-200",in_progress:"text-blue-600 bg-blue-100 hover:bg-blue-200",resolved:"text-green-600 bg-green-100 hover:bg-green-200",rejected:"text-red-600 bg-red-100 hover:bg-red-200"}[e]),children:{open:"重置为待受理",in_progress:"标记为处理中",resolved:"标记为已解决",rejected:"驳回工单"}[e]},e))]})]}),(0,a.jsxs)("div",{ref:ev,className:"flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50/50 dark:bg-black/20",children:[T.logs.map((t,s)=>{let r=e&&t.actor===e.username,l=["assign","update_status","create"].includes(t.action);if("create"===t.action)return a.jsx("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-800 text-slate-500 text-xs px-3 py-1 rounded-full",children:["工单创建于 ",new Date(t.created_at).toLocaleString()]})},t.id);if(l)return a.jsx("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-800 text-slate-500 text-xs px-3 py-1 rounded-full flex items-center gap-2",children:[a.jsx(z.Z,{size:12}),(0,a.jsxs)("span",{children:[a.jsx("span",{className:"font-bold",children:t.actor}),"assign"===t.action?" 分配给了 ":" 更新状态为 ",a.jsx("span",{className:"font-bold",children:"assign"===t.action?JSON.parse(t.message).resolver:"open"===JSON.parse(t.message).status?"待受理":"in_progress"===JSON.parse(t.message).status?"处理中":"resolved"===JSON.parse(t.message).status?"已解决":"已驳回"})]}),a.jsx("span",{className:"opacity-60",children:new Date(t.created_at).toLocaleString()})]})},t.id);let d=ej(t.message),i=T.logs[s-1],n=i&&i.actor===t.actor&&"comment"===i.action&&!["assign","update_status","create"].includes(i.action);return(0,a.jsxs)("div",{className:(0,P.Z)("flex gap-3 w-full",r?"flex-row-reverse":"",n?"mt-1":"mt-4"),children:[a.jsx("div",{className:(0,P.Z)("w-8 h-8 rounded-md flex items-center justify-center flex-shrink-0 overflow-hidden shadow-sm bg-slate-200",n?"invisible":""),children:a.jsx("img",{src:`https://cravatar.eu/helmavatar/${t.actor}/32.png`,alt:t.actor,className:"w-full h-full object-cover",onError:e=>{e.target.src=`https://ui-avatars.com/api/?name=${t.actor}&background=random`}})}),(0,a.jsxs)("div",{className:(0,P.Z)("max-w-[80%] min-w-0 flex flex-col",r?"items-end":"items-start"),children:[!n&&(0,a.jsxs)("div",{className:(0,P.Z)("text-xs text-slate-500 mb-1 ml-1 flex items-center gap-1.5",r?"mr-1 justify-end":"ml-1 justify-start"),children:[a.jsx("span",{className:"font-medium",children:t.actor}),t.actor!==T.item.player_name&&(0,a.jsxs)("span",{className:"bg-brand-100 text-brand-600 dark:bg-brand-900/40 dark:text-brand-400 text-[10px] px-1.5 py-0.5 rounded-full flex items-center gap-1 font-medium border border-brand-200 dark:border-brand-800",children:[a.jsx(_.Z,{size:10}),"管理员"]})]}),a.jsx("div",{className:(0,P.Z)("p-3 rounded-2xl text-sm shadow-sm break-words whitespace-pre-wrap w-fit",r?"bg-brand-500 text-white rounded-tr-none":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 rounded-tl-none"),children:d.match(/!\[(.*?)\]\((.*?)\)/)?a.jsx("div",{dangerouslySetInnerHTML:{__html:d.replace(/!\[(.*?)\]\((.*?)\)/g,'<img src="$2" alt="$1" class="rounded-lg max-w-full h-auto mt-2 mb-2 border border-white/20 dark:border-slate-600 shadow-sm" loading="lazy" />')}}):d}),a.jsx("div",{className:(0,P.Z)("text-xs text-slate-400 mt-1",r?"text-right":"text-left"),children:new Date(t.created_at).toLocaleString()})]})]},t.id)}),V&&(0,a.jsxs)("div",{className:"flex gap-3 w-full mt-4",children:[a.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center flex-shrink-0 overflow-hidden shadow-sm bg-slate-200",children:a.jsx("img",{src:`https://cravatar.eu/helmavatar/${V}/32.png`,className:"w-full h-full"})}),(0,a.jsxs)("div",{className:"flex flex-col items-start",children:[a.jsx("div",{className:"text-xs text-slate-500 mb-1 ml-1 font-medium",children:V}),(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-2xl rounded-tl-none text-slate-500 text-sm flex items-center gap-2",children:[a.jsx(g.Z,{size:14,className:"animate-spin"}),"正在输入..."]})]})]})]}),a.jsx("div",{className:"p-4 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800",children:a.jsx("form",{onSubmit:eh,className:"relative",children:(0,a.jsxs)("div",{className:(0,P.Z)("flex items-end gap-2 p-2 rounded-2xl transition-all border","bg-slate-50 dark:bg-slate-950","border-slate-200 dark:border-slate-800","focus-within:border-brand-500 focus-within:ring-4 focus-within:ring-brand-500/10"),children:[a.jsx("div",{className:"flex-shrink-0 mb-[2px]",children:a.jsx(K,{onUploadComplete:e=>et(t=>t+(t?"\n":"")+`![图片](${e})`),disabled:"resolved"===T.item.status||"rejected"===T.item.status})}),a.jsx("textarea",{value:ee,onChange:e=>ep(e.target.value),placeholder:"resolved"===T.item.status||"rejected"===T.item.status?"此工单已结束，如有新问题请提交新工单":"输入回复内容...",disabled:"resolved"===T.item.status||"rejected"===T.item.status,rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),eh(e))},className:"flex-1 bg-transparent border-none focus:ring-0 outline-none p-3 min-h-[48px] max-h-[200px] resize-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 leading-relaxed",style:{height:"auto",overflow:"hidden"},onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,200)+"px",t.style.overflowY=t.scrollHeight>200?"auto":"hidden"}}),a.jsx("button",{type:"submit",disabled:!ee.trim(),className:(0,P.Z)("p-3 rounded-xl flex-shrink-0 transition-all mb-[2px]",ee.trim()?"bg-brand-500 text-white hover:bg-brand-600 shadow-lg shadow-brand-500/20 active:scale-95":"bg-slate-200 text-slate-400 dark:bg-slate-800 dark:text-slate-600 cursor-not-allowed"),children:a.jsx(C.Z,{size:20})})]})})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[a.jsx(Z.Z,{size:48,className:"mb-4 opacity-50"}),a.jsx("p",{children:"选择左侧工单查看详情"})]})})]})]}),a.jsx(n.M,{mode:"wait",children:es&&(0,a.jsxs)(L,{children:[a.jsx(o.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>ea(!1),className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[2000]"}),a.jsx(o.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-[2001] pointer-events-none p-4",children:(0,a.jsxs)("div",{className:"bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl w-full max-w-2xl rounded-3xl shadow-2xl shadow-black/20 pointer-events-auto overflow-hidden flex flex-col max-h-[90vh] border border-slate-100 dark:border-slate-800",children:[(0,a.jsxs)("div",{className:"p-6 pb-2 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[a.jsx(k.Z,{className:"text-brand-500"}),"提交工单"]}),a.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"请详细描述您遇到的问题，我们将尽快为您处理"})]}),a.jsx("button",{onClick:()=>ea(!1),className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:a.jsx(M,{size:24})})]}),(0,a.jsxs)("form",{onSubmit:eb,className:"p-6 pt-4 space-y-6 overflow-y-auto",children:[!h&&(0,a.jsxs)("div",{className:"p-3 bg-amber-50 text-amber-600 rounded-xl text-sm flex items-center gap-2",children:[a.jsx(x.Z,{size:16}),"正在获取您的玩家信息..."]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3",children:"问题分类"}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3",children:E.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>el({...er,category:e.id}),className:(0,P.Z)("flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 gap-2",er.category===e.id?"border-brand-500 bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400 shadow-sm ring-2 ring-brand-500/20":"border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:border-brand-300 dark:hover:border-brand-700 hover:bg-slate-100 dark:hover:bg-slate-700"),children:[a.jsx(e.icon,{size:20,className:er.category===e.id?"text-brand-500":e.color}),a.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.id))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3",children:"选择服务器"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2",children:[Object.entries(q.u).filter(([e])=>"all"!==e).map(([e,t])=>a.jsx("button",{type:"button",onClick:()=>el({...er,server:e}),className:(0,P.Z)("px-3 py-2 rounded-xl text-sm font-medium border transition-all duration-200",er.server===e?"border-brand-500 bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400 shadow-sm ring-2 ring-brand-500/20":"border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:border-brand-300 dark:hover:border-brand-700"),children:t},e)),a.jsx("button",{type:"button",onClick:()=>el({...er,server:"other"}),className:(0,P.Z)("px-3 py-2 rounded-xl text-sm font-medium border transition-all duration-200","other"===er.server?"border-brand-500 bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400 shadow-sm ring-2 ring-brand-500/20":"border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:border-brand-300 dark:hover:border-brand-700"),children:"其他"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"联系方式 (QQ/邮箱)"}),a.jsx("input",{type:"text",value:er.contact||"",onChange:e=>el({...er,contact:e.target.value}),placeholder:"方便我们在离线时联系您（选填）",className:"w-full rounded-xl border-transparent bg-slate-50 dark:bg-slate-800 focus:bg-white dark:focus:bg-slate-950 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all py-3 px-4 text-slate-900 dark:text-white placeholder:text-slate-400"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:["问题描述 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative group",children:[a.jsx("textarea",{required:!0,value:er.description,onChange:e=>el({...er,description:e.target.value}),rows:8,placeholder:"请详细描述您遇到的问题...",className:"w-full rounded-xl border-transparent bg-slate-50 dark:bg-slate-800 focus:bg-white dark:focus:bg-slate-950 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all p-4 pb-12 text-slate-900 dark:text-white placeholder:text-slate-400 resize-none"}),a.jsx("div",{className:"absolute left-3 bottom-3",children:a.jsx(K,{onUploadComplete:e=>el(t=>({...t,description:t.description+(t.description?"\n":"")+`![图片](${e})`}))})})]})]}),(0,a.jsxs)("div",{className:"pt-4 flex justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:()=>ea(!1),className:"px-6 py-3 text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 rounded-xl transition-colors font-bold text-sm",children:"取消"}),(0,a.jsxs)("button",{type:"submit",disabled:ed||!h,className:"px-8 py-3 bg-gradient-to-r from-brand-500 to-blue-500 text-white rounded-xl hover:shadow-lg hover:shadow-brand-500/25 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:hover:scale-100 disabled:hover:shadow-none transition-all flex items-center gap-2 font-bold text-sm",children:[ed?a.jsx(g.Z,{size:18,className:"animate-spin"}):a.jsx(v.Z,{size:18}),"提交工单"]})]})]})]})})]})})]}):a.jsx("div",{className:"min-h-screen pt-24 flex flex-col items-center justify-center px-4",children:(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-slate-900/50 backdrop-blur p-8 rounded-2xl border border-slate-200 dark:border-slate-800 text-center max-w-md w-full",children:[a.jsx(k.Z,{size:48,className:"mx-auto text-slate-400 mb-4"}),a.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"需要登录"}),a.jsx("p",{className:"text-slate-500 mb-6",children:"请先登录以查看和管理您的工单。"}),a.jsx("a",{href:"/login",className:"inline-block px-6 py-2 bg-brand-500 text-white rounded-lg font-medium hover:bg-brand-600 transition-colors",children:"立即登录"})]})})}},53187:(e,t,s)=>{"use strict";s.d(t,{u:()=>a});let a={all:"全部服务器",kitbattle:"职业战争",slime:"粘液空岛",bedwars:"起床战争",redstone:"纯净生存",lobby:"大厅",surret:"避暑山庄",auth:"登录大厅",funsurvival:"趣味生存",bridgepractise:"搭路练习",zombies:"僵尸末日",creative:"创造家园",murdermystery:"密室杀手"}},64698:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>d});var a=s(19510),r=s(71159);let l=(0,s(68570).createProxy)(String.raw`D:\编程\KukeMC-Website\KukeMC-WebSite\src\components\next\TicketCenterClient.tsx#default`),d={title:"工单中心 | KukeMC",description:"提交问题反馈，举报违规行为，联系管理团队。"};function i(){return a.jsx(r.Suspense,{fallback:a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:a.jsx(l,{})})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[856,136],()=>s(40475));module.exports=a})();