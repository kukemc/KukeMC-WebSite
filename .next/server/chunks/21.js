exports.id=21,exports.ids=[21],exports.modules={9198:(e,t,r)=>{Promise.resolve().then(r.bind(r,20790))},86333:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});let n=(0,r(62881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},20790:(e,t,r)=>{"use strict";r.d(t,{default:()=>h});var n=r(10326),a=r(17577),o=r(90434),i=r(35047),s=r(86333),d=r(74690),u=r(91272),l=r(20349),c=r(23495),f=r(33385),p=r(76910),m=r(3242);let h=({initialPost:e,isAlbum:t=!1})=>{let{user:r,token:h,loading:y}=(0,d.a)(),{level:b}=(0,u.h)(),{warning:g,error:x}=(0,p.p)(),v=(0,i.useRouter)(),[j,_]=(0,a.useState)(e),[w,R]=(0,a.useState)([]),[S,N]=(0,a.useState)(!1),[P,O]=(0,a.useState)(null);(0,a.useEffect)(()=>{e&&E(e.id.toString())},[e,h]);let E=async e=>{try{let r=h?{headers:{Authorization:`Bearer ${h}`}}:{},n=[];if(t){let t=await (0,m.eK)(Number(e));n=(Array.isArray(t.comments)?t.comments:[]).map(t=>{let r=t.author||t.user||t;return{id:t.id,post_id:Number(e),content:t.content,created_at:t.created_at,author:{username:r.username||"User",nickname:r.nickname||r.username||"User",custom_title:r.custom_title,avatar:r.avatar},replies:[]}})}else{let t=(await f.ZP.get(`/api/posts/${e}/comments`,r)).data;n=Array.isArray(t)?t:t.data||[]}let a=new Map,o=[];n.forEach(e=>{a.set(e.id,{...e,replies:[]})}),n.forEach(e=>{let t=a.get(e.id);if(e.parent_id){let r=a.get(e.parent_id);r?r.replies?.push(t):o.push(t)}else o.push(t)}),o.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),R(o)}catch(e){console.error(e)}},M=async(e,r)=>{if(j){if(null!==b&&b<5){g("您的等级不足 5 级，无法评论。请前往游戏内升级！");return}try{t?await (0,m.nN)(j.id,e):await f.ZP.post(`/api/posts/${j.id}/comments`,{content:e,parent_id:r},{headers:{Authorization:`Bearer ${h}`}}),await E(j.id.toString())}catch(e){throw x(e.response?.data?.detail||"评论失败"),e}}},k=async e=>{if(confirm("确定要删除这条评论吗？"))try{t?await f.ZP.delete(`/api/album/comment/${e}`,{headers:{Authorization:`Bearer ${h}`}}):await f.ZP.delete(`/api/posts/comments/${e}`,{headers:{Authorization:`Bearer ${h}`}}),await E(j.id.toString())}catch(e){console.error(e),x(e.response?.data?.detail||"删除失败")}};return P||!j?n.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-50 dark:bg-slate-900 p-4",children:(0,n.jsxs)("div",{className:"text-center",children:[n.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:"无法加载动态"}),n.jsx("p",{className:"text-slate-500 mb-6",children:P||"动态不存在或已被删除"}),n.jsx(o.default,{href:"/activity",className:"px-6 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:"返回广场"})]})}):n.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden",children:n.jsx("div",{className:"relative z-10",children:(0,n.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,n.jsxs)("button",{onClick:()=>v.back(),className:"flex items-center gap-2 text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white mb-6 transition-colors",children:[n.jsx(s.Z,{size:20}),n.jsx("span",{children:"返回"})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[n.jsx(l.Z,{post:j,onUpdate:e=>{_(e)},onDelete:()=>{v.push("/activity")},className:"!cursor-default hover:!shadow-sm",isDetail:!0}),n.jsx(c.Z,{comments:w,currentUser:r,onSubmit:M,onDelete:k,loading:S,title:"全部评论",className:"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6"})]})]})})})}},58585:(e,t,r)=>{"use strict";var n=r(61085);r.o(n,"notFound")&&r.d(t,{notFound:function(){return n.notFound}})},61085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return i},RedirectType:function(){return n.RedirectType},notFound:function(){return a.notFound},permanentRedirect:function(){return n.permanentRedirect},redirect:function(){return n.redirect}});let n=r(83953),a=r(16399);class o extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class i extends URLSearchParams{append(){throw new o}delete(){throw new o}set(){throw new o}sort(){throw new o}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},16399:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isNotFoundError:function(){return a},notFound:function(){return n}});let r="NEXT_NOT_FOUND";function n(){let e=Error(r);throw e.digest=r,e}function a(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8586:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},83953:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RedirectType:function(){return n},getRedirectError:function(){return d},getRedirectStatusCodeFromError:function(){return m},getRedirectTypeFromError:function(){return p},getURLFromRedirectError:function(){return f},isRedirectError:function(){return c},permanentRedirect:function(){return l},redirect:function(){return u}});let a=r(54580),o=r(72934),i=r(8586),s="NEXT_REDIRECT";function d(e,t,r){void 0===r&&(r=i.RedirectStatusCode.TemporaryRedirect);let n=Error(s);n.digest=s+";"+t+";"+e+";"+r+";";let o=a.requestAsyncStorage.getStore();return o&&(n.mutableCookies=o.mutableCookies),n}function u(e,t){void 0===t&&(t="replace");let r=o.actionAsyncStorage.getStore();throw d(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.TemporaryRedirect)}function l(e,t){void 0===t&&(t="replace");let r=o.actionAsyncStorage.getStore();throw d(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.PermanentRedirect)}function c(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r,n,a]=e.digest.split(";",4),o=Number(a);return t===s&&("replace"===r||"push"===r)&&"string"==typeof n&&!isNaN(o)&&o in i.RedirectStatusCode}function f(e){return c(e)?e.digest.split(";",3)[2]:null}function p(e){if(!c(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function m(e){if(!c(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(n||(n={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4534:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});let n=(0,r(68570).createProxy)(String.raw`D:\编程\KukeMC-Website\KukeMC-WebSite\src\components\next\PostDetailClient.tsx#default`)}};