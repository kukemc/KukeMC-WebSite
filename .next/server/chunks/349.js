exports.id=349,exports.ids=[349],exports.modules={52256:(e,t,a)=>{"use strict";a.d(t,{Z:()=>w});var s=a(10326),r=a(17577),l=a(94019),i=a(40891),n=a(77506),o=a(31215),d=a(69436),c=a(88129),m=a(24846),u=a(72965),x=a.n(u);a(421),a(27147);var h=a(41135),p=a(33385);let b=e=>new Promise((t,a)=>{let s=new Image,r=new FileReader;r.onload=e=>{s.src=e.target?.result},r.onerror=a,s.onload=()=>{let r=document.createElement("canvas"),l=s.width,i=s.height;(l>1920||i>1920)&&(l>i?(i*=1920/l,l=1920):(l*=1920/i,i=1920)),r.width=l,r.height=i;let n=r.getContext("2d");if(!n){a(Error("Canvas context not available"));return}n.drawImage(s,0,0,l,i),r.toBlob(s=>{s?t(new File([s],e.name,{type:"image/jpeg",lastModified:Date.now()})):a(Error("Canvas to Blob failed"))},"image/jpeg",.8)},s.onerror=()=>a(Error("Image load failed"))}),g=({value:e,onChange:t,placeholder:a="写点什么...",className:l,minHeight:i="min-h-[200px]"})=>{let[n,o]=(0,r.useState)(),d=(0,r.useRef)(null),c=(0,r.useRef)(!1),m=(0,r.useRef)([]),u=(0,r.useRef)(new Map),g=(0,r.useRef)(new Map),f=async e=>{let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")};return(0,r.useEffect)(()=>{if(!d.current)return;d.current&&(d.current.innerHTML="");let s=new(x())(d.current,{value:e,mode:"wysiwyg",height:400,minHeight:300,placeholder:a,lang:"zh_CN",theme:"classic",cache:{enable:!1},toolbar:["emoji","headings","bold","italic","strike","link","|","list","ordered-list","check","outdent","indent","|","quote","line","code","inline-code","insert-before","insert-after","|","upload","table","|","undo","redo","|","edit-mode"],hint:{at:e=>(e&&p.ZP.get(`/api/profile/search?q=${e}`).then(e=>{m.current=e.data.map(e=>({value:"@"+e.username,html:`<div class="flex items-center gap-2"><img src="${e.avatar||`https://cravatar.eu/helmavatar/${e.username}/16.png`}" class="w-5 h-5 rounded-full"/> ${e.username}</div>`}))}).catch(console.error),m.current.filter(t=>t.value.toLowerCase().includes(e.toLowerCase())))},after:()=>{o(s)},input:e=>{c.current=!0,t(e),setTimeout(()=>{c.current=!1},0)},upload:{accept:"image/*",multiple:!1,handler:async e=>{for(let t of e){let e=`![⏳ 正在上传 ${t.name}...](https://cdnjs.cloudflare.com/ajax/libs/galleriffic/2.0.1/css/loader.gif)`;s.insertValue(e),s.tip(`正在上传 ${t.name}...`,0);try{let a=await f(t);if(u.current.has(a)){let r=u.current.get(a),l=t.name,i=`![${l}](${r})`,n=s.getValue().replace(e,i);s.setValue(n),s.tip("秒传成功 (已存在)",2e3);continue}let r=g.current.get(a);r?s.tip("正在合并重复上传任务...",0):(r=(async()=>{let e=t;if(e.size>5242880)try{if((e=await b(e)).size>5242880)throw Error("图片压缩后仍然超过5MB限制，请选择更小的图片")}catch(e){console.error("Compression failed",e)}let a=new FormData;a.append("file",e);let s=await (0,p.lY)();return(await p.ZP.post("/api/upload/image",a,{headers:{"Content-Type":"multipart/form-data",...s}})).data.url})(),g.current.set(a,r));let l=await r;u.current.set(a,l),g.current.delete(a);let i=t.name,n=`![${i}](${l})`,o=s.getValue().replace(e,n);s.setValue(o),s.tip("上传成功",2e3)}catch(i){console.error("Failed to upload image:",i);let a=await f(t).catch(()=>null);a&&g.current.delete(a);let r=i.response?.data?.detail||i.message||"上传失败",l=s.getValue().replace(e,`[上传失败: ${t.name}]`);s.setValue(l),s.tip(r,3e3)}}return null}},preview:{theme:{current:"light",path:"https://cdn.jsdelivr.net/npm/vditor/dist/css/content-theme"}}});return()=>{try{s?.destroy()}catch(e){}o(void 0)}},[]),(0,r.useEffect)(()=>{n&&!c.current&&e!==n.getValue()&&n.setValue(e)},[e,n]),(0,r.useEffect)(()=>{if(n){let e=document.documentElement.classList.contains("dark");n.setTheme(e?"dark":"classic",e?"dark":"light")}},[n]),s.jsx("div",{ref:d,className:(0,h.Z)("vditor-reset",i,l)})};var f=a(12390),v=a(3242),j=a(93206),y=a(91272),k=a(76910);let w=({isOpen:e,onClose:t,onSuccess:a,post:u})=>{let{level:x}=(0,y.h)(),{warning:h}=(0,k.p)(),[p,b]=(0,r.useState)(""),[w,N]=(0,r.useState)(""),[_,Z]=(0,r.useState)([]),[$,S]=(0,r.useState)(""),[C,P]=(0,r.useState)([]),[z,E]=(0,r.useState)(!1),D=(0,r.useRef)(null),R=(0,r.useRef)(null),[A,F]=(0,r.useState)(!1),[M,T]=(0,r.useState)(null),V=!!u,L=u?.type==="album";(0,r.useEffect)(()=>{e&&u?(b(u.title),N(u.content),Z(u.tags||[])):e&&!u&&(b(""),N(""),Z([]),S(""))},[e,u]),(0,r.useEffect)(()=>{if(L)return;let t=async()=>{try{let e=await (0,f.zW)($);P(e.filter(e=>!_.includes(e.name)))}catch(e){console.error(e)}};if(e){let e=setTimeout(t,300);return()=>clearTimeout(e)}},[$,_,e,L]),(0,r.useEffect)(()=>{let e=e=>{R.current&&!R.current.contains(e.target)&&D.current&&!D.current.contains(e.target)&&E(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let U=e=>{let t=e.trim().replace(/^#/,"");t&&!_.includes(t)&&_.length<10&&(Z([..._,t]),S(""),E(!1))},B=e=>{Z(_.filter(t=>t!==e))},q=async e=>{if(e.preventDefault(),p.trim()&&w.trim()){if(null!==x&&x<5){h("您的等级不足 5 级，无法发布动态。请前往游戏内升级！");return}F(!0),T(null);try{let e;if(V&&u){if(L)e=await (0,v.Yj)(u.id,{title:p,description:w});else{let t=(w.match(/#[^\s#.,;!?，。！？]+/g)||[]).map(e=>e.replace(/^#/,"")),a=Array.from(new Set([..._,...t])),s=(w.match(/!\[.*?\]\((.*?)\)/g)||[]).map(e=>{let t=e.match(/\((.*?)\)/);return t?t[1]:""}).filter(e=>e);e=await (0,f.CP)(u.id,{title:p,content:w,tags:a,images:s})}}else{let t=(w.match(/#[^\s#.,;!?，。！？]+/g)||[]).map(e=>e.replace(/^#/,"")),a=Array.from(new Set([..._,...t])),s=(w.match(/!\[.*?\]\((.*?)\)/g)||[]).map(e=>{let t=e.match(/\((.*?)\)/);return t?t[1]:""}).filter(e=>e);e=await (0,f.qb)({title:p,content:w,tags:a,images:s})}a(e),b(""),N(""),Z([]),S(""),t()}catch(e){T(V?"更新失败，请重试":"发布失败，请重试"),console.error(e)}finally{F(!1)}}},H=V?L?"编辑相册":"编辑动态":"发布动态";return s.jsx(j.Z,{children:s.jsx(c.M,{children:e&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50"}),s.jsx(m.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:e=>e.target===e.currentTarget&&t(),children:(0,s.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col relative",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800 shrink-0",children:[s.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:H}),s.jsx("button",{onClick:t,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 transition-colors",children:s.jsx(l.Z,{size:24})})]}),s.jsx("div",{className:"p-6 overflow-y-auto",children:(0,s.jsxs)("form",{id:"create-post-form",onSubmit:q,className:"space-y-6",children:[M&&(0,s.jsxs)("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-xl text-sm flex items-center gap-2",children:[s.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),M]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"标题"}),s.jsx("input",{type:"text",value:p,onChange:e=>b(e.target.value),placeholder:L?"相册标题":"给你的动态起个标题...",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400",maxLength:100})]}),!L&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["标签话题 ",s.jsx("span",{className:"text-slate-400 font-normal text-xs ml-1",children:"(回车添加，最多10个)"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus-within:ring-2 focus-within:ring-emerald-500 focus-within:border-transparent transition-all min-h-[50px]",children:[s.jsx(c.M,{mode:"popLayout",children:_.map(e=>(0,s.jsxs)(m.E.div,{layout:!0,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"flex items-center gap-1.5 pl-3 pr-2 py-1 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-700 dark:text-emerald-300 rounded-lg border border-emerald-100 dark:border-emerald-500/20",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:["#",e]}),s.jsx("button",{type:"button",onClick:()=>B(e),className:"p-0.5 rounded-md hover:bg-emerald-200 dark:hover:bg-emerald-500/30 text-emerald-400 hover:text-emerald-700 transition-colors",children:s.jsx(l.Z,{size:14})})]},e))}),s.jsx("div",{className:"flex-1 relative min-w-[120px]",children:s.jsx("input",{ref:D,type:"text",value:$,onChange:e=>S(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),$.trim()&&U($)):"Backspace"===e.key&&!$&&_.length>0&&B(_[_.length-1])},onFocus:()=>E(!0),placeholder:0===_.length?"添加标签 (如: #粘液空岛)":"",className:"w-full h-full py-1.5 bg-transparent border-none outline-none text-slate-900 dark:text-white placeholder-slate-400 text-sm"})})]}),s.jsx(c.M,{children:z&&C.length>0&&(0,s.jsxs)(m.E.div,{ref:R,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute z-10 left-0 right-0 top-full mt-2 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden max-h-60 overflow-y-auto",children:[s.jsx("div",{className:"px-3 py-2 text-xs font-medium text-slate-400 bg-slate-50 dark:bg-slate-900/50 border-b border-slate-100 dark:border-slate-800",children:$?"搜索结果":"热门推荐"}),C.map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>U(e.name),className:"w-full px-4 py-2.5 flex items-center justify-between text-left hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors group",children:[(0,s.jsxs)("span",{className:"text-sm text-slate-700 dark:text-slate-300 font-medium group-hover:text-emerald-600 dark:group-hover:text-emerald-400",children:["#",e.name]}),e.count>0&&(0,s.jsxs)("span",{className:"flex items-center gap-1 text-xs text-slate-400 group-hover:text-orange-500",children:[s.jsx(i.Z,{size:12}),e.count]})]},e.name))]})})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:L?"描述":"内容"}),s.jsx(g,{value:w,onChange:N,placeholder:L?"介绍一下这个相册...":"分享你的想法... (支持Markdown和图片粘贴)",minHeight:"min-h-[300px]"})]})]})}),(0,s.jsxs)("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3 bg-slate-50 dark:bg-slate-800/50 rounded-b-2xl",children:[s.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors font-medium",children:"取消"}),s.jsx("button",{type:"submit",form:"create-post-form",disabled:A||!p.trim()||!w.trim(),className:"flex items-center gap-2 px-6 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/20 transition-all font-medium",children:A?(0,s.jsxs)(s.Fragment,{children:[s.jsx(n.Z,{size:18,className:"animate-spin"})," ",V?"保存中...":"发布中..."]}):(0,s.jsxs)(s.Fragment,{children:[V?s.jsx(o.Z,{size:18}):s.jsx(d.Z,{size:18})," ",V?"保存修改":"发布动态"]})})]})]})})]})})})}},20349:(e,t,a)=>{"use strict";a.d(t,{Z:()=>M});var s=a(10326),r=a(17577),l=a(90434),i=a(9080),n=a(26394),o=a(97401),d=a(58080),c=a(85206),m=a(98091),u=a(67427),x=a(40617),h=a(96015),p=a(32933),b=a(76993),g=a(94019),f=a(77506),v=a(69436),j=a(74690),y=a(12390),k=a(3242),w=a(2704),N=a(41135),_=a(24846),Z=a(88129),$=a(52256),S=a(23495),C=a(33385),P=a(16152),z=a(91272),E=a(76910),D=a(45213);let R=(0,r.forwardRef)(({post:e,onUpdate:t,onDelete:a,className:R,isDetail:A=!1},M)=>{let{user:T,token:V}=(0,j.a)(),{level:L}=(0,z.h)(),{success:U,error:B,warning:q}=(0,E.p)(),{confirm:H}=(0,D.N)(),[I,K]=(0,r.useState)(e.is_liked),[Q,Y]=(0,r.useState)(e.likes_count),[G,O]=(0,r.useState)(e.is_collected),[W,J]=(0,r.useState)(e.collects_count),[X,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1),[es,er]=(0,r.useState)(!1),[el,ei]=(0,r.useState)(!1),[en,eo]=(0,r.useState)(e.author.is_following),[ed,ec]=(0,r.useState)(!1),[em,eu]=(0,r.useState)(!1),[ex,eh]=(0,r.useState)([]),[ep,eb]=(0,r.useState)(!1),[eg,ef]=(0,r.useState)(""),[ev,ej]=(0,r.useState)(null),[ey,ek]=(0,r.useState)(!1),ew=async(t=!1)=>{if(!(ex.length>0)||t){eb(!0);try{let t=V?{headers:{Authorization:`Bearer ${V}`}}:{},a=[];if("album"===e.type){let t=await (0,k.eK)(e.id);a=(Array.isArray(t.comments)?t.comments:[]).map(t=>{let a=t.author||t.user||t;return{id:t.id,post_id:e.id,content:t.content,created_at:t.created_at,author:{username:a.username||"User",nickname:a.nickname||a.username||"User",custom_title:a.custom_title,avatar:a.avatar},replies:[]}})}else{let s=(await C.ZP.get(`/api/posts/${e.id}/comments`,t)).data;a=Array.isArray(s)?s:s.data||[]}let s=new Map,r=[];a.forEach(e=>{s.set(e.id,{...e,replies:[]})}),a.forEach(e=>{let t=s.get(e.id);if(e.parent_id){let a=s.get(e.parent_id);a?a.replies?.push(t):r.push(t)}else r.push(t)}),r.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),eh(r)}catch(e){console.error("Failed to fetch comments:",e)}finally{eb(!1)}}},eN=()=>{if(A)return;let e=!em;eu(e),e&&ew()},e_=async(a,s)=>{if(T){if(null!==L&&L<5){q("您的等级不足 5 级，无法评论。请前往游戏内升级！");return}try{await C.ZP.post(`/api/posts/${e.id}/comments`,{content:a,parent_id:s},{headers:{Authorization:`Bearer ${V}`}}),eh([]),await ew(!0),t&&t({...e,comments_count:e.comments_count+1})}catch(e){throw B(e.response?.data?.detail||"评论失败"),e}}},eZ=async a=>{if(a.preventDefault(),eg.trim()&&T){if(null!==L&&L<5){q("您的等级不足 5 级，无法评论。请前往游戏内升级！");return}ek(!0);try{"album"===e.type?await (0,k.nN)(e.id,eg):await C.ZP.post(`/api/posts/${e.id}/comments`,{content:eg,parent_id:ev?.id},{headers:{Authorization:`Bearer ${V}`}}),eh([]),await ew(!0),ef(""),ej(null),t&&t({...e,comments_count:e.comments_count+1})}catch(e){B(e.response?.data?.detail||"评论失败")}finally{ek(!1)}}},e$=async()=>{try{let t=`${window.location.origin}/activity/${e.id}`;"album"===e.type&&(t=`${window.location.origin}/album/${e.id}`),await navigator.clipboard.writeText(t),er(!0),setTimeout(()=>er(!1),2e3)}catch(e){console.error("Failed to copy:",e),B("复制链接失败，请手动复制")}},eS=async t=>{if(t.preventDefault(),t.stopPropagation(),T&&!ed){ec(!0);try{en?(await (0,w.F6)(e.author.username),eo(!1)):(await (0,w.P_)(e.author.username),eo(!0))}catch(e){console.error(e)}finally{ec(!1)}}},eC=async()=>{if(T&&!X){ee(!0);try{let a;a="album"===e.type?await (0,k.ix)(e.id):await (0,y.D$)(e.id),K(a.is_liked),Y(a.likes_count),t&&t({...e,is_liked:a.is_liked,likes_count:a.likes_count})}catch(e){console.error(e)}finally{ee(!1)}}},eP=async()=>{if(T&&!et){ea(!0);try{let a;a="album"===e.type?await (0,k._L)(e.id):await (0,y.DR)(e.id),O(a.is_collected),J(a.collects_count),t&&t({...e,is_collected:a.is_collected,collects_count:a.collects_count})}catch(e){console.error(e)}finally{ea(!1)}}},ez=async()=>{if(await H({title:"删除内容",message:"确定要删除这条内容吗？此操作无法撤销。",isDangerous:!0,confirmText:"删除"}))try{"album"===e.type?await (0,k.mV)(e.id):await (0,y.fR)(e.id),a&&a(e.id),U("删除成功")}catch(e){console.error(e),B(e.response?.data?.detail||"删除失败")}},eE=T?.username===e.author.username,eD=e.content.replace(/@([^ \t\n\r\f\v@,.!?;:，。！？]+)/g,(e,t)=>`[${e}](/player/${t})`);return(0,s.jsxs)(_.E.div,{ref:M,initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:(0,N.Z)("bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden hover:shadow-md transition-all duration-300",R),children:[(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx(l.default,{href:`/player/${e.author.username}`,className:"flex-shrink-0",children:s.jsx("img",{src:e.author.avatar||`https://cravatar.eu/helmavatar/${e.author.username}/128.png`,alt:e.author.username,className:"w-10 h-10 rounded-xl object-cover border-2 border-slate-100 dark:border-slate-700",onError:e=>{e.target.src="https://cravatar.eu/helmavatar/MHF_Steve/128.png"}})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(l.default,{href:`/player/${e.author.username}`,className:"font-bold text-slate-900 dark:text-white hover:text-emerald-600 transition-colors block",children:e.author.nickname||e.author.username}),e.author.custom_title&&"玩家"!==e.author.custom_title&&s.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50",children:e.author.custom_title}),!eE&&T&&s.jsx("button",{onClick:eS,className:(0,N.Z)("ml-2 text-xs px-2 py-0.5 rounded-full font-medium transition-all duration-300 border",en?"text-slate-400 border-slate-200 hover:text-red-500 hover:border-red-200 bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-red-900/20":"text-emerald-600 border-emerald-200 hover:bg-emerald-50 bg-white dark:bg-slate-800 dark:text-emerald-400 dark:border-emerald-800 dark:hover:bg-emerald-900/20"),children:ed?"...":en?"已关注":"+ 关注"})]}),(0,s.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:[(0,o.Q)(new Date(e.created_at),{addSuffix:!0,locale:d.U}),"album"===e.type&&s.jsx("span",{className:"ml-1 text-purple-500 font-medium",children:"• 发布了相册"})]})]})]}),eE&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>ei(!0),className:"text-slate-400 hover:text-emerald-500 transition-colors p-2 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-lg",children:s.jsx(c.Z,{size:18})}),s.jsx("button",{onClick:ez,className:"text-slate-400 hover:text-red-500 transition-colors p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",children:s.jsx(m.Z,{size:18})})]})]}),"album"===e.type?(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("h3",{className:"font-bold text-xl mb-3 text-slate-900 dark:text-white",children:e.title}),e.images&&e.images.length>0&&s.jsx("div",{className:"rounded-2xl overflow-hidden bg-slate-100 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 mb-4 cursor-pointer relative group",children:(0,s.jsxs)(l.default,{href:A?`/player/${e.author.username}?tab=albums`:`/album/${e.id}`,children:[s.jsx("img",{src:e.images[0],alt:e.title,className:"w-full h-auto max-h-[600px] object-contain bg-black/5 dark:bg-black/20"}),s.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100 pointer-events-none",children:s.jsx("span",{className:"bg-black/60 text-white px-4 py-2 rounded-full backdrop-blur-md text-sm font-medium transform scale-95 group-hover:scale-100 transition-all",children:"查看相册"})})]})}),e.content&&s.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm leading-relaxed whitespace-pre-wrap",children:e.content})]}):s.jsx(l.default,{href:`/activity/${e.id}`,className:(0,N.Z)("block group",A&&"pointer-events-none"),children:(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("h3",{className:(0,N.Z)("font-bold text-slate-900 dark:text-white mb-2 transition-colors",A?"text-2xl":"text-xl group-hover:text-emerald-600 dark:group-hover:text-emerald-400"),children:e.title}),e.images&&e.images.length>0&&s.jsx("div",{className:(0,N.Z)("grid gap-2 mb-4",1===e.images.length?"grid-cols-1":2===e.images.length?"grid-cols-2":"grid-cols-3"),children:e.images.slice(0,A?void 0:3).map((t,a)=>(0,s.jsxs)("div",{className:(0,N.Z)("relative rounded-xl overflow-hidden bg-slate-100 dark:bg-slate-700 aspect-video",1===e.images.length&&"aspect-[2/1]"),children:[s.jsx("img",{src:t,alt:`Image ${a+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-500"}),!A&&2===a&&e.images.length>3&&(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white font-bold text-xl backdrop-blur-sm",children:["+",e.images.length-3]})]},a))}),s.jsx("div",{className:(0,N.Z)("prose dark:prose-invert max-w-none text-slate-600 dark:text-slate-300",A||em?"prose-base":"prose-sm line-clamp-6","prose-p:my-1 prose-headings:my-2 prose-ul:my-1 prose-ol:my-1 prose-li:my-0"),children:s.jsx(i.UG,{remarkPlugins:[n.Z],components:{a:({node:e,...t})=>s.jsx(l.default,{href:t.href||"#",className:"text-emerald-500 hover:underline",onClick:e=>e.stopPropagation(),children:t.children}),img:()=>null},children:A||em?eD:eD.slice(0,300)+(eD.length>300?"...":"")})})]})}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:e.tags.map(e=>(0,s.jsxs)(l.default,{href:`/activity?tag=${e}`,className:"px-2 py-1 text-xs bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-md hover:bg-emerald-50 hover:text-emerald-600 dark:hover:bg-emerald-900/20 dark:hover:text-emerald-400 transition-colors",onClick:e=>e.stopPropagation(),children:["#",e]},e))}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100 dark:border-slate-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("button",{onClick:eC,disabled:!T,className:(0,N.Z)("flex items-center gap-1.5 text-sm transition-colors",I?"text-red-500":"text-slate-500 hover:text-red-500"),children:[s.jsx(u.Z,{size:18,className:(0,N.Z)(I&&"fill-current")}),s.jsx("span",{children:Q>0?Q:"点赞"})]}),(0,s.jsxs)("button",{onClick:e=>{A||(e.preventDefault(),eN())},className:(0,N.Z)("flex items-center gap-1.5 text-sm transition-colors",em?"text-emerald-600":"text-slate-500 hover:text-emerald-600"),children:[s.jsx(x.Z,{size:18,className:(0,N.Z)(em&&"fill-current")}),s.jsx("span",{children:e.comments_count>0?e.comments_count:"评论"})]}),(0,s.jsxs)("button",{onClick:eP,disabled:!T,className:(0,N.Z)("flex items-center gap-1.5 text-sm transition-colors",G?"text-amber-500":"text-slate-500 hover:text-amber-500"),children:[s.jsx(h.Z,{size:18,className:(0,N.Z)(G&&"fill-current")}),s.jsx("span",{children:W>0?W:"收藏"})]})]}),(0,s.jsxs)("button",{onClick:e$,className:(0,N.Z)("transition-colors flex items-center gap-1.5",es?"text-emerald-500":"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"),title:"复制链接",children:[es?s.jsx(p.Z,{size:18}):s.jsx(b.Z,{size:18}),es&&s.jsx("span",{className:"text-xs font-medium",children:"已复制"})]})]}),s.jsx(Z.M,{children:em&&s.jsx(_.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:"album"===e.type?(0,s.jsxs)("div",{className:"pt-6 mt-4 border-t border-slate-100 dark:border-slate-700",children:[T?(0,s.jsxs)("form",{onSubmit:eZ,className:"mb-6",children:[ev&&(0,s.jsxs)("div",{className:"flex items-center justify-between bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg mb-2 text-sm",children:[(0,s.jsxs)("span",{className:"text-slate-500",children:["回复 ",(0,s.jsxs)("span",{className:"font-bold text-emerald-500",children:["@",ev.author.nickname||ev.author.username]})]}),s.jsx("button",{type:"button",onClick:()=>ej(null),className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-colors",children:s.jsx(g.Z,{size:14})})]}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx(P.Z,{value:eg,onChange:e=>ef(e.target.value),placeholder:ev?"写下你的回复...":"发表你的看法...",className:"w-full bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 pr-12 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none resize-none min-h-[80px] text-sm text-slate-900 dark:text-white"}),s.jsx("button",{type:"submit",disabled:ey||!eg.trim(),className:"absolute bottom-2 right-2 p-1.5 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:ey?s.jsx(f.Z,{size:16,className:"animate-spin"}):s.jsx(v.Z,{size:16})})]})]}):(0,s.jsxs)("div",{className:"text-center py-6 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-dashed border-slate-300 dark:border-slate-700 mb-6",children:[s.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"登录后参与讨论"}),s.jsx(l.default,{href:"/login",className:"text-emerald-500 text-sm font-medium hover:underline",children:"立即登录"})]}),s.jsx("div",{className:"space-y-4",children:ep?s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(f.Z,{size:24,className:"text-emerald-500 animate-spin"})}):0===ex.length?s.jsx("div",{className:"text-center py-8 text-slate-500 text-sm",children:"暂无评论，快来抢沙发吧！"}):ex.map(e=>s.jsx(F,{comment:e,onReply:ej},e.id))})]}):s.jsx("div",{className:"pt-6 mt-4 border-t border-slate-100 dark:border-slate-700",children:s.jsx(S.Z,{comments:ex,currentUser:T,onSubmit:e_,loading:ep,title:"评论",className:"!p-0 !bg-transparent !shadow-none !border-none"})})},"expanded-content")})]}),s.jsx($.Z,{isOpen:el,onClose:()=>ei(!1),onSuccess:e=>{t&&t(e)},post:e})]})});R.displayName="PostCard";let A=({content:e})=>{let t=e.replace(/@([^ \t\n\r\f\v@,.!?;:，。！？]+)/g,(e,t)=>`[${e}](/player/${t})`);return s.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none text-slate-700 dark:text-slate-300 leading-relaxed break-words",children:s.jsx(i.UG,{remarkPlugins:[n.Z],components:{a:({node:e,...t})=>s.jsx(l.default,{href:t.href||"#",className:"text-emerald-500 hover:underline",onClick:e=>e.stopPropagation(),children:t.children}),p:({node:e,...t})=>s.jsx("p",{className:"mb-1 last:mb-0",...t})},children:t})})},F=({comment:e,onReply:t})=>e&&e.author?(0,s.jsxs)("div",{className:"flex gap-3 group",children:[s.jsx(l.default,{href:`/player/${e.author.username}`,className:"flex-shrink-0",children:s.jsx("img",{src:e.author.avatar||`https://cravatar.eu/helmavatar/${e.author.username}/64.png`,alt:e.author.username,className:"w-8 h-8 rounded-lg bg-slate-100"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(l.default,{href:`/player/${e.author.username}`,className:"font-bold text-sm text-slate-900 dark:text-white hover:text-emerald-500 transition-colors",children:e.author.nickname||e.author.username}),e.author.custom_title&&"玩家"!==e.author.custom_title&&s.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50",children:e.author.custom_title}),s.jsx("span",{className:"text-xs text-slate-400",children:(0,o.Q)(new Date(e.created_at),{addSuffix:!0,locale:d.U})})]}),s.jsx("button",{onClick:()=>t(e),className:"text-slate-400 hover:text-emerald-500 text-xs opacity-0 group-hover:opacity-100 transition-all",children:"回复"})]}),s.jsx(A,{content:e.content}),e.replies&&e.replies.length>0&&s.jsx("div",{className:"mt-2 space-y-3 pl-3 border-l-2 border-slate-100 dark:border-slate-800",children:e.replies.map(e=>(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(l.default,{href:`/player/${e.author.username}`,className:"flex-shrink-0",children:s.jsx("img",{src:e.author.avatar||`https://cravatar.eu/helmavatar/${e.author.username}/64.png`,alt:e.author.username,className:"w-6 h-6 rounded bg-slate-100"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-0.5",children:[s.jsx(l.default,{href:`/player/${e.author.username}`,className:"font-bold text-xs text-slate-900 dark:text-white hover:text-emerald-500 transition-colors",children:e.author.nickname||e.author.username}),e.author.custom_title&&"玩家"!==e.author.custom_title&&s.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800/50",children:e.author.custom_title}),s.jsx("span",{className:"text-xs text-slate-400",children:(0,o.Q)(new Date(e.created_at),{addSuffix:!0,locale:d.U})})]}),s.jsx(A,{content:e.content})]})]},e.id))})]})]}):null,M=R},91272:(e,t,a)=>{"use strict";a.d(t,{h:()=>r});var s=a(20655);let r=()=>(0,s.l)()},12390:(e,t,a)=>{"use strict";a.d(t,{CP:()=>n,D$:()=>d,DR:()=>c,Jq:()=>r,fR:()=>o,qb:()=>i,zW:()=>l});var s=a(33385);let r=async e=>(await s.ZP.get("/api/posts",{params:{...e,_t:Date.now()}})).data,l=async e=>(await s.ZP.get("/api/topics/hot",{params:e?{query:e}:{}})).data,i=async e=>(await s.ZP.post("/api/posts",e)).data,n=async(e,t)=>(await s.ZP.put(`/api/posts/${e}`,t)).data,o=async e=>(await s.ZP.delete(`/api/posts/${e}`)).data,d=async e=>(await s.ZP.post(`/api/posts/${e}/like`)).data,c=async e=>(await s.ZP.post(`/api/posts/${e}/collect`)).data},3242:(e,t,a)=>{"use strict";a.d(t,{Yj:()=>o,_L:()=>l,eK:()=>d,ix:()=>r,mV:()=>n,nN:()=>i});var s=a(33385);let r=async e=>{let t=await s.ZP.post(`/api/album/${e}/like`);return{is_liked:t.data.is_liked,likes_count:t.data.likes}},l=async e=>{let t=await s.ZP.post(`/api/album/${e}/collect`);return{is_collected:t.data.is_collected,collects_count:t.data.collects_count||0}},i=async(e,t)=>(await s.ZP.post(`/api/album/${e}/comment`,{content:t})).data,n=async e=>(await s.ZP.delete(`/api/album/${e}`)).data,o=async(e,t)=>(await s.ZP.put(`/api/album/${e}`,t)).data,d=async e=>(await s.ZP.get(`/api/album/${e}`)).data},27147:()=>{}};